<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Archives | R cookbook for analysis with IMPACT</title>
  <meta name="description" content="10 Archives | R cookbook for analysis with IMPACT" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Archives | R cookbook for analysis with IMPACT" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Archives | R cookbook for analysis with IMPACT" />
  
  
  

<meta name="author" content="R Squad" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="miscellaneous.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello</a></li>
<li class="chapter" data-level="2" data-path="meta-information.html"><a href="meta-information.html"><i class="fa fa-check"></i><b>2</b> Meta information</a>
<ul>
<li class="chapter" data-level="2.1" data-path="meta-information.html"><a href="meta-information.html#creating-the-questionnaire-object"><i class="fa fa-check"></i><b>2.1</b> Creating the questionnaire object</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html"><i class="fa fa-check"></i><b>3</b> Downloading data from kobo server</a>
<ul>
<li class="chapter" data-level="3.1" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#defining-the-needed-functions"><i class="fa fa-check"></i><b>3.1</b> Defining the needed functions</a></li>
<li class="chapter" data-level="3.2" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#creating-data-url-and-credentials-variables"><i class="fa fa-check"></i><b>3.2</b> Creating data url and credentials variables</a></li>
<li class="chapter" data-level="3.3" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#fetching-the-data-from-the-server"><i class="fa fa-check"></i><b>3.3</b> Fetching the data from the server</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pre-analysis.html"><a href="pre-analysis.html"><i class="fa fa-check"></i><b>4</b> Pre analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pre-analysis.html"><a href="pre-analysis.html#checking-the-xls-kobo-tools-for-constraints-errors"><i class="fa fa-check"></i><b>4.1</b> Checking the XLS kobo tools for constraints errors</a></li>
<li class="chapter" data-level="4.2" data-path="pre-analysis.html"><a href="pre-analysis.html#sampling"><i class="fa fa-check"></i><b>4.2</b> Sampling</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="pre-analysis.html"><a href="pre-analysis.html#simple-random-sampling"><i class="fa fa-check"></i><b>4.2.1</b> Simple Random sampling</a></li>
<li class="chapter" data-level="4.2.2" data-path="pre-analysis.html"><a href="pre-analysis.html#stratified-random-sampling"><i class="fa fa-check"></i><b>4.2.2</b> Stratified Random sampling</a></li>
<li class="chapter" data-level="4.2.3" data-path="pre-analysis.html"><a href="pre-analysis.html#cluster-sampling"><i class="fa fa-check"></i><b>4.2.3</b> Cluster sampling</a></li>
<li class="chapter" data-level="4.2.4" data-path="pre-analysis.html"><a href="pre-analysis.html#stages-random-sampling"><i class="fa fa-check"></i><b>4.2.4</b> 2 stages random sampling</a></li>
<li class="chapter" data-level="4.2.5" data-path="pre-analysis.html"><a href="pre-analysis.html#sample-distribution-usin-population-raster"><i class="fa fa-check"></i><b>4.2.5</b> Sample distribution usin population raster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html"><i class="fa fa-check"></i><b>5</b> Data Collection and Processing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#testing-the-tool"><i class="fa fa-check"></i><b>5.1</b> Testing the tool</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#creating-dummy-data"><i class="fa fa-check"></i><b>5.1.1</b> Creating dummy data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#download-data"><i class="fa fa-check"></i><b>5.2</b> Download data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#downloading-audit-files-using-audit_url"><i class="fa fa-check"></i><b>5.2.1</b> Downloading Audit files using audit_URL</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#download-audit-files-using-form-name"><i class="fa fa-check"></i><b>5.2.2</b> Download audit files using form name</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-collection-follow-up"><i class="fa fa-check"></i><b>5.3</b> Data collection follow-up</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#checking-surveys-against-the-sampling-frame"><i class="fa fa-check"></i><b>5.3.1</b> checking surveys against the sampling frame</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-falsification"><i class="fa fa-check"></i><b>5.4</b> Data falsification</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time-in-the-dataset"><i class="fa fa-check"></i><b>5.4.1</b> Check for time (in the dataset)</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time-audit-files"><i class="fa fa-check"></i><b>5.4.2</b> Check for time (audit files)</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time---calculating-the-elapsed-time-between-each-interview"><i class="fa fa-check"></i><b>5.4.3</b> Check for time - calculating the elapsed time between each interview</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#silouhette-analysis"><i class="fa fa-check"></i><b>5.4.4</b> Silouhette analysis</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-duplicates"><i class="fa fa-check"></i><b>5.4.5</b> Check for duplicates</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-checks"><i class="fa fa-check"></i><b>5.5</b> Data checks</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-outliers"><i class="fa fa-check"></i><b>5.5.1</b> Check for outliers</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-others"><i class="fa fa-check"></i><b>5.5.2</b> Check others</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#issue-log-function"><i class="fa fa-check"></i><b>5.5.3</b> Issue log Function</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-logical-check"><i class="fa fa-check"></i><b>5.5.4</b> Check for logical check</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#cleaninginspector---inspect_all"><i class="fa fa-check"></i><b>5.6</b> cleaninginspectoR - inspect_all</a></li>
<li class="chapter" data-level="5.7" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-cleaning"><i class="fa fa-check"></i><b>5.7</b> Data cleaning</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#re-generate-text-column-for-select-multiple-questions"><i class="fa fa-check"></i><b>5.7.1</b> Re-generate text column for select multiple questions</a></li>
<li class="chapter" data-level="5.7.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#clean-data-base-on-cleaning-log"><i class="fa fa-check"></i><b>5.7.2</b> Clean data base on cleaning log</a></li>
<li class="chapter" data-level="5.7.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-cleaning-log-raw-dataset-and-clean-dataset"><i class="fa fa-check"></i><b>5.7.3</b> Check cleaning log, raw dataset and clean dataset</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-cleaning---miscellaneous"><i class="fa fa-check"></i><b>5.8</b> Data cleaning - miscellaneous</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-data-sanity-check-if-the-data-follow-odk-format-select_one-select_multiple-xxx-choices"><i class="fa fa-check"></i><b>5.8.1</b> Check for data sanity check if the data follow ODK format (select_one, select_multiple, xxx, choices)</a></li>
<li class="chapter" data-level="5.8.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#turns-label-to-xml"><i class="fa fa-check"></i><b>5.8.2</b> Turns label to xml</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#translation-using-microsoft-api"><i class="fa fa-check"></i><b>5.9</b> Translation using Microsoft API</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="composite-indicators.html"><a href="composite-indicators.html"><i class="fa fa-check"></i><b>6</b> Composite indicators</a>
<ul>
<li class="chapter" data-level="6.1" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-one"><i class="fa fa-check"></i><b>6.1</b> Composite with 1 categorical variable - select one</a></li>
<li class="chapter" data-level="6.2" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-categorical-variables"><i class="fa fa-check"></i><b>6.2</b> Composite with 2 categorical variables</a></li>
<li class="chapter" data-level="6.3" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-multiple"><i class="fa fa-check"></i><b>6.3</b> Composite with 1 categorical variable - select multiple</a></li>
<li class="chapter" data-level="6.4" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-numerical-variable"><i class="fa fa-check"></i><b>6.4</b> Composite with 1 numerical variable</a></li>
<li class="chapter" data-level="6.5" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-numerical-variables"><i class="fa fa-check"></i><b>6.5</b> Composite with 2 numerical variables</a></li>
<li class="chapter" data-level="6.6" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-or-more-numerical-variables"><i class="fa fa-check"></i><b>6.6</b> Composite with 2 or more numerical variables</a></li>
<li class="chapter" data-level="6.7" data-path="composite-indicators.html"><a href="composite-indicators.html#household-hunger-score-hhs"><i class="fa fa-check"></i><b>6.7</b> Household Hunger Score (HHS)</a></li>
<li class="chapter" data-level="6.8" data-path="composite-indicators.html"><a href="composite-indicators.html#food-cconsumption-score-fcs"><i class="fa fa-check"></i><b>6.8</b> Food Cconsumption Score (FCS)</a></li>
<li class="chapter" data-level="6.9" data-path="composite-indicators.html"><a href="composite-indicators.html#livelihood-coping-strategy-index-lcsi"><i class="fa fa-check"></i><b>6.9</b> Livelihood coping strategy index (LCSI)</a></li>
<li class="chapter" data-level="6.10" data-path="composite-indicators.html"><a href="composite-indicators.html#new-indicators-from-a-loop-to-main-dataset"><i class="fa fa-check"></i><b>6.10</b> New indicators from a loop to main dataset</a></li>
<li class="chapter" data-level="6.11" data-path="composite-indicators.html"><a href="composite-indicators.html#the-co-occurrence-of-needs-in-an-msni"><i class="fa fa-check"></i><b>6.11</b> The co-occurrence of needs in an MSNI</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>7</b> Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysis.html"><a href="analysis.html#srvyr-package"><i class="fa fa-check"></i><b>7.1</b> srvyr package</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="analysis.html"><a href="analysis.html#categorical-variables"><i class="fa fa-check"></i><b>7.1.1</b> Categorical variables</a></li>
<li class="chapter" data-level="7.1.2" data-path="analysis.html"><a href="analysis.html#numeric-variables"><i class="fa fa-check"></i><b>7.1.2</b> Numeric variables</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="analysis.html"><a href="analysis.html#analysis-with-numerical-variables"><i class="fa fa-check"></i><b>7.2</b> Analysis with numerical variables</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="analysis.html"><a href="analysis.html#median"><i class="fa fa-check"></i><b>7.2.1</b> Median</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="analysis.html"><a href="analysis.html#ratios"><i class="fa fa-check"></i><b>7.3</b> Ratios</a>
<ul>
<li><a href="analysis.html#example1" id="toc-example1"><span class="toc-section-number">7.3.1</span> Example1:<br />
</a></li>
<li><a href="analysis.html#example2---analyzing-multiple-questions-and-combine-the-output" id="toc-example2---analyzing-multiple-questions-and-combine-the-output"><span class="toc-section-number">7.3.2</span> Example2 - Analyzing multiple questions and combine the output:<br />
</a></li>
<li><a href="analysis.html#example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted" id="toc-example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted"><span class="toc-section-number">7.3.3</span> Example3 - No dissagregation is needed and/or the data is not weighted:<br />
</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="analysis.html"><a href="analysis.html#weights"><i class="fa fa-check"></i><b>7.4</b> Weights</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="analysis.html"><a href="analysis.html#tidyverse"><i class="fa fa-check"></i><b>7.4.1</b> tidyverse</a></li>
<li class="chapter" data-level="7.4.2" data-path="analysis.html"><a href="analysis.html#surveyweights"><i class="fa fa-check"></i><b>7.4.2</b> surveyweights</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="analysis.html"><a href="analysis.html#impactr-based-on-srvyr"><i class="fa fa-check"></i><b>7.5</b> impactR, based on <code>srvyr</code></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="analysis.html"><a href="analysis.html#introduction"><i class="fa fa-check"></i><b>7.5.1</b> Introduction</a></li>
<li class="chapter" data-level="7.5.2" data-path="analysis.html"><a href="analysis.html#first-stage-prepare-data-and-survey-design"><i class="fa fa-check"></i><b>7.5.2</b> First stage: prepare data and survey design</a></li>
<li class="chapter" data-level="7.5.3" data-path="analysis.html"><a href="analysis.html#second-stage-one-variable-analysis"><i class="fa fa-check"></i><b>7.5.3</b> Second stage: One variable analysis</a></li>
<li class="chapter" data-level="7.5.4" data-path="analysis.html"><a href="analysis.html#third-stage-one-analysis-at-a-time-with-the-kobo-tool"><i class="fa fa-check"></i><b>7.5.4</b> Third stage: one analysis at a time with the Kobo tool</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="analysis.html"><a href="analysis.html#example-survey-analysis-using-illuminate"><i class="fa fa-check"></i><b>7.6</b> EXAMPLE :: Survey analysis using illuminate</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="analysis.html"><a href="analysis.html#step-0-call-libraries"><i class="fa fa-check"></i><b>7.6.1</b> Step 0:: Call libraries</a></li>
<li class="chapter" data-level="7.6.2" data-path="analysis.html"><a href="analysis.html#step-1-read-data"><i class="fa fa-check"></i><b>7.6.2</b> Step 1:: Read data</a></li>
<li class="chapter" data-level="7.6.3" data-path="analysis.html"><a href="analysis.html#step-optional-preaparing-the-data"><i class="fa fa-check"></i><b>7.6.3</b> Step OPTIONAL:: Preaparing the data</a></li>
<li class="chapter" data-level="7.6.4" data-path="analysis.html"><a href="analysis.html#step-2-weight-calculation"><i class="fa fa-check"></i><b>7.6.4</b> Step 2:: Weight calculation</a></li>
<li class="chapter" data-level="7.6.5" data-path="analysis.html"><a href="analysis.html#read-sampleframe"><i class="fa fa-check"></i><b>7.6.5</b> Read sampleframe</a></li>
<li class="chapter" data-level="7.6.6" data-path="analysis.html"><a href="analysis.html#add-weights-to-the-dataframe"><i class="fa fa-check"></i><b>7.6.6</b> Add weights to the dataframe</a></li>
<li class="chapter" data-level="7.6.7" data-path="analysis.html"><a href="analysis.html#step-3.1-weighted-analysis"><i class="fa fa-check"></i><b>7.6.7</b> Step 3.1:: Weighted analysis</a></li>
<li class="chapter" data-level="7.6.8" data-path="analysis.html"><a href="analysis.html#step-3.2-unweighted-analysis"><i class="fa fa-check"></i><b>7.6.8</b> Step 3.2:: Unweighted analysis</a></li>
<li class="chapter" data-level="7.6.9" data-path="analysis.html"><a href="analysis.html#step-3.3-weighted-and-disaggregated-by-gender-analysis"><i class="fa fa-check"></i><b>7.6.9</b> Step 3.3:: Weighted and disaggregated by gender analysis</a></li>
<li class="chapter" data-level="7.6.10" data-path="analysis.html"><a href="analysis.html#step-4-export-with-write_formatted_excel"><i class="fa fa-check"></i><b>7.6.10</b> Step 4:: Export with <code>write_formatted_excel()</code></a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="analysis.html"><a href="analysis.html#repeating-the-above"><i class="fa fa-check"></i><b>7.7</b> Repeating the above</a></li>
<li class="chapter" data-level="7.8" data-path="analysis.html"><a href="analysis.html#analysis---top-x-ranking-select-one-and-select-multiple"><i class="fa fa-check"></i><b>7.8</b> Analysis - top X / ranking (select one and select multiple)</a></li>
<li class="chapter" data-level="7.9" data-path="analysis.html"><a href="analysis.html#borda-count"><i class="fa fa-check"></i><b>7.9</b> Borda count</a></li>
<li class="chapter" data-level="7.10" data-path="analysis.html"><a href="analysis.html#hypothesis-testing"><i class="fa fa-check"></i><b>7.10</b> Hypothesis testing</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="analysis.html"><a href="analysis.html#t-test"><i class="fa fa-check"></i><b>7.10.1</b> T-test</a></li>
<li class="chapter" data-level="7.10.2" data-path="analysis.html"><a href="analysis.html#anova"><i class="fa fa-check"></i><b>7.10.2</b> ANOVA</a></li>
<li class="chapter" data-level="7.10.3" data-path="analysis.html"><a href="analysis.html#chi-squares"><i class="fa fa-check"></i><b>7.10.3</b> chi-squares</a></li>
<li class="chapter" data-level="7.10.4" data-path="analysis.html"><a href="analysis.html#chi-squared-goodness-of-fit-test"><i class="fa fa-check"></i><b>7.10.4</b> Chi-squared Goodness of Fit test</a></li>
<li class="chapter" data-level="7.10.5" data-path="analysis.html"><a href="analysis.html#proportion-tests-z-test"><i class="fa fa-check"></i><b>7.10.5</b> Proportion tests (z-test)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>8</b> Outputs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="outputs.html"><a href="outputs.html#from-long-to-large-table"><i class="fa fa-check"></i><b>8.1</b> From long to large table</a></li>
<li class="chapter" data-level="8.2" data-path="outputs.html"><a href="outputs.html#merge-file"><i class="fa fa-check"></i><b>8.2</b> Merge file</a></li>
<li class="chapter" data-level="8.3" data-path="outputs.html"><a href="outputs.html#graphs"><i class="fa fa-check"></i><b>8.3</b> Graphs</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="outputs.html"><a href="outputs.html#spider-graphs"><i class="fa fa-check"></i><b>8.3.1</b> spider graphs</a></li>
<li class="chapter" data-level="8.3.2" data-path="outputs.html"><a href="outputs.html#prison-graphs"><i class="fa fa-check"></i><b>8.3.2</b> prison graphs</a></li>
<li class="chapter" data-level="8.3.3" data-path="outputs.html"><a href="outputs.html#bar-graphs"><i class="fa fa-check"></i><b>8.3.3</b> Bar graphs</a></li>
<li class="chapter" data-level="8.3.4" data-path="outputs.html"><a href="outputs.html#euler-diagram"><i class="fa fa-check"></i><b>8.3.4</b> Euler diagram</a></li>
<li class="chapter" data-level="8.3.5" data-path="outputs.html"><a href="outputs.html#venn-diagram"><i class="fa fa-check"></i><b>8.3.5</b> Venn diagram</a></li>
<li class="chapter" data-level="8.3.6" data-path="outputs.html"><a href="outputs.html#upset-plots"><i class="fa fa-check"></i><b>8.3.6</b> UpSet plots</a></li>
<li class="chapter" data-level="8.3.7" data-path="outputs.html"><a href="outputs.html#boxplots"><i class="fa fa-check"></i><b>8.3.7</b> boxplots</a></li>
<li class="chapter" data-level="8.3.8" data-path="outputs.html"><a href="outputs.html#circular-barplots"><i class="fa fa-check"></i><b>8.3.8</b> Circular barplots</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="outputs.html"><a href="outputs.html#labels"><i class="fa fa-check"></i><b>8.4</b> Labels</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="outputs.html"><a href="outputs.html#xml-to-label"><i class="fa fa-check"></i><b>8.4.1</b> Xml to Label</a></li>
<li class="chapter" data-level="8.4.2" data-path="outputs.html"><a href="outputs.html#change-from-label-to-xml"><i class="fa fa-check"></i><b>8.4.2</b> change from label to xml</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="outputs.html"><a href="outputs.html#dashboarding---sharing-information"><i class="fa fa-check"></i><b>8.5</b> Dashboarding - Sharing information</a></li>
<li class="chapter" data-level="8.6" data-path="outputs.html"><a href="outputs.html#outputs-with-hypothesis-testing-results"><i class="fa fa-check"></i><b>8.6</b> Outputs with hypothesis testing results</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>9</b> Miscellaneous</a></li>
<li class="chapter" data-level="10" data-path="archives.html"><a href="archives.html"><i class="fa fa-check"></i><b>10</b> Archives</a>
<ul>
<li class="chapter" data-level="10.1" data-path="archives.html"><a href="archives.html#pre-analysis-1"><i class="fa fa-check"></i><b>10.1</b> 01 Pre analysis</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="archives.html"><a href="archives.html#generation-of-random-sample-points"><i class="fa fa-check"></i><b>10.1.1</b> Generation of random sample points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="archives.html"><a href="archives.html#cleaning"><i class="fa fa-check"></i><b>10.2</b> Cleaning</a></li>
<li class="chapter" data-level="10.3" data-path="archives.html"><a href="archives.html#spatial-verification-checks"><i class="fa fa-check"></i><b>10.3</b> Spatial verification checks</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="archives.html"><a href="archives.html#spatial-verification-checks-on-settlement-level"><i class="fa fa-check"></i><b>10.3.1</b> Spatial verification checks on settlement level</a></li>
<li class="chapter" data-level="10.3.2" data-path="archives.html"><a href="archives.html#spatial-verification-checks-on-sample-point-level"><i class="fa fa-check"></i><b>10.3.2</b> Spatial verification checks on sample point level</a></li>
<li class="chapter" data-level="10.3.3" data-path="archives.html"><a href="archives.html#statistical-disclosure-control-methods"><i class="fa fa-check"></i><b>10.3.3</b> Statistical Disclosure Control Methods</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="archives.html"><a href="archives.html#analayis"><i class="fa fa-check"></i><b>10.4</b> Analayis</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="archives.html"><a href="archives.html#hypegrammar"><i class="fa fa-check"></i><b>10.4.1</b> hypegrammaR</a></li>
<li class="chapter" data-level="10.4.2" data-path="archives.html"><a href="archives.html#butter-survey_collapse"><i class="fa fa-check"></i><b>10.4.2</b> butteR survey_collapse</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R cookbook for analysis with IMPACT</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="archives" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Archives<a href="archives.html#archives" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This part are some code that were written but cannot be run in the cookbook because of some dependencies, deprecated version, etc. They are still valid and useful but just cannot be run automatically to render the book. They are not evaluated.</p>
<div id="pre-analysis-1" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> 01 Pre analysis<a href="archives.html#pre-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="generation-of-random-sample-points" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Generation of random sample points<a href="archives.html#generation-of-random-sample-points" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is quite common practice to select survey locations before data collection, using randomly distributed points. In this case, the enumerator finds the location of a certain sample point using mobile device navigation tools and conducts an interview near that location. That practice ensures that all survey locations were selected in a random manner.
<br>
First, let’s join our sampling frame (in this case it was generated with <a href="https://impact-initiatives.shinyapps.io/r_sampling_tool_v2/">Probability sampling tool</a>) to the settlement polygons and generate a random set of points within each polygon. We will use settlement polygons but it’s possible to use rectangle or hexagon fishnet with interview numbers distributed using population raster to obtain sample size that will correspond with settlement population density.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="archives.html#cb328-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb328-2"><a href="archives.html#cb328-2" tabindex="-1"></a></span>
<span id="cb328-3"><a href="archives.html#cb328-3" tabindex="-1"></a>ADM4 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;inputs/MSNA20_ADM4.geojson&quot;</span>)</span>
<span id="cb328-4"><a href="archives.html#cb328-4" tabindex="-1"></a>sampling_frame <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/sampling_frame20200701-132150.csv&quot;</span>)</span>
<span id="cb328-5"><a href="archives.html#cb328-5" tabindex="-1"></a></span>
<span id="cb328-6"><a href="archives.html#cb328-6" tabindex="-1"></a>ADM4_for_sample <span class="ot">&lt;-</span> ADM4 <span class="sc">%&gt;%</span></span>
<span id="cb328-7"><a href="archives.html#cb328-7" tabindex="-1"></a>        <span class="fu">right_join</span>(sampling_frame, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;adm4Pcd&quot;</span> <span class="ot">=</span> <span class="st">&quot;adm4Pcode&quot;</span>))</span>
<span id="cb328-8"><a href="archives.html#cb328-8" tabindex="-1"></a></span>
<span id="cb328-9"><a href="archives.html#cb328-9" tabindex="-1"></a>sample_all_pnt <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(ADM4_for_sample, <span class="fu">rep</span>(ADM4_for_sample<span class="sc">$</span>Survey, <span class="fu">nrow</span>(ADM4_for_sample)))<span class="sc">%&gt;%</span></span>
<span id="cb328-10"><a href="archives.html#cb328-10" tabindex="-1"></a>  st_as_sf</span></code></pre></div>
<p>Now we would need to transfer attributes from the settlement layer to our random points.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="archives.html#cb329-1" tabindex="-1"></a><span class="co">#first we should generate indexes that will be used for this transfer</span></span>
<span id="cb329-2"><a href="archives.html#cb329-2" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq_along</span>(ADM4_for_sample<span class="sc">$</span>Survey), ADM4_for_sample<span class="sc">$</span>Survey)</span>
<span id="cb329-3"><a href="archives.html#cb329-3" tabindex="-1"></a></span>
<span id="cb329-4"><a href="archives.html#cb329-4" tabindex="-1"></a><span class="co">#now we should add indexes to the settlement layer and then join this layer to the random points</span></span>
<span id="cb329-5"><a href="archives.html#cb329-5" tabindex="-1"></a>ADM4_for_sample <span class="ot">&lt;-</span> ADM4_for_sample <span class="sc">%&gt;%</span></span>
<span id="cb329-6"><a href="archives.html#cb329-6" tabindex="-1"></a>                   <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb329-7"><a href="archives.html#cb329-7" tabindex="-1"></a>                   <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))<span class="sc">%&gt;%</span></span>
<span id="cb329-8"><a href="archives.html#cb329-8" tabindex="-1"></a>                   tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;index&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb329-9"><a href="archives.html#cb329-9" tabindex="-1"></a>                   <span class="fu">mutate_at</span>(<span class="dv">1</span>, as.numeric)</span>
<span id="cb329-10"><a href="archives.html#cb329-10" tabindex="-1"></a></span>
<span id="cb329-11"><a href="archives.html#cb329-11" tabindex="-1"></a>sample_all_pnt <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(sample_all_pnt)<span class="sc">%&gt;%</span></span>
<span id="cb329-12"><a href="archives.html#cb329-12" tabindex="-1"></a>                  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb329-13"><a href="archives.html#cb329-13" tabindex="-1"></a>                  <span class="fu">bind_cols</span>(index)<span class="sc">%&gt;%</span></span>
<span id="cb329-14"><a href="archives.html#cb329-14" tabindex="-1"></a>                  <span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">&quot;Longitude_pnt&quot;</span>,<span class="st">&quot;Latitude_pnt&quot;</span>,<span class="st">&quot;index&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb329-15"><a href="archives.html#cb329-15" tabindex="-1"></a>                  <span class="fu">left_join</span>(ADM4_for_sample, <span class="at">by =</span> <span class="st">&quot;index&quot;</span>)</span>
<span id="cb329-16"><a href="archives.html#cb329-16" tabindex="-1"></a></span>
<span id="cb329-17"><a href="archives.html#cb329-17" tabindex="-1"></a><span class="co">#with the code below we will get the unique id for each point that will have a settlement name and point number</span></span>
<span id="cb329-18"><a href="archives.html#cb329-18" tabindex="-1"></a>sample_all_pnt<span class="sc">$</span>GPS_id <span class="ot">&lt;-</span> <span class="fu">paste</span>(sample_all_pnt<span class="sc">$</span>adm4NmL, data.table<span class="sc">::</span><span class="fu">rowid</span>(sample_all_pnt<span class="sc">$</span>adm4NmL), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb329-19"><a href="archives.html#cb329-19" tabindex="-1"></a></span>
<span id="cb329-20"><a href="archives.html#cb329-20" tabindex="-1"></a>sample_all_pnt <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="at">x =</span> sample_all_pnt, </span>
<span id="cb329-21"><a href="archives.html#cb329-21" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude_pnt&quot;</span>, <span class="st">&quot;Latitude_pnt&quot;</span>),</span>
<span id="cb329-22"><a href="archives.html#cb329-22" tabindex="-1"></a>                    <span class="at">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb329-23"><a href="archives.html#cb329-23" tabindex="-1"></a></span>
<span id="cb329-24"><a href="archives.html#cb329-24" tabindex="-1"></a><span class="co">#and now we can visualize our random points for some settlement to check their distribution</span></span>
<span id="cb329-25"><a href="archives.html#cb329-25" tabindex="-1"></a>sample_all_pnt <span class="sc">%&gt;%</span></span>
<span id="cb329-26"><a href="archives.html#cb329-26" tabindex="-1"></a>  <span class="fu">filter</span>(adm4NmL <span class="sc">==</span> <span class="st">&quot;Bakhmut&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb329-27"><a href="archives.html#cb329-27" tabindex="-1"></a>  <span class="fu">select</span>(adm4NmL)<span class="sc">%&gt;%</span></span>
<span id="cb329-28"><a href="archives.html#cb329-28" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p>The last step will be to export the sample points into any suitable GIS format (GeoJSON, Shapefile, KML, etc.) and transfer that file to the mobile devices of the enumerators.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="archives.html#cb330-1" tabindex="-1"></a><span class="co">#check if there are directory for the outputs and write there output geojson file</span></span>
<span id="cb330-2"><a href="archives.html#cb330-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;outputs&quot;</span>)) {</span>
<span id="cb330-3"><a href="archives.html#cb330-3" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;outputs&quot;</span>)</span>
<span id="cb330-4"><a href="archives.html#cb330-4" tabindex="-1"></a>}</span>
<span id="cb330-5"><a href="archives.html#cb330-5" tabindex="-1"></a></span>
<span id="cb330-6"><a href="archives.html#cb330-6" tabindex="-1"></a><span class="fu">st_write</span>(sample_all_pnt, <span class="st">&quot;outputs/sample_points.geojson&quot;</span>, <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="cleaning" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Cleaning<a href="archives.html#cleaning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="spatial-verification-checks" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Spatial verification checks<a href="archives.html#spatial-verification-checks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="spatial-verification-checks-on-settlement-level" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Spatial verification checks on settlement level<a href="archives.html#spatial-verification-checks-on-settlement-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the important checks is to ensure that all surveys were collected in the correct locations (areas, settlements, sample points). The usual procedure to perform such checks is to compare GNSS-coordinates obtained by the data collection device with enumerator input that indicates data collection location</p>
<p>First, let’s generate random spatial coordinates (as real coordinates were excluded as part of personal data) and select columns that we need for cleaning.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="archives.html#cb331-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb331-2"><a href="archives.html#cb331-2" tabindex="-1"></a><span class="fu">library</span>(nngeo)</span></code></pre></div>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="archives.html#cb332-1" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb332-2"><a href="archives.html#cb332-2" tabindex="-1"></a></span>
<span id="cb332-3"><a href="archives.html#cb332-3" tabindex="-1"></a>main_dataset<span class="sc">$</span>X_r6_gpslocation_latitude <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(main_dataset), <span class="at">min =</span> <span class="dv">47</span>, <span class="at">max =</span> <span class="dv">48</span>)</span>
<span id="cb332-4"><a href="archives.html#cb332-4" tabindex="-1"></a>main_dataset<span class="sc">$</span>X_r6_gpslocation_longitude <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(main_dataset), <span class="at">min =</span> <span class="dv">37</span>, <span class="at">max =</span> <span class="dv">40</span>)</span>
<span id="cb332-5"><a href="archives.html#cb332-5" tabindex="-1"></a></span>
<span id="cb332-6"><a href="archives.html#cb332-6" tabindex="-1"></a>spatial_component <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span></span>
<span id="cb332-7"><a href="archives.html#cb332-7" tabindex="-1"></a>  <span class="fu">select</span>(r3_current_settlement,adm4NameLat,X_r6_gpslocation_latitude,X_r6_gpslocation_longitude,X_uuid)<span class="sc">%&gt;%</span></span>
<span id="cb332-8"><a href="archives.html#cb332-8" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;code_settlement_dataset&quot;</span>,<span class="st">&quot;name_settlement_dataset&quot;</span>,<span class="st">&quot;latitude&quot;</span>,<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;X_uuid&quot;</span>))</span></code></pre></div>
<p>Now with <a href="https://cran.r-project.org/web/packages/sf/index.html">sf library</a> we should open geojson file with settlements boundaries and convert our dataset into sf data type.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="archives.html#cb333-1" tabindex="-1"></a>ADM4 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;inputs/MSNA20_ADM4.geojson&quot;</span>)</span>
<span id="cb333-2"><a href="archives.html#cb333-2" tabindex="-1"></a></span>
<span id="cb333-3"><a href="archives.html#cb333-3" tabindex="-1"></a>spatial_component <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="at">x =</span> spatial_component, </span>
<span id="cb333-4"><a href="archives.html#cb333-4" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>),</span>
<span id="cb333-5"><a href="archives.html#cb333-5" tabindex="-1"></a>                    <span class="at">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span></code></pre></div>
<p>With st_join() function from <a href="https://cran.r-project.org/web/packages/nngeo/index.html">nngeo library</a> we are doing spatial join of interviews locations and settlement boundaries. Parameter “maxdist” specifies that join should be performed for all the points that are within 1000 meters from the closest polygon. After that, we compare the code of the closest settlement and the settlement code chosen by the enumerator. In case there is a difference in the codes we put “CHECK” status for such interviews and clarify interview location with the Field team.
<em>Keep in mind that for this example we used random coordinates so most likely all the interviews will have “CHECK” status</em></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="archives.html#cb334-1" tabindex="-1"></a>spatial_component <span class="ot">&lt;-</span> <span class="fu">st_join</span>(spatial_component, ADM4, <span class="at">join =</span> st_nn, <span class="at">k =</span> <span class="dv">1</span>, <span class="at">maxdist =</span> <span class="dv">1000</span>)</span>
<span id="cb334-2"><a href="archives.html#cb334-2" tabindex="-1"></a></span>
<span id="cb334-3"><a href="archives.html#cb334-3" tabindex="-1"></a>spatial_component<span class="sc">$</span>spatial_check <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(spatial_component<span class="sc">$</span>code_settlement_dataset <span class="sc">==</span> spatial_component<span class="sc">$</span>adm4NmL</span>
<span id="cb334-4"><a href="archives.html#cb334-4" tabindex="-1"></a>                                          <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(spatial_component<span class="sc">$</span>adm4NmL),</span>
<span id="cb334-5"><a href="archives.html#cb334-5" tabindex="-1"></a>                                          <span class="st">&quot;OK&quot;</span>,</span>
<span id="cb334-6"><a href="archives.html#cb334-6" tabindex="-1"></a>                                          <span class="st">&quot;CHECK&quot;</span>)</span></code></pre></div>
<p>Print number of interviews that needs review</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="archives.html#cb335-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Number interviews to check&quot;</span>,<span class="fu">unlist</span>(<span class="fu">table</span>(spatial_component<span class="sc">$</span>spatial_check))))</span></code></pre></div>
</div>
<div id="spatial-verification-checks-on-sample-point-level" class="section level3 hasAnchor" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Spatial verification checks on sample point level<a href="archives.html#spatial-verification-checks-on-sample-point-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Previous spatial verification check can identify surveys that were collected in the wrong area (settlement). But if you are using random sampling points (as described in <a href="archives.html#generation-of-random-sample-points">Generation of random sample points</a>) you can also check how your surveys corresponds with initially planned sample points.
<br>
To perform spatial verification on sample point level we should add our sample ids to the dataset (<em>of course in a real-life scenario you will already have them in your dataset</em>). Also, we should open initial sampling points generated at the sampling stage and that were used by the enumerators.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="archives.html#cb336-1" tabindex="-1"></a>spatial_component<span class="sc">$</span>GPS_id_data <span class="ot">&lt;-</span> <span class="fu">paste</span>(spatial_component<span class="sc">$</span>name_settlement_dataset,</span>
<span id="cb336-2"><a href="archives.html#cb336-2" tabindex="-1"></a>                                  data.table<span class="sc">::</span><span class="fu">rowid</span>(spatial_component<span class="sc">$</span>name_settlement_dataset), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb336-3"><a href="archives.html#cb336-3" tabindex="-1"></a></span>
<span id="cb336-4"><a href="archives.html#cb336-4" tabindex="-1"></a>sample_points <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&quot;outputs/sample_points.geojson&quot;</span>)</span></code></pre></div>
<p>Now let’s use again st_join() function but this time apply it on two point layers. We would put argument k equal 3 that will give us sample ids of 3 points in the dataset that are located in 1 km radius from our initial sample points. In case function return NA value it will mean that there are no points were collected near our planned sample point.
<br>
<em>Keep in mind that for this book we are using randomly generated survey locations so most of the points will have NA or CHECK status</em></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="archives.html#cb337-1" tabindex="-1"></a><span class="co">#first let&#39;s run st_join() function. You can reduce or increase maxdist value considering your circumstances.</span></span>
<span id="cb337-2"><a href="archives.html#cb337-2" tabindex="-1"></a>sample_point_check <span class="ot">&lt;-</span> <span class="fu">st_join</span>(spatial_component, sample_points, <span class="at">join =</span> st_nn, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">maxdist =</span> <span class="dv">1000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb337-3"><a href="archives.html#cb337-3" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb337-4"><a href="archives.html#cb337-4" tabindex="-1"></a></span>
<span id="cb337-5"><a href="archives.html#cb337-5" tabindex="-1"></a><span class="co">#now we should reshape our dataset and select only columns with point ids</span></span>
<span id="cb337-6"><a href="archives.html#cb337-6" tabindex="-1"></a>sample_point_check <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(sample_point_check, X_uuid <span class="sc">+</span> GPS_id_data  <span class="sc">~</span> GPS_id, <span class="at">value.var =</span> <span class="st">&quot;GPS_id&quot;</span>, </span>
<span id="cb337-7"><a href="archives.html#cb337-7" tabindex="-1"></a>                                      <span class="at">fun.aggregate =</span>  <span class="cn">NULL</span>)</span>
<span id="cb337-8"><a href="archives.html#cb337-8" tabindex="-1"></a></span>
<span id="cb337-9"><a href="archives.html#cb337-9" tabindex="-1"></a>sample_point_check <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">apply</span>(sample_point_check,<span class="dv">1</span>, <span class="cf">function</span>(x) { <span class="fu">return</span>(<span class="fu">c</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)],x[<span class="fu">is.na</span>(x)]) )} )))<span class="sc">%&gt;%</span></span>
<span id="cb337-10"><a href="archives.html#cb337-10" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="fu">where</span>(<span class="cf">function</span>(x) <span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(x))))<span class="sc">%&gt;%</span></span>
<span id="cb337-11"><a href="archives.html#cb337-11" tabindex="-1"></a>                      <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;uuid&quot;</span>, <span class="st">&quot;GPS_id&quot;</span>, <span class="st">&quot;pnt_1&quot;</span>, <span class="st">&quot;pnt_2&quot;</span>, <span class="st">&quot;pnt_3&quot;</span>))</span>
<span id="cb337-12"><a href="archives.html#cb337-12" tabindex="-1"></a></span>
<span id="cb337-13"><a href="archives.html#cb337-13" tabindex="-1"></a><span class="co">#and as a final step, we should mark all the interviews that will need additional review</span></span>
<span id="cb337-14"><a href="archives.html#cb337-14" tabindex="-1"></a>sample_point_check<span class="sc">$</span>Sample_Check <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sample_point_check<span class="sc">$</span>GPS_id <span class="sc">==</span> sample_point_check<span class="sc">$</span>pnt_1 <span class="sc">|</span> </span>
<span id="cb337-15"><a href="archives.html#cb337-15" tabindex="-1"></a>                                          sample_point_check<span class="sc">$</span>GPS_id <span class="sc">==</span> sample_point_check<span class="sc">$</span>pnt_2 <span class="sc">|</span> </span>
<span id="cb337-16"><a href="archives.html#cb337-16" tabindex="-1"></a>                                          sample_point_check<span class="sc">$</span>GPS_id <span class="sc">==</span> sample_point_check<span class="sc">$</span>pnt_3, </span>
<span id="cb337-17"><a href="archives.html#cb337-17" tabindex="-1"></a>                                          <span class="st">&quot;OK&quot;</span>, </span>
<span id="cb337-18"><a href="archives.html#cb337-18" tabindex="-1"></a>                                          <span class="st">&quot;CHECK&quot;</span>)</span></code></pre></div>
<p>Usually, there are always some interviews that were collected not accordingly to the sampling plan. They can be either too far away from the planned sample location or has different sample id due to enumerator mistake. Such cases are better to review manually using any GIS software (QGIS/ArcGIS Pro/ArcGIS Online/Google Earth Pro). But first, you will need to export your sample points into any spatial format (like geojson).</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="archives.html#cb338-1" tabindex="-1"></a><span class="co">#join spatial check on sample point level with spatial check on settlement level</span></span>
<span id="cb338-2"><a href="archives.html#cb338-2" tabindex="-1"></a>spatial_component <span class="ot">&lt;-</span> spatial_component <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="archives.html#cb338-3" tabindex="-1"></a>                     <span class="fu">left_join</span>(sample_point_check, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;X_uuid&quot;</span> <span class="ot">=</span> <span class="st">&quot;uuid&quot;</span>))</span>
<span id="cb338-4"><a href="archives.html#cb338-4" tabindex="-1"></a></span>
<span id="cb338-5"><a href="archives.html#cb338-5" tabindex="-1"></a><span class="co">#check if there are directory for the outputs and write there output geojson file</span></span>
<span id="cb338-6"><a href="archives.html#cb338-6" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;outputs&quot;</span>)) {</span>
<span id="cb338-7"><a href="archives.html#cb338-7" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;outputs&quot;</span>)</span>
<span id="cb338-8"><a href="archives.html#cb338-8" tabindex="-1"></a>}</span>
<span id="cb338-9"><a href="archives.html#cb338-9" tabindex="-1"></a></span>
<span id="cb338-10"><a href="archives.html#cb338-10" tabindex="-1"></a><span class="fu">st_write</span>(spatial_component, <span class="st">&quot;outputs/spatial_component_check.geojson&quot;</span>, <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="statistical-disclosure-control-methods" class="section level3 hasAnchor" number="10.3.3">
<h3><span class="header-section-number">10.3.3</span> Statistical Disclosure Control Methods<a href="archives.html#statistical-disclosure-control-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Statistical Disclosure Control techniques can be defined as the set of methods to reduce the risk of disclosing information on individuals or organizations.</p>
<p>Statistical Disclosure Control Process</p>
<ol style="list-style-type: decimal">
<li>Measuring the disclosure risk
Disclosure risk occurs if an unacceptably narrow estimation of a respondent’s confidential information is possible or if exact disclosure is possible with a high level of confidence.</li>
</ol>
<p>so we’ll need to clasify the variables into three categories;</p>
<ul>
<li>Non-identifying variables (e.g. respondent feelings)</li>
<li>Direct identifiers (e.g. respondent names, phone numbers)</li>
<li>Quasi-identifiers (e.g. age, gender, gps coordinates)</li>
</ul>
<p>we’ll use the main_dataset for demonstrating the process</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="archives.html#cb339-1" tabindex="-1"></a><span class="co"># load the SdcMicro package </span></span>
<span id="cb339-2"><a href="archives.html#cb339-2" tabindex="-1"></a><span class="fu">library</span>(sdcMicro)</span>
<span id="cb339-3"><a href="archives.html#cb339-3" tabindex="-1"></a></span>
<span id="cb339-4"><a href="archives.html#cb339-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb339-5"><a href="archives.html#cb339-5" tabindex="-1"></a>selectedKeyVars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a2_hh_representative_name&quot;</span>, <span class="co"># direct identifiers</span></span>
<span id="cb339-6"><a href="archives.html#cb339-6" tabindex="-1"></a>                     <span class="st">&quot;a3_1_phone&quot;</span>, <span class="co"># direct identifiers</span></span>
<span id="cb339-7"><a href="archives.html#cb339-7" tabindex="-1"></a>                     <span class="st">&quot;b4_gender&quot;</span>, <span class="co"># quasi identifiers </span></span>
<span id="cb339-8"><a href="archives.html#cb339-8" tabindex="-1"></a>                     <span class="st">&quot;b5_age&quot;</span>, <span class="co"># quasi identifiers</span></span>
<span id="cb339-9"><a href="archives.html#cb339-9" tabindex="-1"></a>                     <span class="st">&quot;b8_hohh_sex&quot;</span>, <span class="co"># quasi identifiers</span></span>
<span id="cb339-10"><a href="archives.html#cb339-10" tabindex="-1"></a>                     <span class="st">&quot;b9_hohh_marital_status&quot;</span>, <span class="co"># quasi identifiers</span></span>
<span id="cb339-11"><a href="archives.html#cb339-11" tabindex="-1"></a>                     <span class="st">&quot;X_r6_gpslocation_latitude&quot;</span>, <span class="co"># quasi identifiers</span></span>
<span id="cb339-12"><a href="archives.html#cb339-12" tabindex="-1"></a>                     <span class="st">&quot;X_r6_gpslocation_longitude&quot;</span>, <span class="co"># quasi identifiers</span></span>
<span id="cb339-13"><a href="archives.html#cb339-13" tabindex="-1"></a>                     <span class="st">&quot;X_r6_gpslocation_precision&quot;</span>) <span class="co"># quasi identifiers</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Applying anonymization methods
Sometimes we may have some direct identifier variables that feed our analysis plans and in that cases we will need to deduct data by categorizing continuous variables.</p></li>
<li><p>Measuring utility and information loss</p></li>
</ol>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="archives.html#cb340-1" tabindex="-1"></a><span class="co"># weight variable</span></span>
<span id="cb340-2"><a href="archives.html#cb340-2" tabindex="-1"></a>weightVars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;stratum.weight&#39;</span>)</span>
<span id="cb340-3"><a href="archives.html#cb340-3" tabindex="-1"></a></span>
<span id="cb340-4"><a href="archives.html#cb340-4" tabindex="-1"></a><span class="co"># checking risk</span></span>
<span id="cb340-5"><a href="archives.html#cb340-5" tabindex="-1"></a>objSDC <span class="ot">&lt;-</span> <span class="fu">createSdcObj</span>(<span class="at">dat =</span> main_dataset, </span>
<span id="cb340-6"><a href="archives.html#cb340-6" tabindex="-1"></a>                       <span class="at">keyVars =</span> selectedKeyVars, <span class="at">weightVar =</span> weightVars)</span>
<span id="cb340-7"><a href="archives.html#cb340-7" tabindex="-1"></a></span>
<span id="cb340-8"><a href="archives.html#cb340-8" tabindex="-1"></a></span>
<span id="cb340-9"><a href="archives.html#cb340-9" tabindex="-1"></a><span class="fu">print</span>(objSDC, <span class="st">&quot;risk&quot;</span>)</span>
<span id="cb340-10"><a href="archives.html#cb340-10" tabindex="-1"></a></span>
<span id="cb340-11"><a href="archives.html#cb340-11" tabindex="-1"></a><span class="co">#Generate an internal report</span></span>
<span id="cb340-12"><a href="archives.html#cb340-12" tabindex="-1"></a><span class="co">#report(objSDC, filename = &quot;disclosure_risk_report&quot;,internal = T, verbose = TRUE) </span></span></code></pre></div>
</div>
</div>
<div id="analayis" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Analayis<a href="archives.html#analayis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hypegrammar" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> hypegrammaR<a href="archives.html#hypegrammar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>hypegrammaR follow the case mapping logic to compute analysis. It will also use the kobo questionnaire tool to help some of decision to be made.</p>
<p>This just load the information that will be need to conduct the analysis :</p>
<ul>
<li>dataset,</li>
<li>kobotool (questions and choices),</li>
<li>sample frame</li>
</ul>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="archives.html#cb341-1" tabindex="-1"></a><span class="fu">library</span>(hypegrammaR)</span>
<span id="cb341-2"><a href="archives.html#cb341-2" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb341-3"><a href="archives.html#cb341-3" tabindex="-1"></a><span class="fu">library</span>(surveyweights)</span>
<span id="cb341-4"><a href="archives.html#cb341-4" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb341-5"><a href="archives.html#cb341-5" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb341-6"><a href="archives.html#cb341-6" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb341-7"><a href="archives.html#cb341-7" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb341-8"><a href="archives.html#cb341-8" tabindex="-1"></a></span>
<span id="cb341-9"><a href="archives.html#cb341-9" tabindex="-1"></a><span class="co">#load dataset</span></span>
<span id="cb341-10"><a href="archives.html#cb341-10" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>,<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb341-11"><a href="archives.html#cb341-11" tabindex="-1"></a></span>
<span id="cb341-12"><a href="archives.html#cb341-12" tabindex="-1"></a><span class="co">#load kobotool</span></span>
<span id="cb341-13"><a href="archives.html#cb341-13" tabindex="-1"></a>questions <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;survey&quot;</span>)</span>
<span id="cb341-14"><a href="archives.html#cb341-14" tabindex="-1"></a>choices <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;choices&quot;</span>)</span>
<span id="cb341-15"><a href="archives.html#cb341-15" tabindex="-1"></a></span>
<span id="cb341-16"><a href="archives.html#cb341-16" tabindex="-1"></a><span class="co">#load sampling frame</span></span>
<span id="cb341-17"><a href="archives.html#cb341-17" tabindex="-1"></a>my_sampling_frame <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_GCA_Weights_26AUG2020.xlsx&quot;</span>, </span>
<span id="cb341-18"><a href="archives.html#cb341-18" tabindex="-1"></a>                             <span class="at">sheet =</span> <span class="st">&quot;for_r&quot;</span>)</span></code></pre></div>
<p>The questionnaire object is a list of function using the kobotool and dataset as input. For example, it will check if a given variable is a select multiple or not.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="archives.html#cb342-1" tabindex="-1"></a><span class="co">#create a questionnaire object</span></span>
<span id="cb342-2"><a href="archives.html#cb342-2" tabindex="-1"></a>my_questionnaire <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">load_questionnaire</span>(<span class="at">data =</span> main_dataset,</span>
<span id="cb342-3"><a href="archives.html#cb342-3" tabindex="-1"></a>                                    <span class="at">questions =</span> questions,</span>
<span id="cb342-4"><a href="archives.html#cb342-4" tabindex="-1"></a>                                    <span class="at">choices =</span> choices,</span>
<span id="cb342-5"><a href="archives.html#cb342-5" tabindex="-1"></a>                                    <span class="at">choices.label.column.to.use =</span> <span class="st">&quot;label::English&quot;</span>)</span></code></pre></div>
<p>The weighting function is created by the weighting_fun_from_samplinframe from the surveyweights package. It calculates the design weight based on the sampling frame and the dataset. The stratification names values used in the sampling frame and the dataset <strong>HAS</strong> to be the same.
What it does, it create a function that will calculate the weights based on your dataset.
<em>(It was defined as a function so it could re-calculate weights depending on the subset. however, the current guidelines is to keep the same design weights through all the assessement; the function still works for that case)</em></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="archives.html#cb343-1" tabindex="-1"></a><span class="co">#create a weigthing function</span></span>
<span id="cb343-2"><a href="archives.html#cb343-2" tabindex="-1"></a>my_weigthing_function <span class="ot">&lt;-</span> surveyweights<span class="sc">::</span><span class="fu">weighting_fun_from_samplingframe</span>(<span class="at">sampling.frame =</span> my_sampling_frame,</span>
<span id="cb343-3"><a href="archives.html#cb343-3" tabindex="-1"></a>                                                                      <span class="at">data.stratum.column =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb343-4"><a href="archives.html#cb343-4" tabindex="-1"></a>                                                                      <span class="at">sampling.frame.population.column =</span> <span class="st">&quot;population&quot;</span>, </span>
<span id="cb343-5"><a href="archives.html#cb343-5" tabindex="-1"></a>                                                                      <span class="at">sampling.frame.stratum.column =</span> <span class="st">&quot;strata&quot;</span>, </span>
<span id="cb343-6"><a href="archives.html#cb343-6" tabindex="-1"></a>                                                                      <span class="at">data =</span> main_dataset)</span></code></pre></div>
<p>If you want to add the weights to your dataframe this is how you can do it.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="archives.html#cb344-1" tabindex="-1"></a><span class="co">#optional, if you want to add the weights into the dataset.</span></span>
<span id="cb344-2"><a href="archives.html#cb344-2" tabindex="-1"></a>main_dataset<span class="sc">$</span>stratum.weight <span class="ot">&lt;-</span> <span class="fu">my_weigthing_function</span>(main_dataset)</span></code></pre></div>
<p>hypegrammaR uses cases to choose what type analysis to do. A “case” for hypegrammaR is a character string CASE_XXXX_YYYY_ZZZZ where :</p>
<ul>
<li>XXXX: hypothesis type (group_difference, direct_reporting)<br />
</li>
<li>YYYY: dependent var type (categorical, numerical)<br />
</li>
<li>ZZZZ: independent var type (categorical, numerical, <em>empty</em> if no independent variable) .</li>
</ul>
<p>All cases implemented can been seen with this code.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="archives.html#cb345-1" tabindex="-1"></a>hypegrammaR<span class="sc">:::</span><span class="fu">list_all_cases</span>(<span class="at">implemented_only =</span> T)</span></code></pre></div>
<p>If you want to know what are the different proportion of the displacement status for each strata. The following information I need are:
hypothesis : group_difference<br />
dependent variable : d1_hh_displacement_status -&gt; categorical<br />
independent_variable : strata -&gt; categorical</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="archives.html#cb346-1" tabindex="-1"></a><span class="co">#analysis </span></span>
<span id="cb346-2"><a href="archives.html#cb346-2" tabindex="-1"></a>my_case <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">map_to_case</span>(<span class="at">hypothesis.type =</span> <span class="st">&quot;group_difference&quot;</span>,</span>
<span id="cb346-3"><a href="archives.html#cb346-3" tabindex="-1"></a>                       <span class="at">dependent.var.type =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb346-4"><a href="archives.html#cb346-4" tabindex="-1"></a>                       <span class="at">independent.var.type =</span> <span class="st">&quot;categorical&quot;</span>)</span>
<span id="cb346-5"><a href="archives.html#cb346-5" tabindex="-1"></a></span>
<span id="cb346-6"><a href="archives.html#cb346-6" tabindex="-1"></a>my_case</span></code></pre></div>
<p>The function map_to_result will calculate your summary statistics, it will take a couple of arguments.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="archives.html#cb347-1" tabindex="-1"></a>my_results <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">map_to_result</span>(<span class="at">data =</span> main_dataset, </span>
<span id="cb347-2"><a href="archives.html#cb347-2" tabindex="-1"></a>                            <span class="at">dependent.var =</span> <span class="st">&quot;d1_hh_displacement_status&quot;</span>, </span>
<span id="cb347-3"><a href="archives.html#cb347-3" tabindex="-1"></a>                            <span class="at">independent.var =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb347-4"><a href="archives.html#cb347-4" tabindex="-1"></a>                            <span class="at">case =</span> my_case, </span>
<span id="cb347-5"><a href="archives.html#cb347-5" tabindex="-1"></a>                            <span class="at">weighting =</span> my_weigthing_function,</span>
<span id="cb347-6"><a href="archives.html#cb347-6" tabindex="-1"></a>                            <span class="at">questionnaire =</span> my_questionnaire,</span>
<span id="cb347-7"><a href="archives.html#cb347-7" tabindex="-1"></a>                            <span class="at">confidence_level =</span> .<span class="dv">90</span>)</span></code></pre></div>
<p>The result object is a list with several information:</p>
<ul>
<li>parameters: returns the information used of that analysis</li>
<li>summary statistics: returns the summary statistics in a tidy format</li>
<li>hypothesis test: returns hypothesis testing information (if avalaible)</li>
<li>message: returns a message (if the analysis went well or not)</li>
</ul>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="archives.html#cb348-1" tabindex="-1"></a>my_results<span class="sc">$</span>summary.statistic <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<p>If you need to run several analysis, you can use a data analysis plan (DAP) file which is a file that comprises of the following columns:</p>
<ul>
<li>dependent.variable: name of the dependent variable (kobo name, column name)<br />
</li>
<li>dependent.variable.type: type of the dependent variable (categorical or numerical or empty)<br />
</li>
<li>independent.variable: name of the independent variable (kobo name, column name)<br />
</li>
<li>independent.variable.type: type of the independent variable (categorical or numerical or empty)<br />
</li>
<li>repeat.for.variable: name of the variable to repeat the analysis for (e.g per camp or district or governorate)<br />
</li>
<li>hypothesis.type: type of hypothesis (group_difference, direct_reporting)</li>
<li>you can have other columns to help you write the analysis plan such as RQ and sub RQ</li>
</ul>
<p><strong>You cannot have duplicate columns</strong></p>
<p>Below, I am creating the DAP, but you could read a csv file. It has :</p>
<ul>
<li>2 categorical variables, (select multiple type in kobo), <em>l4_which_difficult_access_health</em> and <em>j10_education_security_concerns_in_the_vicinity_of_facility</em></li>
<li>2 categorical variables, (select one type in kobo), <em>b9_hohh_marital_status</em> and <em>d1_hh_displacement_status</em>,</li>
<li>2 numerical variables (integer type in kobo): <em>b7_hohh_age</em> and <em>b5_age</em></li>
</ul>
<p>It will repeat the analysis 3 times for each dependent variable:</p>
<ul>
<li>using the <em>strata</em> variable as independent variable (first 6 rows),</li>
<li>using no independent variable, for the complete dataset (national level?), (second 6 rows),</li>
<li>using the <em>b9_hohh_marital_status</em> as independent variable but repeating each strata (last 6 rows)</li>
</ul>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="archives.html#cb349-1" tabindex="-1"></a><span class="co">#dap </span></span>
<span id="cb349-2"><a href="archives.html#cb349-2" tabindex="-1"></a>my_dap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">dependent.variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>, <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>, <span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb349-3"><a href="archives.html#cb349-3" tabindex="-1"></a>                 <span class="st">&quot;b5_age&quot;</span>, <span class="st">&quot;b9_hohh_marital_status&quot;</span>,</span>
<span id="cb349-4"><a href="archives.html#cb349-4" tabindex="-1"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>), <span class="dv">2</span>), <span class="fu">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>, <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>, <span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb349-5"><a href="archives.html#cb349-5" tabindex="-1"></a>                 <span class="st">&quot;b5_age&quot;</span>,</span>
<span id="cb349-6"><a href="archives.html#cb349-6" tabindex="-1"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>)),</span>
<span id="cb349-7"><a href="archives.html#cb349-7" tabindex="-1"></a>                     <span class="at">dependent.variable.type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>),<span class="dv">2</span>),<span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;categorical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;numerical&quot;</span>, <span class="st">&quot;categorical&quot;</span>),</span>
<span id="cb349-8"><a href="archives.html#cb349-8" tabindex="-1"></a>                     <span class="at">independent.variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;strata&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;b9_hohh_marital_status&quot;</span>, <span class="dv">5</span>)),</span>
<span id="cb349-9"><a href="archives.html#cb349-9" tabindex="-1"></a>                     <span class="at">independent.variable.type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;categorical&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;categorical&quot;</span>, <span class="dv">5</span>)), </span>
<span id="cb349-10"><a href="archives.html#cb349-10" tabindex="-1"></a>                     <span class="at">hypothesis.type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;group_difference&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;direct_reporting&quot;</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;group_difference&quot;</span>, <span class="dv">5</span>)), </span>
<span id="cb349-11"><a href="archives.html#cb349-11" tabindex="-1"></a>                     <span class="at">repeat.for.variable =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">12</span>), <span class="fu">rep</span>(<span class="st">&quot;strata&quot;</span>, <span class="dv">5</span>))</span>
<span id="cb349-12"><a href="archives.html#cb349-12" tabindex="-1"></a>                     )</span>
<span id="cb349-13"><a href="archives.html#cb349-13" tabindex="-1"></a></span>
<span id="cb349-14"><a href="archives.html#cb349-14" tabindex="-1"></a></span>
<span id="cb349-15"><a href="archives.html#cb349-15" tabindex="-1"></a>my_dap </span></code></pre></div>
<p>To use a DAP, you need to use the function <strong>from_analysisplan_map_to_output</strong> instead of the combination of <strong>map_to_case</strong> and <strong>map_to_result</strong>. It will look for the case itself. <strong>from_analysisplan_map_to_output</strong> a list of list of results. So you need to wriggle a bit around to come to a master dataframe.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="archives.html#cb350-1" tabindex="-1"></a>my_results <span class="ot">&lt;-</span> hypegrammaR<span class="sc">::</span><span class="fu">from_analysisplan_map_to_output</span>(<span class="at">data =</span>main_dataset,</span>
<span id="cb350-2"><a href="archives.html#cb350-2" tabindex="-1"></a>                                <span class="at">analysisplan =</span> my_dap,</span>
<span id="cb350-3"><a href="archives.html#cb350-3" tabindex="-1"></a>                                <span class="at">weighting =</span> my_weigthing_function,</span>
<span id="cb350-4"><a href="archives.html#cb350-4" tabindex="-1"></a>                                <span class="at">questionnaire =</span> my_questionnaire,</span>
<span id="cb350-5"><a href="archives.html#cb350-5" tabindex="-1"></a>                                <span class="at">confidence_level =</span> .<span class="dv">90</span>)</span>
<span id="cb350-6"><a href="archives.html#cb350-6" tabindex="-1"></a></span>
<span id="cb350-7"><a href="archives.html#cb350-7" tabindex="-1"></a>long_table <span class="ot">&lt;-</span> my_results<span class="sc">$</span>results <span class="sc">%&gt;%</span> </span>
<span id="cb350-8"><a href="archives.html#cb350-8" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) x[[<span class="st">&quot;summary.statistic&quot;</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb350-9"><a href="archives.html#cb350-9" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, .)</span></code></pre></div>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="archives.html#cb351-1" tabindex="-1"></a>long_table <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
</div>
<div id="butter-survey_collapse" class="section level3 hasAnchor" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> butteR survey_collapse<a href="archives.html#butter-survey_collapse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The survey_collapse function available in butteR aggregates both categorical and numerical columns of a srvyr object. It provides a standardized format output that includes mean/pct mean (point estimates), and the upper/lower confidence intervals along with the unweighted number/frequency for each response option. The survey_collapse function is built around the great srvyr package. The srvyr package is a more modern/tidyverse style wrapper for the survey package. Both the srvyr and survye packages are great and there use is highligh encouraged.</p>
<p>The main advantages of survey_collapse</p>
<ol style="list-style-type: decimal">
<li>The standardized output produced</li>
<li>Ability to analyze both categorical and numerical columns with a consistent syntax</li>
<li>Batch analyses and ability to perform many different subsetting investigations with ease</li>
</ol>
<p>Below is an example of its use.</p>
<p>First we must read in some data and make it into a srvyr object</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="archives.html#cb352-1" tabindex="-1"></a><span class="do">###makes some additions. </span></span>
<span id="cb352-2"><a href="archives.html#cb352-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb352-3"><a href="archives.html#cb352-3" tabindex="-1"></a><span class="fu">library</span>(butteR)</span>
<span id="cb352-4"><a href="archives.html#cb352-4" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb352-5"><a href="archives.html#cb352-5" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb352-6"><a href="archives.html#cb352-6" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span>
<span id="cb352-7"><a href="archives.html#cb352-7" tabindex="-1"></a>dfsvy<span class="ot">&lt;-</span><span class="fu">as_survey</span>(df)</span></code></pre></div>
<p>For the purpose of the example I next choose a variety of different column types to analyze. As you can see I have selected select_one (categorical), select_multiple (binary categorical), and numerical columns. I then put these all into one vector.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="archives.html#cb353-1" tabindex="-1"></a><span class="co"># here are some random concatenated select multiple parent questions</span></span>
<span id="cb353-2"><a href="archives.html#cb353-2" tabindex="-1"></a>select_multiple_parent_cols<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;l4_which_difficult_access_health&quot;</span>,</span>
<span id="cb353-3"><a href="archives.html#cb353-3" tabindex="-1"></a>                        <span class="st">&quot;j10_education_security_concerns_in_the_vicinity_of_facility&quot;</span>)</span>
<span id="cb353-4"><a href="archives.html#cb353-4" tabindex="-1"></a>numeric_cols<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b7_hohh_age&quot;</span>,</span>
<span id="cb353-5"><a href="archives.html#cb353-5" tabindex="-1"></a>                 <span class="st">&quot;b5_age&quot;</span>)</span>
<span id="cb353-6"><a href="archives.html#cb353-6" tabindex="-1"></a>select_one_cols<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b9_hohh_marital_status&quot;</span>,</span>
<span id="cb353-7"><a href="archives.html#cb353-7" tabindex="-1"></a>                    <span class="st">&quot;d1_hh_displacement_status&quot;</span>)</span>
<span id="cb353-8"><a href="archives.html#cb353-8" tabindex="-1"></a>mixed_columns<span class="ot">&lt;-</span> <span class="fu">c</span>(select_multiple_parent_cols, numeric_cols, select_one_cols)</span></code></pre></div>
<p>A nice feature of the standardized output produced by survey_collapse is that you can perform variety of different types of analyses and then bind them together into one dataframe/tibble.</p>
<p>Therefore I fill an empty list with analysis to facilitate binding later. For the first analyses I simply aggregate all the columns specified as mean/pct mean. I next analyze the same variable but this time subset/disaggreated by the strata column. It’s a good idea to mutate an extra column indicating what exact analysis was done so that when they are binded together later they can more easily be manipulated</p>
<p><strong>note: I am commenting this section as it seems to break with the latest update</strong></p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="archives.html#cb354-1" tabindex="-1"></a>outputs<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb354-2"><a href="archives.html#cb354-2" tabindex="-1"></a></span>
<span id="cb354-3"><a href="archives.html#cb354-3" tabindex="-1"></a>outputs<span class="sc">$</span>overall<span class="ot">&lt;-</span>butteR<span class="sc">::</span><span class="fu">survey_collapse</span>(<span class="at">df =</span> dfsvy,<span class="at">vars_to_analyze =</span> mixed_columns) <span class="sc">%&gt;%</span></span>
<span id="cb354-4"><a href="archives.html#cb354-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">analysis_level=</span> <span class="st">&quot;overall&quot;</span>)</span>
<span id="cb354-5"><a href="archives.html#cb354-5" tabindex="-1"></a></span>
<span id="cb354-6"><a href="archives.html#cb354-6" tabindex="-1"></a>outputs<span class="sc">$</span>strata<span class="ot">&lt;-</span>butteR<span class="sc">::</span><span class="fu">survey_collapse</span>(<span class="at">df =</span> dfsvy,<span class="at">vars_to_analyze =</span> mixed_columns,<span class="at">disag =</span> <span class="st">&quot;strata&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb354-7"><a href="archives.html#cb354-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">analysis_level=</span> <span class="st">&quot;strata&quot;</span>)</span></code></pre></div>
<p>Here is an example of what the long format data looks like as a table.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="archives.html#cb355-1" tabindex="-1"></a>outputs<span class="sc">$</span>strata <span class="sc">%&gt;%</span></span>
<span id="cb355-2"><a href="archives.html#cb355-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb355-3"><a href="archives.html#cb355-3" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb355-4"><a href="archives.html#cb355-4" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size=</span><span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb355-5"><a href="archives.html#cb355-5" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="at">box_css =</span> <span class="st">&quot;border: 0px;&quot;</span>)</span></code></pre></div>
<p>This is a great format for manipulating/filtering and then graphing with ggplot</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="archives.html#cb356-1" tabindex="-1"></a>output_df<span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(outputs)</span>
<span id="cb356-2"><a href="archives.html#cb356-2" tabindex="-1"></a></span>
<span id="cb356-3"><a href="archives.html#cb356-3" tabindex="-1"></a>output_df <span class="sc">%&gt;%</span></span>
<span id="cb356-4"><a href="archives.html#cb356-4" tabindex="-1"></a>  <span class="fu">filter</span>(analysis_level<span class="sc">==</span><span class="st">&quot;overall&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-5"><a href="archives.html#cb356-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">question_val=</span> <span class="fu">paste0</span>(variable,<span class="st">&quot;.&quot;</span>,variable_val)) <span class="sc">%&gt;%</span></span>
<span id="cb356-6"><a href="archives.html#cb356-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> question_val,<span class="at">y=</span> <span class="st">`</span><span class="at">mean/pct</span><span class="st">`</span>))<span class="sc">+</span></span>
<span id="cb356-7"><a href="archives.html#cb356-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>))<span class="sc">+</span></span>
<span id="cb356-8"><a href="archives.html#cb356-8" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span> <span class="st">`</span><span class="at">mean/pct_low</span><span class="st">`</span>, <span class="at">ymax=</span> <span class="st">`</span><span class="at">mean/pct_upp</span><span class="st">`</span>),</span>
<span id="cb356-9"><a href="archives.html#cb356-9" tabindex="-1"></a>                <span class="at">width=</span><span class="fl">0.2</span>,<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>))<span class="sc">+</span></span>
<span id="cb356-10"><a href="archives.html#cb356-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent,<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb356-11"><a href="archives.html#cb356-11" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb356-12"><a href="archives.html#cb356-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb356-13"><a href="archives.html#cb356-13" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb356-14"><a href="archives.html#cb356-14" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb356-15"><a href="archives.html#cb356-15" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">90</span>),</span>
<span id="cb356-16"><a href="archives.html#cb356-16" tabindex="-1"></a>    <span class="at">legend.title=</span> <span class="fu">element_blank</span>()</span>
<span id="cb356-17"><a href="archives.html#cb356-17" tabindex="-1"></a>  )</span>
<span id="cb356-18"><a href="archives.html#cb356-18" tabindex="-1"></a></span>
<span id="cb356-19"><a href="archives.html#cb356-19" tabindex="-1"></a></span>
<span id="cb356-20"><a href="archives.html#cb356-20" tabindex="-1"></a><span class="co"># Easy to plot subset findings as well!</span></span>
<span id="cb356-21"><a href="archives.html#cb356-21" tabindex="-1"></a>output_df <span class="sc">%&gt;%</span></span>
<span id="cb356-22"><a href="archives.html#cb356-22" tabindex="-1"></a>  <span class="fu">filter</span>(analysis_level<span class="sc">==</span><span class="st">&quot;strata&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-23"><a href="archives.html#cb356-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">question_val=</span> <span class="fu">paste0</span>(variable,<span class="st">&quot;.&quot;</span>,variable_val)) <span class="sc">%&gt;%</span></span>
<span id="cb356-24"><a href="archives.html#cb356-24" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> question_val,<span class="at">y=</span> <span class="st">`</span><span class="at">mean/pct</span><span class="st">`</span>, <span class="at">color=</span>subset_1_val))<span class="sc">+</span></span>
<span id="cb356-25"><a href="archives.html#cb356-25" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>))<span class="sc">+</span></span>
<span id="cb356-26"><a href="archives.html#cb356-26" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span> <span class="st">`</span><span class="at">mean/pct_low</span><span class="st">`</span>, <span class="at">ymax=</span> <span class="st">`</span><span class="at">mean/pct_upp</span><span class="st">`</span>),</span>
<span id="cb356-27"><a href="archives.html#cb356-27" tabindex="-1"></a>                <span class="at">width=</span><span class="fl">0.2</span>,<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>))<span class="sc">+</span></span>
<span id="cb356-28"><a href="archives.html#cb356-28" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent,<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>))<span class="sc">+</span></span>
<span id="cb356-29"><a href="archives.html#cb356-29" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb356-30"><a href="archives.html#cb356-30" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb356-31"><a href="archives.html#cb356-31" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb356-32"><a href="archives.html#cb356-32" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb356-33"><a href="archives.html#cb356-33" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">90</span>),</span>
<span id="cb356-34"><a href="archives.html#cb356-34" tabindex="-1"></a>    <span class="at">legend.title=</span> <span class="fu">element_blank</span>()</span>
<span id="cb356-35"><a href="archives.html#cb356-35" tabindex="-1"></a>  )</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="miscellaneous.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
