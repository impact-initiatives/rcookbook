<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Analysis | R cookbook for analysis with IMPACT</title>
  <meta name="description" content="7 Analysis | R cookbook for analysis with IMPACT" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Analysis | R cookbook for analysis with IMPACT" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Analysis | R cookbook for analysis with IMPACT" />
  
  
  

<meta name="author" content="R Squad" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="composite-indicators.html"/>
<link rel="next" href="outputs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello</a></li>
<li class="chapter" data-level="2" data-path="meta-information.html"><a href="meta-information.html"><i class="fa fa-check"></i><b>2</b> Meta information</a>
<ul>
<li class="chapter" data-level="2.1" data-path="meta-information.html"><a href="meta-information.html#creating-the-questionnaire-object"><i class="fa fa-check"></i><b>2.1</b> Creating the questionnaire object</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html"><i class="fa fa-check"></i><b>3</b> Downloading data from kobo server</a>
<ul>
<li class="chapter" data-level="3.1" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#defining-the-needed-functions"><i class="fa fa-check"></i><b>3.1</b> Defining the needed functions</a></li>
<li class="chapter" data-level="3.2" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#creating-data-url-and-credentials-variables"><i class="fa fa-check"></i><b>3.2</b> Creating data url and credentials variables</a></li>
<li class="chapter" data-level="3.3" data-path="downloading-data-from-kobo-server.html"><a href="downloading-data-from-kobo-server.html#fetching-the-data-from-the-server"><i class="fa fa-check"></i><b>3.3</b> Fetching the data from the server</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pre-analysis.html"><a href="pre-analysis.html"><i class="fa fa-check"></i><b>4</b> Pre analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="pre-analysis.html"><a href="pre-analysis.html#checking-the-xls-kobo-tools-for-constraints-errors"><i class="fa fa-check"></i><b>4.1</b> Checking the XLS kobo tools for constraints errors</a></li>
<li class="chapter" data-level="4.2" data-path="pre-analysis.html"><a href="pre-analysis.html#sampling"><i class="fa fa-check"></i><b>4.2</b> Sampling</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="pre-analysis.html"><a href="pre-analysis.html#simple-random-sampling"><i class="fa fa-check"></i><b>4.2.1</b> Simple Random sampling</a></li>
<li class="chapter" data-level="4.2.2" data-path="pre-analysis.html"><a href="pre-analysis.html#stratified-random-sampling"><i class="fa fa-check"></i><b>4.2.2</b> Stratified Random sampling</a></li>
<li class="chapter" data-level="4.2.3" data-path="pre-analysis.html"><a href="pre-analysis.html#cluster-sampling"><i class="fa fa-check"></i><b>4.2.3</b> Cluster sampling</a></li>
<li class="chapter" data-level="4.2.4" data-path="pre-analysis.html"><a href="pre-analysis.html#stages-random-sampling"><i class="fa fa-check"></i><b>4.2.4</b> 2 stages random sampling</a></li>
<li class="chapter" data-level="4.2.5" data-path="pre-analysis.html"><a href="pre-analysis.html#sample-distribution-usin-population-raster"><i class="fa fa-check"></i><b>4.2.5</b> Sample distribution usin population raster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html"><i class="fa fa-check"></i><b>5</b> Data Collection and Processing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#testing-the-tool"><i class="fa fa-check"></i><b>5.1</b> Testing the tool</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#creating-dummy-data"><i class="fa fa-check"></i><b>5.1.1</b> Creating dummy data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#download-data"><i class="fa fa-check"></i><b>5.2</b> Download data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#downloading-audit-files-using-audit_url"><i class="fa fa-check"></i><b>5.2.1</b> Downloading Audit files using audit_URL</a></li>
<li class="chapter" data-level="5.2.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#download-audit-files-using-form-name"><i class="fa fa-check"></i><b>5.2.2</b> Download audit files using form name</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-collection-follow-up"><i class="fa fa-check"></i><b>5.3</b> Data collection follow-up</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#checking-surveys-against-the-sampling-frame"><i class="fa fa-check"></i><b>5.3.1</b> checking surveys against the sampling frame</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-falsification"><i class="fa fa-check"></i><b>5.4</b> Data falsification</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time-in-the-dataset"><i class="fa fa-check"></i><b>5.4.1</b> Check for time (in the dataset)</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time-audit-files"><i class="fa fa-check"></i><b>5.4.2</b> Check for time (audit files)</a></li>
<li class="chapter" data-level="5.4.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-time---calculating-the-elapsed-time-between-each-interview"><i class="fa fa-check"></i><b>5.4.3</b> Check for time - calculating the elapsed time between each interview</a></li>
<li class="chapter" data-level="5.4.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#silouhette-analysis"><i class="fa fa-check"></i><b>5.4.4</b> Silouhette analysis</a></li>
<li class="chapter" data-level="5.4.5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-duplicates"><i class="fa fa-check"></i><b>5.4.5</b> Check for duplicates</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-checks"><i class="fa fa-check"></i><b>5.5</b> Data checks</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-outliers"><i class="fa fa-check"></i><b>5.5.1</b> Check for outliers</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-others"><i class="fa fa-check"></i><b>5.5.2</b> Check others</a></li>
<li class="chapter" data-level="5.5.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#issue-log-function"><i class="fa fa-check"></i><b>5.5.3</b> Issue log Function</a></li>
<li class="chapter" data-level="5.5.4" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-logical-check"><i class="fa fa-check"></i><b>5.5.4</b> Check for logical check</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#cleaninginspector---inspect_all"><i class="fa fa-check"></i><b>5.6</b> cleaninginspectoR - inspect_all</a></li>
<li class="chapter" data-level="5.7" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-cleaning"><i class="fa fa-check"></i><b>5.7</b> Data cleaning</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#re-generate-text-column-for-select-multiple-questions"><i class="fa fa-check"></i><b>5.7.1</b> Re-generate text column for select multiple questions</a></li>
<li class="chapter" data-level="5.7.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#clean-data-base-on-cleaning-log"><i class="fa fa-check"></i><b>5.7.2</b> Clean data base on cleaning log</a></li>
<li class="chapter" data-level="5.7.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-cleaning-log-raw-dataset-and-clean-dataset"><i class="fa fa-check"></i><b>5.7.3</b> Check cleaning log, raw dataset and clean dataset</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#data-cleaning---miscellaneous"><i class="fa fa-check"></i><b>5.8</b> Data cleaning - miscellaneous</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#check-for-data-sanity-check-if-the-data-follow-odk-format-select_one-select_multiple-xxx-choices"><i class="fa fa-check"></i><b>5.8.1</b> Check for data sanity check if the data follow ODK format (select_one, select_multiple, xxx, choices)</a></li>
<li class="chapter" data-level="5.8.2" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#turns-label-to-xml"><i class="fa fa-check"></i><b>5.8.2</b> Turns label to xml</a></li>
<li class="chapter" data-level="5.8.3" data-path="data-collection-and-processing.html"><a href="data-collection-and-processing.html#statistical-disclosure-control-methods"><i class="fa fa-check"></i><b>5.8.3</b> Statistical Disclosure Control Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="composite-indicators.html"><a href="composite-indicators.html"><i class="fa fa-check"></i><b>6</b> Composite indicators</a>
<ul>
<li class="chapter" data-level="6.1" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-one"><i class="fa fa-check"></i><b>6.1</b> Composite with 1 categorical variable - select one</a></li>
<li class="chapter" data-level="6.2" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-categorical-variables"><i class="fa fa-check"></i><b>6.2</b> Composite with 2 categorical variables</a></li>
<li class="chapter" data-level="6.3" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-categorical-variable---select-multiple"><i class="fa fa-check"></i><b>6.3</b> Composite with 1 categorical variable - select multiple</a></li>
<li class="chapter" data-level="6.4" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-1-numerical-variable"><i class="fa fa-check"></i><b>6.4</b> Composite with 1 numerical variable</a></li>
<li class="chapter" data-level="6.5" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-numerical-variables"><i class="fa fa-check"></i><b>6.5</b> Composite with 2 numerical variables</a></li>
<li class="chapter" data-level="6.6" data-path="composite-indicators.html"><a href="composite-indicators.html#composite-with-2-or-more-numerical-variables"><i class="fa fa-check"></i><b>6.6</b> Composite with 2 or more numerical variables</a></li>
<li class="chapter" data-level="6.7" data-path="composite-indicators.html"><a href="composite-indicators.html#new-indicators-from-a-loop-to-main-dataset"><i class="fa fa-check"></i><b>6.7</b> New indicators from a loop to main dataset</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>7</b> Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysis.html"><a href="analysis.html#srvyr-package"><i class="fa fa-check"></i><b>7.1</b> srvyr package</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="analysis.html"><a href="analysis.html#categorical-variables"><i class="fa fa-check"></i><b>7.1.1</b> Categorical variables</a></li>
<li class="chapter" data-level="7.1.2" data-path="analysis.html"><a href="analysis.html#numeric-variables"><i class="fa fa-check"></i><b>7.1.2</b> Numeric variables</a></li>
<li class="chapter" data-level="7.1.3" data-path="analysis.html"><a href="analysis.html#select_one"><i class="fa fa-check"></i><b>7.1.3</b> select_one</a></li>
<li class="chapter" data-level="7.1.4" data-path="analysis.html"><a href="analysis.html#select_mutiple"><i class="fa fa-check"></i><b>7.1.4</b> select_mutiple</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="analysis.html"><a href="analysis.html#analysis-with-numerical-variables"><i class="fa fa-check"></i><b>7.2</b> Analysis with numerical variables</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="analysis.html"><a href="analysis.html#averages"><i class="fa fa-check"></i><b>7.2.1</b> Averages</a></li>
<li class="chapter" data-level="7.2.2" data-path="analysis.html"><a href="analysis.html#median"><i class="fa fa-check"></i><b>7.2.2</b> Median</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="analysis.html"><a href="analysis.html#ratios"><i class="fa fa-check"></i><b>7.3</b> Ratios</a>
<ul>
<li><a href="analysis.html#example1" id="toc-example1"><span class="toc-section-number">7.3.1</span> Example1:<br />
</a></li>
<li><a href="analysis.html#example2---analyzing-multiple-questions-and-combine-the-output" id="toc-example2---analyzing-multiple-questions-and-combine-the-output"><span class="toc-section-number">7.3.2</span> Example2 - Analyzing multiple questions and combine the output:<br />
</a></li>
<li><a href="analysis.html#example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted" id="toc-example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted"><span class="toc-section-number">7.3.3</span> Example3 - No dissagregation is needed and/or the data is not weighted:<br />
</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="analysis.html"><a href="analysis.html#weights"><i class="fa fa-check"></i><b>7.4</b> Weights</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="analysis.html"><a href="analysis.html#tidyverse"><i class="fa fa-check"></i><b>7.4.1</b> tidyverse</a></li>
<li class="chapter" data-level="7.4.2" data-path="analysis.html"><a href="analysis.html#surveyweights"><i class="fa fa-check"></i><b>7.4.2</b> surveyweights</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="analysis.html"><a href="analysis.html#impactr-based-on-srvyr"><i class="fa fa-check"></i><b>7.5</b> impactR, based on <code>srvyr</code></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="analysis.html"><a href="analysis.html#introduction"><i class="fa fa-check"></i><b>7.5.1</b> Introduction</a></li>
<li class="chapter" data-level="7.5.2" data-path="analysis.html"><a href="analysis.html#first-stage-prepare-data-and-survey-design"><i class="fa fa-check"></i><b>7.5.2</b> First stage: prepare data and survey design</a></li>
<li class="chapter" data-level="7.5.3" data-path="analysis.html"><a href="analysis.html#second-stage-one-variable-analysis"><i class="fa fa-check"></i><b>7.5.3</b> Second stage: One variable analysis</a></li>
<li class="chapter" data-level="7.5.4" data-path="analysis.html"><a href="analysis.html#third-stage-one-analysis-at-a-time-with-the-kobo-tool"><i class="fa fa-check"></i><b>7.5.4</b> Third stage: one analysis at a time with the Kobo tool</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="analysis.html"><a href="analysis.html#example-survey-analysis-using-illuminate"><i class="fa fa-check"></i><b>7.6</b> EXAMPLE :: Survey analysis using illuminate</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="analysis.html"><a href="analysis.html#step-0-call-libraries"><i class="fa fa-check"></i><b>7.6.1</b> Step 0:: Call libraries</a></li>
<li class="chapter" data-level="7.6.2" data-path="analysis.html"><a href="analysis.html#step-1-read-data"><i class="fa fa-check"></i><b>7.6.2</b> Step 1:: Read data</a></li>
<li class="chapter" data-level="7.6.3" data-path="analysis.html"><a href="analysis.html#step-optional-preaparing-the-data"><i class="fa fa-check"></i><b>7.6.3</b> Step OPTIONAL:: Preaparing the data</a></li>
<li class="chapter" data-level="7.6.4" data-path="analysis.html"><a href="analysis.html#step-2-weight-calculation"><i class="fa fa-check"></i><b>7.6.4</b> Step 2:: Weight calculation</a></li>
<li class="chapter" data-level="7.6.5" data-path="analysis.html"><a href="analysis.html#read-sampleframe"><i class="fa fa-check"></i><b>7.6.5</b> Read sampleframe</a></li>
<li class="chapter" data-level="7.6.6" data-path="analysis.html"><a href="analysis.html#add-weights-to-the-dataframe"><i class="fa fa-check"></i><b>7.6.6</b> Add weights to the dataframe</a></li>
<li class="chapter" data-level="7.6.7" data-path="analysis.html"><a href="analysis.html#step-3.1-weighted-analysis"><i class="fa fa-check"></i><b>7.6.7</b> Step 3.1:: Weighted analysis</a></li>
<li class="chapter" data-level="7.6.8" data-path="analysis.html"><a href="analysis.html#step-3.2-unweighted-analysis"><i class="fa fa-check"></i><b>7.6.8</b> Step 3.2:: Unweighted analysis</a></li>
<li class="chapter" data-level="7.6.9" data-path="analysis.html"><a href="analysis.html#step-3.3-weighted-and-disaggregated-by-gender-analysis"><i class="fa fa-check"></i><b>7.6.9</b> Step 3.3:: Weighted and disaggregated by gender analysis</a></li>
<li class="chapter" data-level="7.6.10" data-path="analysis.html"><a href="analysis.html#step-4-export-with-write_formatted_excel"><i class="fa fa-check"></i><b>7.6.10</b> Step 4:: Export with <code>write_formatted_excel()</code></a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="analysis.html"><a href="analysis.html#repeating-the-above"><i class="fa fa-check"></i><b>7.7</b> Repeating the above</a></li>
<li class="chapter" data-level="7.8" data-path="analysis.html"><a href="analysis.html#analysis---top-x-ranking-select-one-and-select-multiple"><i class="fa fa-check"></i><b>7.8</b> Analysis - top X / ranking (select one and select multiple)</a></li>
<li class="chapter" data-level="7.9" data-path="analysis.html"><a href="analysis.html#borda-count"><i class="fa fa-check"></i><b>7.9</b> Borda count</a></li>
<li class="chapter" data-level="7.10" data-path="analysis.html"><a href="analysis.html#hypothesis-testing"><i class="fa fa-check"></i><b>7.10</b> Hypothesis testing</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="analysis.html"><a href="analysis.html#t-test"><i class="fa fa-check"></i><b>7.10.1</b> T-test</a></li>
<li class="chapter" data-level="7.10.2" data-path="analysis.html"><a href="analysis.html#anova"><i class="fa fa-check"></i><b>7.10.2</b> ANOVA</a></li>
<li class="chapter" data-level="7.10.3" data-path="analysis.html"><a href="analysis.html#chi-squares"><i class="fa fa-check"></i><b>7.10.3</b> chi-squares</a></li>
<li class="chapter" data-level="7.10.4" data-path="analysis.html"><a href="analysis.html#chi-squared-goodness-of-fit-test"><i class="fa fa-check"></i><b>7.10.4</b> Chi-squared Goodness of Fit test</a></li>
<li class="chapter" data-level="7.10.5" data-path="analysis.html"><a href="analysis.html#proportion-tests-z-test"><i class="fa fa-check"></i><b>7.10.5</b> Proportion tests (z-test)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>8</b> Outputs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="outputs.html"><a href="outputs.html#from-long-to-large-table"><i class="fa fa-check"></i><b>8.1</b> From long to large table</a></li>
<li class="chapter" data-level="8.2" data-path="outputs.html"><a href="outputs.html#merge-file"><i class="fa fa-check"></i><b>8.2</b> Merge file</a></li>
<li class="chapter" data-level="8.3" data-path="outputs.html"><a href="outputs.html#graphs"><i class="fa fa-check"></i><b>8.3</b> Graphs</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="outputs.html"><a href="outputs.html#spider-graphs"><i class="fa fa-check"></i><b>8.3.1</b> spider graphs</a></li>
<li class="chapter" data-level="8.3.2" data-path="outputs.html"><a href="outputs.html#prison-graphs"><i class="fa fa-check"></i><b>8.3.2</b> prison graphs</a></li>
<li class="chapter" data-level="8.3.3" data-path="outputs.html"><a href="outputs.html#bar-graphs"><i class="fa fa-check"></i><b>8.3.3</b> Bar graphs</a></li>
<li class="chapter" data-level="8.3.4" data-path="outputs.html"><a href="outputs.html#euler-diagram"><i class="fa fa-check"></i><b>8.3.4</b> Euler diagram</a></li>
<li class="chapter" data-level="8.3.5" data-path="outputs.html"><a href="outputs.html#venn-diagram"><i class="fa fa-check"></i><b>8.3.5</b> Venn diagram</a></li>
<li class="chapter" data-level="8.3.6" data-path="outputs.html"><a href="outputs.html#upset-plots"><i class="fa fa-check"></i><b>8.3.6</b> UpSet plots</a></li>
<li class="chapter" data-level="8.3.7" data-path="outputs.html"><a href="outputs.html#boxplots"><i class="fa fa-check"></i><b>8.3.7</b> boxplots</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="outputs.html"><a href="outputs.html#labels"><i class="fa fa-check"></i><b>8.4</b> Labels</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="outputs.html"><a href="outputs.html#xml-to-label"><i class="fa fa-check"></i><b>8.4.1</b> Xml to Label</a></li>
<li class="chapter" data-level="8.4.2" data-path="outputs.html"><a href="outputs.html#change-from-label-to-xml"><i class="fa fa-check"></i><b>8.4.2</b> change from label to xml</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="outputs.html"><a href="outputs.html#dashboarding---sharing-information"><i class="fa fa-check"></i><b>8.5</b> Dashboarding - Sharing information</a></li>
<li class="chapter" data-level="8.6" data-path="outputs.html"><a href="outputs.html#outputs-with-hypothesis-testing-results"><i class="fa fa-check"></i><b>8.6</b> Outputs with hypothesis testing results</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>9</b> Miscellaneous</a></li>
<li class="chapter" data-level="10" data-path="archives.html"><a href="archives.html"><i class="fa fa-check"></i><b>10</b> Archives</a>
<ul>
<li class="chapter" data-level="10.1" data-path="archives.html"><a href="archives.html#pre-analysis-1"><i class="fa fa-check"></i><b>10.1</b> 01 Pre analysis</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="archives.html"><a href="archives.html#generation-of-random-sample-points"><i class="fa fa-check"></i><b>10.1.1</b> Generation of random sample points</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="archives.html"><a href="archives.html#cleaning"><i class="fa fa-check"></i><b>10.2</b> Cleaning</a></li>
<li class="chapter" data-level="10.3" data-path="archives.html"><a href="archives.html#spatial-verification-checks"><i class="fa fa-check"></i><b>10.3</b> Spatial verification checks</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="archives.html"><a href="archives.html#spatial-verification-checks-on-settlement-level"><i class="fa fa-check"></i><b>10.3.1</b> Spatial verification checks on settlement level</a></li>
<li class="chapter" data-level="10.3.2" data-path="archives.html"><a href="archives.html#spatial-verification-checks-on-sample-point-level"><i class="fa fa-check"></i><b>10.3.2</b> Spatial verification checks on sample point level</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="archives.html"><a href="archives.html#analayis"><i class="fa fa-check"></i><b>10.4</b> Analayis</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="archives.html"><a href="archives.html#hypegrammar"><i class="fa fa-check"></i><b>10.4.1</b> hypegrammaR</a></li>
<li class="chapter" data-level="10.4.2" data-path="archives.html"><a href="archives.html#butter-survey_collapse"><i class="fa fa-check"></i><b>10.4.2</b> butteR survey_collapse</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R cookbook for analysis with IMPACT</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Analysis<a href="analysis.html#analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="srvyr-package" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> srvyr package<a href="analysis.html#srvyr-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The srvyr package aims to add dplyr like syntax to the survey package.” It is a very useful package for a variety of aggregations of survey data.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="analysis.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="do">###makes some additions. </span></span>
<span id="cb96-2"><a href="analysis.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb96-3"><a href="analysis.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb96-4"><a href="analysis.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb96-5"><a href="analysis.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb96-6"><a href="analysis.html#cb96-6" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span>
<span id="cb96-7"><a href="analysis.html#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="analysis.html#cb96-8" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb96-9"><a href="analysis.html#cb96-9" aria-hidden="true" tabindex="-1"></a>loop_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_loop_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb96-10"><a href="analysis.html#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="analysis.html#cb96-11" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="sc">~</span> <span class="sc">!</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(.x)) <span class="sc">|</span> <span class="fu">all</span>(. <span class="sc">==</span> <span class="st">&quot;&quot;</span>)))</span>
<span id="cb96-12"><a href="analysis.html#cb96-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-13"><a href="analysis.html#cb96-13" aria-hidden="true" tabindex="-1"></a>questions <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;survey&quot;</span>)</span>
<span id="cb96-14"><a href="analysis.html#cb96-14" aria-hidden="true" tabindex="-1"></a>choices <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;choices&quot;</span>)</span>
<span id="cb96-15"><a href="analysis.html#cb96-15" aria-hidden="true" tabindex="-1"></a>dfsvy<span class="ot">&lt;-</span><span class="fu">as_survey</span>(df)</span></code></pre></div>
<div id="categorical-variables" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Categorical variables<a href="analysis.html#categorical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>srvyr package allows categorical variables to be broken down using a similar syntax as dplyr. Using dplyr you might typically calculate a percent mean as follows:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="analysis.html#cb97-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="analysis.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(b9_hohh_marital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="analysis.html#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb97-4"><a href="analysis.html#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n=</span><span class="fu">n</span>()</span>
<span id="cb97-5"><a href="analysis.html#cb97-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb97-6"><a href="analysis.html#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb97-7"><a href="analysis.html#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb97-8"><a href="analysis.html#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_mean=</span>n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb97-9"><a href="analysis.html#cb97-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   b9_hohh_marital_status                        n pct_mean
##   &lt;chr&gt;                                     &lt;int&gt;    &lt;dbl&gt;
## 1 divorced                                    183   0.113 
## 2 married                                     677   0.419 
## 3 separated_married_but_not_living_together    37   0.0229
## 4 single                                      129   0.0798
## 5 unmarried_but_living_together                96   0.0594
## 6 widowed                                     495   0.306</code></pre>
<p>To calculate the percent mean of a categorical variable using srvyr object is required. The syntax is quite similar to dplyr, but a bit less verbose. By specifying the vartype as “ci” we also get the upper and lower confidence intervals</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="analysis.html#cb99-1" aria-hidden="true" tabindex="-1"></a>dfsvy <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="analysis.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(b9_hohh_marital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="analysis.html#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb99-4"><a href="analysis.html#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_mean =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb99-5"><a href="analysis.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   b9_hohh_marital_status                    pct_mean pct_mean_low pct_mean_upp
##   &lt;chr&gt;                                        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 divorced                                    0.113        0.0977       0.129 
## 2 married                                     0.419        0.395        0.443 
## 3 separated_married_but_not_living_together   0.0229       0.0156       0.0302
## 4 single                                      0.0798       0.0666       0.0930
## 5 unmarried_but_living_together               0.0594       0.0478       0.0709
## 6 widowed                                     0.306        0.284        0.329</code></pre>
<p>To calculate the weigthed percent mean of a multiple response option you need to created a srvyr object including the weights. The syntax is similar to dyplr and allows for the total columns</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="analysis.html#cb101-1" aria-hidden="true" tabindex="-1"></a>weighted_object <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> <span class="fu">as_survey_design</span>(<span class="at">ids =</span> X_uuid, <span class="at">weights =</span> stratum.weight)</span>
<span id="cb101-2"><a href="analysis.html#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="analysis.html#cb101-3" aria-hidden="true" tabindex="-1"></a>weighted_table <span class="ot">&lt;-</span> weighted_object <span class="sc">%&gt;%</span> </span>
<span id="cb101-4"><a href="analysis.html#cb101-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">group_by</span>(adm1NameLat) <span class="sc">%&gt;%</span> <span class="co">#group by categorical variable</span></span>
<span id="cb101-5"><a href="analysis.html#cb101-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b10_hohh_vulnerability.&quot;</span>)), survey_mean) <span class="sc">%&gt;%</span> <span class="co">#select multiple response question</span></span>
<span id="cb101-6"><a href="analysis.html#cb101-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb101-7"><a href="analysis.html#cb101-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">bind_rows</span>(</span>
<span id="cb101-8"><a href="analysis.html#cb101-8" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">summarise_at</span>(weighted_object,</span>
<span id="cb101-9"><a href="analysis.html#cb101-9" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b10_hohh_vulnerability.&quot;</span>)), survey_mean) <span class="co"># bind the total</span></span>
<span id="cb101-10"><a href="analysis.html#cb101-10" aria-hidden="true" tabindex="-1"></a>                  ) <span class="sc">%&gt;%</span></span>
<span id="cb101-11"><a href="analysis.html#cb101-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate_at</span>(<span class="fu">vars</span>(adm1NameLat), <span class="sc">~</span><span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="st">&quot;Total&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb101-12"><a href="analysis.html#cb101-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(., <span class="sc">-</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_se&quot;</span>))) <span class="sc">%&gt;%</span>  <span class="co">#remove the colums with the variance type calculations</span></span>
<span id="cb101-13"><a href="analysis.html#cb101-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> . <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-14"><a href="analysis.html#cb101-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">2</span>)</span>
<span id="cb101-15"><a href="analysis.html#cb101-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-16"><a href="analysis.html#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="analysis.html#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(weighted_table)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 11
##   adm1NameLat b10_hohh_vulnerability.no b10_hohh_vulnerability.disability_not_…¹
##   &lt;chr&gt;                           &lt;dbl&gt;                                    &lt;dbl&gt;
## 1 Donetska                         30.0                                     9.7 
## 2 Luhanska                         15.2                                     9.88
## 3 Total                            26.4                                     9.74
## # ℹ abbreviated name:
## #   ¹​b10_hohh_vulnerability.disability_not_including_chronic_illness
## # ℹ 8 more variables: b10_hohh_vulnerability.unemployed &lt;dbl&gt;,
## #   b10_hohh_vulnerability.veteran_of_war_ato &lt;dbl&gt;,
## #   b10_hohh_vulnerability.single_parent &lt;dbl&gt;,
## #   b10_hohh_vulnerability.family_with_3_or_more_children &lt;dbl&gt;,
## #   b10_hohh_vulnerability.family_with_foster_children &lt;dbl&gt;, …</code></pre>
</div>
<div id="numeric-variables" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Numeric variables<a href="analysis.html#numeric-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>srvyr treats the calculation/aggregation of numeric variables differently in an attempt to mirror dplyr syntax</p>
<p>to calculate the mean and median expenditure in dplyr you would likely do the following</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="analysis.html#cb103-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="analysis.html#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb103-3"><a href="analysis.html#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_expenditure=</span> <span class="fu">mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb103-4"><a href="analysis.html#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_expenditure=</span><span class="fu">median</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb103-5"><a href="analysis.html#cb103-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   mean_expenditure median_expenditure
##              &lt;dbl&gt;              &lt;dbl&gt;
## 1            5129.               4000</code></pre>
<p>If you wanted to subset this by another variable in dplyr you would add the group_by argument</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="analysis.html#cb105-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="analysis.html#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="analysis.html#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb105-4"><a href="analysis.html#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_expenditure=</span> <span class="fu">mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb105-5"><a href="analysis.html#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_expenditure=</span><span class="fu">median</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T),</span>
<span id="cb105-6"><a href="analysis.html#cb105-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   strata     mean_expenditure median_expenditure
##   &lt;chr&gt;                 &lt;dbl&gt;              &lt;dbl&gt;
## 1 20km_rural            5488.               4000
## 2 20km_urban            6208.               5000
## 3 5km_rural             3919.               3075
## 4 5km_urban             4942.               4000</code></pre>
<p>This is the reason why the syntax also varies between categorical and numeric variables in srvyr. Therefore, to do the same using srvyr you would do the following (with a survey object). Note that due to this difference in syntax the na.rm argument works for numeric variables, but <strong>does not work</strong> for categorical variables. This was modified when srvyr was updated from v 0.3.8</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="analysis.html#cb107-1" aria-hidden="true" tabindex="-1"></a>dfsvy <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="analysis.html#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb107-3"><a href="analysis.html#cb107-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">mean=</span> <span class="fu">survey_mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T,<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>),</span>
<span id="cb107-4"><a href="analysis.html#cb107-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    mean mean_low mean_upp
##   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 5129.    4891.    5367.</code></pre>
<p>similar to dplyr you can easily add a group_by argument to add a subset calculation</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="analysis.html#cb109-1" aria-hidden="true" tabindex="-1"></a>dfsvy <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="analysis.html#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="analysis.html#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb109-4"><a href="analysis.html#cb109-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">mean=</span> <span class="fu">survey_mean</span>(n1_HH_total_expenditure,<span class="at">na.rm=</span>T,<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>),</span>
<span id="cb109-5"><a href="analysis.html#cb109-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   strata      mean mean_low mean_upp
##   &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 20km_rural 5488.    4980.    5996.
## 2 20km_urban 6208.    5661.    6756.
## 3 5km_rural  3919.    3469.    4370.
## 4 5km_urban  4942.    4604.    5280.</code></pre>
</div>
<div id="select_one" class="section level3 hasAnchor" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> select_one<a href="analysis.html#select_one" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="select_mutiple" class="section level3 hasAnchor" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> select_mutiple<a href="analysis.html#select_mutiple" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
</div>
<div id="analysis-with-numerical-variables" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Analysis with numerical variables<a href="analysis.html#analysis-with-numerical-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="averages" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Averages<a href="analysis.html#averages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>###Summarytools (CRAN package)</p>
<p>###hypegrammaR / koboquest / butteR</p>
</div>
<div id="median" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Median<a href="analysis.html#median" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>####Spatstat
<a href="https://cran.r-project.org/web/packages/spatstat/index.html">Spatstat</a> - library with set of different functions for analyzing Spatial Point Patterns but also quite useful for analysis of weighted data.</p>
<p>At first let’s select all numerical variables from the dataset using Kobo questionnaire and dataset. It can be done with the following custom function:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="analysis.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span></code></pre></div>
<pre><code>## Warning: package &#39;spatstat&#39; was built under R version 4.2.3</code></pre>
<pre><code>## Loading required package: spatstat.data</code></pre>
<pre><code>## Warning: package &#39;spatstat.data&#39; was built under R version 4.2.3</code></pre>
<pre><code>## Loading required package: spatstat.geom</code></pre>
<pre><code>## Warning: package &#39;spatstat.geom&#39; was built under R version 4.2.3</code></pre>
<pre><code>## spatstat.geom 3.2-1</code></pre>
<pre><code>## 
## Attaching package: &#39;spatstat.geom&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:maditr&#39;:
## 
##     shift</code></pre>
<pre><code>## The following object is masked from &#39;package:grid&#39;:
## 
##     as.mask</code></pre>
<pre><code>## Loading required package: spatstat.random</code></pre>
<pre><code>## Warning: package &#39;spatstat.random&#39; was built under R version 4.2.3</code></pre>
<pre><code>## spatstat.random 3.1-5</code></pre>
<pre><code>## Loading required package: spatstat.explore</code></pre>
<pre><code>## Warning: package &#39;spatstat.explore&#39; was built under R version 4.2.3</code></pre>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## 
## Attaching package: &#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<pre><code>## spatstat.explore 3.2-1</code></pre>
<pre><code>## Loading required package: spatstat.model</code></pre>
<pre><code>## Loading required package: rpart</code></pre>
<pre><code>## spatstat.model 3.2-4</code></pre>
<pre><code>## 
## Attaching package: &#39;spatstat.model&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:expss&#39;:
## 
##     valid</code></pre>
<pre><code>## Loading required package: spatstat.linnet</code></pre>
<pre><code>## spatstat.linnet 3.1-1</code></pre>
<pre><code>## 
## spatstat 3.0-5 
## For an introduction to spatstat, type &#39;beginner&#39;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="analysis.html#cb138-1" aria-hidden="true" tabindex="-1"></a>select_numerical <span class="ot">&lt;-</span> <span class="cf">function</span>(dataset, kobo){</span>
<span id="cb138-2"><a href="analysis.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  kobo_questions <span class="ot">&lt;-</span> kobo[<span class="fu">grepl</span>(<span class="st">&quot;integer|decimal|calculate&quot;</span>, kobo<span class="sc">$</span>type),<span class="fu">c</span>(<span class="st">&quot;type&quot;</span>,<span class="st">&quot;name&quot;</span>)]</span>
<span id="cb138-3"><a href="analysis.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  names.use <span class="ot">&lt;-</span> <span class="fu">names</span>(dataset)[(<span class="fu">names</span>(dataset) <span class="sc">%in%</span> <span class="fu">as.character</span>(kobo_questions<span class="sc">$</span>name))]</span>
<span id="cb138-4"><a href="analysis.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  numerical <span class="ot">&lt;-</span> dataset[,<span class="fu">c</span>(names.use,<span class="st">&quot;X_uuid&quot;</span>,<span class="st">&#39;strata&#39;</span>,<span class="st">&#39;stratum.weight&#39;</span>)] <span class="co">#Here we can select any other relevant variables</span></span>
<span id="cb138-5"><a href="analysis.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  numerical[names.use] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(numerical[names.use], gsub, <span class="at">pattern =</span> <span class="st">&#39;NA&#39;</span>, <span class="at">replacement =</span> <span class="cn">NA</span>)</span>
<span id="cb138-6"><a href="analysis.html#cb138-6" aria-hidden="true" tabindex="-1"></a>  numerical[names.use] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(numerical[names.use], as.numeric)</span>
<span id="cb138-7"><a href="analysis.html#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(numerical)</span>
<span id="cb138-8"><a href="analysis.html#cb138-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb138-9"><a href="analysis.html#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="analysis.html#cb138-10" aria-hidden="true" tabindex="-1"></a>numerical_questions <span class="ot">&lt;-</span> <span class="fu">select_numerical</span>(main_dataset, questions)</span>
<span id="cb138-11"><a href="analysis.html#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="analysis.html#cb138-12" aria-hidden="true" tabindex="-1"></a>numerical_classes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(numerical_questions[,<span class="dv">1</span><span class="sc">:</span><span class="fu">c</span>(<span class="fu">ncol</span>(numerical_questions)<span class="sc">-</span><span class="dv">3</span>)], class) <span class="co">#Here we can check class of each selected variable</span></span>
<span id="cb138-13"><a href="analysis.html#cb138-13" aria-hidden="true" tabindex="-1"></a>numerical_classes <span class="ot">&lt;-</span> numerical_classes[<span class="st">&quot;character&quot;</span> <span class="sc">%in%</span> numerical_classes] <span class="co">#and here we check if any variable has class &quot;character&quot;</span></span>
<span id="cb138-14"><a href="analysis.html#cb138-14" aria-hidden="true" tabindex="-1"></a>numerical_questions <span class="ot">&lt;-</span> numerical_questions[ , <span class="sc">!</span><span class="fu">names</span>(numerical_questions) <span class="sc">%in%</span> numerical_classes] <span class="co">#if any variable has a character class then we remove it</span></span>
<span id="cb138-15"><a href="analysis.html#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(numerical_classes)<span class="co">#and here we removing vector with classes from our environment</span></span></code></pre></div>
<p>Now let’s calculate weighted median for “n1_HH_total_expenditure”.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="analysis.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.median</span>(numerical_questions<span class="sc">$</span>n1_HH_total_expenditure, numerical_questions<span class="sc">$</span>stratum.weight, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 4150</code></pre>
<p>But if we want to calculate weighted medians for each variable we will need to iterate this function on those variables. But first we will need to exclude variables with less than 3 observations.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="analysis.html#cb141-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> numerical_questions <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="analysis.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="sc">-</span>X_uuid, <span class="sc">-</span>strata) <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="analysis.html#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns=</span> <span class="sc">~</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)) ))<span class="sc">%&gt;%</span></span>
<span id="cb141-4"><a href="analysis.html#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>()<span class="co">#Calculating count of observation for each variable</span></span>
<span id="cb141-5"><a href="analysis.html#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="analysis.html#cb141-6" aria-hidden="true" tabindex="-1"></a>numerical_questions <span class="ot">&lt;-</span> numerical_questions[ , (<span class="fu">names</span>(numerical_questions) <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">subset</span>(counts, counts[,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">3</span>)))]</span>
<span id="cb141-7"><a href="analysis.html#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co">#removing variables with less than 3 observations</span></span>
<span id="cb141-8"><a href="analysis.html#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="analysis.html#cb141-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-10"><a href="analysis.html#cb141-10" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">lapply</span>(numerical_questions[<span class="dv">1</span><span class="sc">:</span><span class="dv">46</span>], weighted.median, <span class="at">w =</span> numerical_questions<span class="sc">$</span>stratum.weight, <span class="at">na.rm=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb141-11"><a href="analysis.html#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<p>Now we can transpond resulting vector and add description to the calculation</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="analysis.html#cb142-1" aria-hidden="true" tabindex="-1"></a>medians <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(medians),<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb142-2"><a href="analysis.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(medians)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Median_wght&quot;</span></span>
<span id="cb142-3"><a href="analysis.html#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(medians)</span></code></pre></div>
<pre><code>##                               Median_wght
## b15_hohh_income                    2780.0
## hohh_age_18                           0.0
## age_18                                0.0
## b21_num_additional_hh_members         0.5
## age_5_18_number                       0.0
## age_5_12_number                       0.0</code></pre>
</div>
</div>
<div id="ratios" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Ratios<a href="analysis.html#ratios" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This function computes the % of answers for select multiple questions.<br />
The output can be used as a data merge file for indesign.<br />
The arguments are: dataset, disaggregation variable, question to analyze, and weight column.<br />
</p>
<div id="example1" class="section level3 hasAnchor" number="7.3.1">
<h3 class="hasAnchor"><span class="header-section-number">7.3.1</span> Example1:<br />
<a href="analysis.html#example1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Question</strong>: e11_items_do_not_have_per_hh<br />
<strong>Disaggregation variable</strong>: b9_hohh_marital_status<br />
<strong>weights column</strong>: stratum.weight<br />
</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="analysis.html#cb144-1" aria-hidden="true" tabindex="-1"></a>ratios_select_multiple <span class="ot">&lt;-</span></span>
<span id="cb144-2"><a href="analysis.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(df, x_var, y_prefix, weights_var) {</span>
<span id="cb144-3"><a href="analysis.html#cb144-3" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">%&gt;%</span></span>
<span id="cb144-4"><a href="analysis.html#cb144-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>({</span>
<span id="cb144-5"><a href="analysis.html#cb144-5" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb144-6"><a href="analysis.html#cb144-6" aria-hidden="true" tabindex="-1"></a>          x_var</span>
<span id="cb144-7"><a href="analysis.html#cb144-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb144-8"><a href="analysis.html#cb144-8" aria-hidden="true" tabindex="-1"></a>      }) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(y_prefix)) <span class="sc">%&gt;%</span></span>
<span id="cb144-9"><a href="analysis.html#cb144-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="fu">paste0</span>(y_prefix, <span class="st">&quot;.&quot;</span>)),</span>
<span id="cb144-10"><a href="analysis.html#cb144-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">list</span>(<span class="at">pct =</span> <span class="sc">~</span> <span class="fu">weighted.mean</span>(., {</span>
<span id="cb144-11"><a href="analysis.html#cb144-11" aria-hidden="true" tabindex="-1"></a>                         {</span>
<span id="cb144-12"><a href="analysis.html#cb144-12" aria-hidden="true" tabindex="-1"></a>                           weights_var</span>
<span id="cb144-13"><a href="analysis.html#cb144-13" aria-hidden="true" tabindex="-1"></a>                         }</span>
<span id="cb144-14"><a href="analysis.html#cb144-14" aria-hidden="true" tabindex="-1"></a>                       }, <span class="at">na.rm =</span> T))))</span>
<span id="cb144-15"><a href="analysis.html#cb144-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-16"><a href="analysis.html#cb144-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-17"><a href="analysis.html#cb144-17" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span></span>
<span id="cb144-18"><a href="analysis.html#cb144-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ratios_select_multiple</span>(</span>
<span id="cb144-19"><a href="analysis.html#cb144-19" aria-hidden="true" tabindex="-1"></a>    main_dataset,</span>
<span id="cb144-20"><a href="analysis.html#cb144-20" aria-hidden="true" tabindex="-1"></a>    b9_hohh_marital_status,</span>
<span id="cb144-21"><a href="analysis.html#cb144-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;e11_items_do_not_have_per_hh&quot;</span>,</span>
<span id="cb144-22"><a href="analysis.html#cb144-22" aria-hidden="true" tabindex="-1"></a>    stratum.weight</span>
<span id="cb144-23"><a href="analysis.html#cb144-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb144-24"><a href="analysis.html#cb144-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-25"><a href="analysis.html#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   b9_hohh_marital_status           e11_items_do_not_hav…¹ e11_items_do_not_hav…²
##   &lt;chr&gt;                                             &lt;dbl&gt;                  &lt;dbl&gt;
## 1 divorced                                         0.0851                 0.0859
## 2 married                                          0.0496                 0.0545
## 3 separated_married_but_not_livin…                 0.0138                 0.0513
## 4 single                                           0.0726                 0.0516
## 5 unmarried_but_living_together                    0.0874                 0.101 
## 6 widowed                                          0.106                  0.0923
## # ℹ abbreviated names: ¹​e11_items_do_not_have_per_hh.refigerator_pct,
## #   ²​e11_items_do_not_have_per_hh.functional_stove_pct
## # ℹ 2 more variables:
## #   e11_items_do_not_have_per_hh.functional_heater_movable_pct &lt;dbl&gt;,
## #   e11_items_do_not_have_per_hh.hh_has_all_items_pct &lt;dbl&gt;</code></pre>
</div>
<div id="example2---analyzing-multiple-questions-and-combine-the-output" class="section level3 hasAnchor" number="7.3.2">
<h3 class="hasAnchor"><span class="header-section-number">7.3.2</span> Example2 - Analyzing multiple questions and combine the output:<br />
<a href="analysis.html#example2---analyzing-multiple-questions-and-combine-the-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Question</strong>: e11_items_do_not_have_per_hh and b11_hohh_chronic_illness<br />
<strong>Disaggregation variable</strong>: b9_hohh_marital_status<br />
<strong>weights column</strong>: stratum.weight<br />
</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="analysis.html#cb146-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span></span>
<span id="cb146-2"><a href="analysis.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(<span class="st">&quot;full_join&quot;</span>, <span class="fu">map</span>(</span>
<span id="cb146-3"><a href="analysis.html#cb146-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;e11_items_do_not_have_per_hh&quot;</span>, <span class="st">&quot;b11_hohh_chronic_illness&quot;</span>),</span>
<span id="cb146-4"><a href="analysis.html#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ratios_select_multiple</span>(main_dataset, b9_hohh_marital_status, .x, stratum.weight)</span>
<span id="cb146-5"><a href="analysis.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## Joining with `by = join_by(b9_hohh_marital_status)`</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="analysis.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 18
##   b9_hohh_marital_status           e11_items_do_not_hav…¹ e11_items_do_not_hav…²
##   &lt;chr&gt;                                             &lt;dbl&gt;                  &lt;dbl&gt;
## 1 divorced                                         0.0851                 0.0859
## 2 married                                          0.0496                 0.0545
## 3 separated_married_but_not_livin…                 0.0138                 0.0513
## 4 single                                           0.0726                 0.0516
## 5 unmarried_but_living_together                    0.0874                 0.101 
## 6 widowed                                          0.106                  0.0923
## # ℹ abbreviated names: ¹​e11_items_do_not_have_per_hh.refigerator_pct,
## #   ²​e11_items_do_not_have_per_hh.functional_stove_pct
## # ℹ 15 more variables:
## #   e11_items_do_not_have_per_hh.functional_heater_movable_pct &lt;dbl&gt;,
## #   e11_items_do_not_have_per_hh.hh_has_all_items_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.blood_pressure_diseases_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.cardiovascular_disease_pct &lt;dbl&gt;, …</code></pre>
</div>
<div id="example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted" class="section level3 hasAnchor" number="7.3.3">
<h3 class="hasAnchor"><span class="header-section-number">7.3.3</span> Example3 - No dissagregation is needed and/or the data is not weighted:<br />
<a href="analysis.html#example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Question</strong>: e11_items_do_not_have_per_hh and b11_hohh_chronic_illness<br />
<strong>Disaggregation variable</strong>: NA<br />
<strong>weights column</strong>: NA<br />
</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="analysis.html#cb150-1" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>all <span class="ot">&lt;-</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb150-2"><a href="analysis.html#cb150-2" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>no_weights <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb150-3"><a href="analysis.html#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="analysis.html#cb150-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span></span>
<span id="cb150-5"><a href="analysis.html#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(<span class="st">&quot;full_join&quot;</span>, <span class="fu">map</span>(</span>
<span id="cb150-6"><a href="analysis.html#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;e11_items_do_not_have_per_hh&quot;</span>, <span class="st">&quot;b11_hohh_chronic_illness&quot;</span>),</span>
<span id="cb150-7"><a href="analysis.html#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ratios_select_multiple</span>(main_dataset, all, .x, no_weights)</span>
<span id="cb150-8"><a href="analysis.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## Joining with `by = join_by(all)`</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="analysis.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 18
##   all   e11_items_do_not_have_pe…¹ e11_items_do_not_hav…² e11_items_do_not_hav…³
##   &lt;chr&gt;                      &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
## 1 all                       0.0804                 0.0779                  0.417
## # ℹ abbreviated names: ¹​e11_items_do_not_have_per_hh.refigerator_pct,
## #   ²​e11_items_do_not_have_per_hh.functional_stove_pct,
## #   ³​e11_items_do_not_have_per_hh.functional_heater_movable_pct
## # ℹ 14 more variables: e11_items_do_not_have_per_hh.hh_has_all_items_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.blood_pressure_diseases_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.cardiovascular_disease_pct &lt;dbl&gt;,
## #   b11_hohh_chronic_illness.diabetes_need_insulin_pct &lt;dbl&gt;, …</code></pre>
</div>
</div>
<div id="weights" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Weights<a href="analysis.html#weights" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Weights can be used for different reasons. In most of cases, we will use weights to correct for difference between strata size. Once the population has a certain (big) size, for the same design, the size of the sample won’t change much. In the case of the dataset, there are 4 stratas:<br />
- within 20km of the border in rural areas : 89,408 households<br />
- within 20km of the border in urban areas : 203,712 households<br />
- within 20km of the border in rural areas : 39,003 households<br />
- within 20km of the border in rural areas : 211,857 households</p>
<p>Using any sampling calculator, for a 95% confindence level, 5% margin of error and 5% buffer, we will have around 400 samples per strata even though the urban areas are much bigger.<br />
<em>Note: The error of 5% for 90,000 is 4,500 households while for 200,000 households is 10,000 households</em></p>
<p>If we look at each strata and the highest level of education completed by the household head (<strong>b20_hohh_level_education</strong>), we can see that the percentage of household were the head of household completed higher education varies between between 7 to 13 % in each strata.</p>
<pre><code>## # A tibble: 4 × 5
## # Groups:   strata [4]
##   strata     b20_hohh_level_education     n tot_n  prop
##   &lt;chr&gt;      &lt;chr&gt;                    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1 20km_rural complete_higher             40   407    10
## 2 20km_urban complete_higher             51   404    13
## 3 5km_rural  complete_higher             38   402     9
## 4 5km_urban  complete_higher             28   404     7</code></pre>
<p>However, if we want to know overall the percentage of who finished higher education we cannot just take the overall percentages, i.e. <span class="math inline">\(\frac{40 + 51 +38 + 28}{407 + 404 + 402 + 404}\)</span> = <span class="math inline">\(\frac{157}{1617}\)</span> = 10%.<br />
We cannot do this because the first strata represent 90,000 households, the second 200,000 households, the third 40,000 households and the last one 210,000 households. We will use weights to compensate this difference.</p>
<p>We will use this formula:<br />
weight of strata = <span class="math inline">\(\frac{\frac{strata\\ population}{total\\ population}}{\frac{strata\\ sample}{total\\ sample}}\)</span></p>
<div id="tidyverse" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> tidyverse<a href="analysis.html#tidyverse" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following example will show how to calculate the weights with <strong>tidyverse</strong>.</p>
<p>To calculate weights, we will need all the following information: - <em>population of the strata</em>,<br />
- <em>total population</em>,<br />
- <em>sample</em> and<br />
- <em>total sample</em>.<br />
The population information should come from the sampling frame that was used to draw the sampling.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="analysis.html#cb155-1" aria-hidden="true" tabindex="-1"></a>my_sampling_frame <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_GCA_Weights_26AUG2020.xlsx&quot;</span>, </span>
<span id="cb155-2"><a href="analysis.html#cb155-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sheet =</span> <span class="st">&quot;for_r&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb155-3"><a href="analysis.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population_strata =</span> population)</span>
<span id="cb155-4"><a href="analysis.html#cb155-4" aria-hidden="true" tabindex="-1"></a>my_sampling_frame</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   strata     population_strata
##   &lt;chr&gt;                  &lt;dbl&gt;
## 1 20km_rural             89408
## 2 20km_urban            230712
## 3 5km_rural              39003
## 4 5km_urban             211857</code></pre>
<p>Then, we need to get the actual sample from the dataset.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="analysis.html#cb157-1" aria-hidden="true" tabindex="-1"></a>sample_per_strata_table <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="analysis.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata) <span class="sc">%&gt;%</span> </span>
<span id="cb157-3"><a href="analysis.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb157-4"><a href="analysis.html#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">strata_sample =</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb157-5"><a href="analysis.html#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb157-6"><a href="analysis.html#cb157-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-7"><a href="analysis.html#cb157-7" aria-hidden="true" tabindex="-1"></a>sample_per_strata_table</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   strata     strata_sample
##   &lt;chr&gt;              &lt;int&gt;
## 1 20km_rural           407
## 2 20km_urban           404
## 3 5km_rural            402
## 4 5km_urban            404</code></pre>
<p>Then, we can join the tables together and calculate the weights per strata.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="analysis.html#cb159-1" aria-hidden="true" tabindex="-1"></a>weight_table <span class="ot">&lt;-</span> sample_per_strata_table <span class="sc">%&gt;%</span> </span>
<span id="cb159-2"><a href="analysis.html#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(my_sampling_frame) <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="analysis.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weights =</span> (population_strata<span class="sc">/</span><span class="fu">sum</span>(population_strata))<span class="sc">/</span>(strata_sample<span class="sc">/</span><span class="fu">sum</span>(strata_sample)))</span>
<span id="cb159-4"><a href="analysis.html#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="analysis.html#cb159-5" aria-hidden="true" tabindex="-1"></a>weight_table</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   strata     strata_sample population_strata weights
##   &lt;chr&gt;              &lt;int&gt;             &lt;dbl&gt;   &lt;dbl&gt;
## 1 20km_rural           407             89408   0.622
## 2 20km_urban           404            230712   1.62 
## 3 5km_rural            402             39003   0.275
## 4 5km_urban            404            211857   1.49</code></pre>
<p>Then we can finally add them to the dataset.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="analysis.html#cb161-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb161-2"><a href="analysis.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(weight_table, strata, weights), <span class="at">by =</span> <span class="st">&quot;strata&quot;</span>)</span>
<span id="cb161-3"><a href="analysis.html#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(main_dataset<span class="sc">$</span>weights)</span></code></pre></div>
<pre><code>## [1] 0.2747648 0.2747648 0.6221156 0.6221156 0.6221156 0.6221156</code></pre>
<p>We can check that each strata has only 1 weight.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="analysis.html#cb163-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb163-2"><a href="analysis.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata, weights) <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="analysis.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
## # Groups:   strata [4]
##   strata     weights     n
##   &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;
## 1 20km_rural   0.622   407
## 2 20km_urban   1.62    404
## 3 5km_rural    0.275   402
## 4 5km_urban    1.49    404</code></pre>
<p>We can check that the sum of weights is equal to the number of interviews.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="analysis.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(main_dataset<span class="sc">$</span>weights) <span class="sc">==</span> <span class="fu">nrow</span>(main_dataset)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="surveyweights" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> surveyweights<a href="analysis.html#surveyweights" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>surveyweights</strong> was created to calculate weights. The function <strong>weighting_fun_from_samplingframe</strong> creates a function that calculates weights from the dataset and the sampling frame.</p>
<p><em>Note: surveyweights can be found on <a href="https://github.com/impact-initiatives/surveyweights">github</a>.</em></p>
<p>First you need to create the weighting function. <strong>weighting_fun_from_samplingframe</strong> will take 5 arguments:<br />
- sampling.frame: a data frame with your population figures and stratas.<br />
- data.stratum.column : column name of the strata in the dataset.<br />
- sampling.frame.population.column : column name of population figures in the sampling frame.<br />
- sampling.frame.stratum.column : column name of the strata in the sampling frame.<br />
- data : dataset</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="analysis.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(surveyweights)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;surveyweights&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:hypegrammaR&#39;:
## 
##     combine_weighting_functions</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="analysis.html#cb170-1" aria-hidden="true" tabindex="-1"></a>my_weigthing_function <span class="ot">&lt;-</span> surveyweights<span class="sc">::</span><span class="fu">weighting_fun_from_samplingframe</span>(<span class="at">sampling.frame =</span> my_sampling_frame,</span>
<span id="cb170-2"><a href="analysis.html#cb170-2" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">data.stratum.column =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb170-3"><a href="analysis.html#cb170-3" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">sampling.frame.population.column =</span> <span class="st">&quot;population_strata&quot;</span>, </span>
<span id="cb170-4"><a href="analysis.html#cb170-4" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">sampling.frame.stratum.column =</span> <span class="st">&quot;strata&quot;</span>, </span>
<span id="cb170-5"><a href="analysis.html#cb170-5" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">data =</span> main_dataset)</span></code></pre></div>
<p>See that the <strong>my_weigthing_function</strong> is not a vector of weights. It is a function that takes the dataset as argument and returns a vector of weights.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="analysis.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.function</span>(my_weigthing_function)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="analysis.html#cb173-1" aria-hidden="true" tabindex="-1"></a>my_weigthing_function</span></code></pre></div>
<pre><code>## function (df) 
## {
##     if (!is.data.frame(df)) {
##         stop(&quot;df must be a data.frame&quot;)
##     }
##     df &lt;- as.data.frame(df, stringsAsFactors = FALSE)
##     df &lt;- lapply(df, function(x) {
##         if (is.factor(x)) {
##             return(as.character(x))
##         }
##         x
##     }) %&gt;% as.data.frame(stringsAsFactors = FALSE)
##     if (!all(data.stratum.column %in% names(df))) {
##         stop(paste0(&quot;data frame column &#39;&quot;, data.stratum.column, 
##             &quot;&#39;not found.&quot;))
##     }
##     df[[data.stratum.column]] &lt;- as.character(df[[data.stratum.column]])
##     sample.counts &lt;- stratify.count.sample(data.strata = asdhk[[data.stratum.column]], 
##         sf.strata = population.counts)
##     if (&quot;weights&quot; %in% names(df)) {
##         warning(&quot;&#39;weights&#39; is used as a column name (will not be calculated from the sampling frame)&quot;)
##     }
##     if (!all(names(sample.counts) %in% names(population.counts))) {
##         stop(&quot;all strata names in column &#39;&quot;, data.stratum.column, 
##             &quot;&#39; must also appear in the loaded sampling frame.&quot;)
##     }
##     weights &lt;- stratify.weights(pop_strata = population.counts, 
##         sample_strata = sample.counts)
##     return(weights[df[[data.stratum.column]]])
## }
## &lt;bytecode: 0x000001aacf85bb30&gt;
## &lt;environment: 0x000001aacf856b00&gt;</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="analysis.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">my_weigthing_function</span>(main_dataset) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Warning in my_weigthing_function(main_dataset): &#39;weights&#39; is used as a column
## name (will not be calculated from the sampling frame)</code></pre>
<pre><code>## data.strata
##  5km_rural  5km_rural 20km_rural 20km_rural 20km_rural 20km_rural 
##  0.2747648  0.2747648  0.6221156  0.6221156  0.6221156  0.6221156</code></pre>
<p><em>Note: A warning shows that if the column weights exists in the dataset, <strong>my_weigthing_function</strong> will not calculate weights. We need to remove the weights column from the previous example.</em></p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="analysis.html#cb178-1" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>weights <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb178-2"><a href="analysis.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">my_weigthing_function</span>(main_dataset) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## data.strata
##  5km_rural  5km_rural 20km_rural 20km_rural 20km_rural 20km_rural 
##  0.2747648  0.2747648  0.6221156  0.6221156  0.6221156  0.6221156</code></pre>
<p>To add the weights, we need to add a new column.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="analysis.html#cb180-1" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>my_weights <span class="ot">&lt;-</span> <span class="fu">my_weigthing_function</span>(main_dataset)</span>
<span id="cb180-2"><a href="analysis.html#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="analysis.html#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(main_dataset<span class="sc">$</span>my_weights)</span></code></pre></div>
<pre><code>## [1] 0.2747648 0.2747648 0.6221156 0.6221156 0.6221156 0.6221156</code></pre>
<p>As for the previous example, we can check that only 1 weight is used per strata.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="analysis.html#cb182-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb182-2"><a href="analysis.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(strata, my_weights) <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="analysis.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
## # Groups:   strata [4]
##   strata     my_weights      n
##   &lt;chr&gt;      &lt;table[1d]&gt; &lt;int&gt;
## 1 20km_rural 0.6221156     407
## 2 20km_urban 1.6172529     404
## 3 5km_rural  0.2747648     402
## 4 5km_urban  1.4850825     404</code></pre>
<p>We can check that the sum of weights is equal to the number of interviews.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="analysis.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(main_dataset<span class="sc">$</span>my_weights) <span class="sc">==</span> <span class="fu">nrow</span>(main_dataset)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div id="impactr-based-on-srvyr" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> impactR, based on <code>srvyr</code><a href="analysis.html#impactr-based-on-srvyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>impactR</code> was at first designed for helping data officers to cover most of the research cycles’ parts, from producing cleaning log, cleaning data, and analyzing it. It is available for download here: <a href="https://gnoblet.github.io/impactR/" class="uri">https://gnoblet.github.io/impactR/</a>.</p>
<p>The visualization (post-analysis) component has now been moved to package <code>visualizeR</code>: <a href="https://gnoblet.github.io/visualizeR/" class="uri">https://gnoblet.github.io/visualizeR/</a>. Composite indicators now lies into <code>humind</code> : <a href="https://github.com/gnoblet/humind" class="uri">https://github.com/gnoblet/humind</a>. Analysis is still a module of <code>impactR</code>; yet it will most probably shortly be moved to a smaller consolidated packages.</p>
<p>There are some vignettes/some documentation on the Github website. In particular this one for analysis: <a href="https://gnoblet.github.io/impactR/articles/analysis.html" class="uri">https://gnoblet.github.io/impactR/articles/analysis.html</a>.</p>
<p>You can install and load it with:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="analysis.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;gnoblet/impactR&quot;)</span></span>
<span id="cb186-2"><a href="analysis.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(impactR)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;impactR&#39;</code></pre>
<pre><code>## The following objects are masked _by_ &#39;.GlobalEnv&#39;:
## 
##     choices, cleaning_log</code></pre>
<div id="introduction" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Introduction<a href="analysis.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="caveats" class="section level4 hasAnchor" number="7.5.1.1">
<h4><span class="header-section-number">7.5.1.1</span> Caveats<a href="analysis.html#caveats" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Though it has been used for several research cycles, including MSNAs, there is no test designed in the package. One discrepancy will be corrected in the next version using function <code>make_analysis_from_dap()</code>: it for now assumes that all <code>id_analysis</code> are distinct and not NAs when using <code>bind = TRUE</code>. The next version will also have a new feature: unweighted counts and some automation for select one and select multiple questions.</p>
<p>Grouping is for now only possible for one variable. If you want to disagregate for instance by setting (rural vs. urban) and admin1, then you must mutate a new variable beforehand (it is as simple as pasting both columns).</p>
</div>
<div id="rational" class="section level4 hasAnchor" number="7.5.1.2">
<h4><span class="header-section-number">7.5.1.2</span> Rational<a href="analysis.html#rational" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The package is a wrapper around <code>srvyr</code>. The workflow is as follows:</p>
<ol style="list-style-type: decimal">
<li>Prepare data: Get your data, weights, strata ready, and prepare a survey design object (using <code>srvyr::as_survey_design()</code>).</li>
<li>Individual general analysis: It has a small family of functions <code>svy_*()</code> such as <code>svy_prop()</code> which are wrappers around the <code>srvyr::survey_*()</code> family in order to harmonize outputs. These functions can be used on their owns and covers mean, median, ration, proportion, interaction.</li>
<li>Individual analysis based on a Kobo tool: Prepare your Kobo tool, then use <code>make_analysis()</code>.</li>
<li>Multiple analyses based on a Kobo tool: Prepare your Data Analysis Plan, then feed <code>make_analysis_from_dap()</code>.</li>
</ol>
</div>
<div id="prepare-data" class="section level4 hasAnchor" number="7.5.1.3">
<h4><span class="header-section-number">7.5.1.3</span> Prepare data<a href="analysis.html#prepare-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Data must have been imported with <code>ìmport_xlsx()</code> or <code>import_csv()</code> or with <code>janitor::clean_names()</code>. This is to ensure that column names for multiple choices follow this pattern: “variable_choice1”, with an underscore between the variable name from the survey sheet and the choices from the choices sheet. For instance, for the main drinking water source (if multiple choice), it could be “w_water_source_surface_water” or “w_water_source_stand_pipe”.</p>
</div>
</div>
<div id="first-stage-prepare-data-and-survey-design" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> First stage: prepare data and survey design<a href="analysis.html#first-stage-prepare-data-and-survey-design" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start by downloading a dataset and the associated Kobo tool.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="analysis.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The dataset (main and roster sheets), and the Kobo tool sheets are saved as a RDS object</span></span>
<span id="cb189-2"><a href="analysis.html#cb189-2" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;inputs/REACH_HTI_dataset_MSNA-2022.RDS&quot;</span>)</span>
<span id="cb189-3"><a href="analysis.html#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="analysis.html#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sheet main contains the HH data</span></span>
<span id="cb189-5"><a href="analysis.html#cb189-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">&lt;-</span> all<span class="sc">$</span>main</span>
<span id="cb189-6"><a href="analysis.html#cb189-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-7"><a href="analysis.html#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sheet survey contains the survey sheet</span></span>
<span id="cb189-8"><a href="analysis.html#cb189-8" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> all<span class="sc">$</span>survey</span>
<span id="cb189-9"><a href="analysis.html#cb189-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-10"><a href="analysis.html#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sheet choices contains, well, the choices sheet</span></span>
<span id="cb189-11"><a href="analysis.html#cb189-11" aria-hidden="true" tabindex="-1"></a>choices <span class="ot">&lt;-</span> all<span class="sc">$</span>choices</span></code></pre></div>
<p>Let’s prepare:</p>
<ul>
<li>data with <code>janitor::clean_names()</code> to ensure lower case and only underscore (no dots, no /, etc.).</li>
<li>survey and choices: let’s separate column type from survey and rename the label column we want to keep to <code>label</code>, otherwise most functions won’t work.</li>
</ul>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="analysis.html#cb190-1" aria-hidden="true" tabindex="-1"></a>main <span class="ot">&lt;-</span> main <span class="sc">|&gt;</span> </span>
<span id="cb190-2"><a href="analysis.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To get clean_names()</span></span>
<span id="cb190-3"><a href="analysis.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb190-4"><a href="analysis.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To get better types</span></span>
<span id="cb190-5"><a href="analysis.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">type_convert</span>()</span></code></pre></div>
<pre><code>## 
## ── Column specification ──────────────────────────────
## cols(
##   .default = col_character()
## )
## ℹ Use `spec()` for the full column specifications.</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="analysis.html#cb192-1" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> survey <span class="sc">|&gt;</span> </span>
<span id="cb192-2"><a href="analysis.html#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To get clean names</span></span>
<span id="cb192-3"><a href="analysis.html#cb192-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb192-4"><a href="analysis.html#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To get two columns one for the variable type, and one for the list_name</span></span>
<span id="cb192-5"><a href="analysis.html#cb192-5" aria-hidden="true" tabindex="-1"></a>  impactR<span class="sc">::</span><span class="fu">split_survey</span>(type) <span class="sc">|&gt;</span> </span>
<span id="cb192-6"><a href="analysis.html#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To get one column labelled &quot;label&quot; if multiple languages are used</span></span>
<span id="cb192-7"><a href="analysis.html#cb192-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">label =</span> label_francais)</span>
<span id="cb192-8"><a href="analysis.html#cb192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-9"><a href="analysis.html#cb192-9" aria-hidden="true" tabindex="-1"></a>choices <span class="ot">&lt;-</span> choices <span class="sc">|&gt;</span> </span>
<span id="cb192-10"><a href="analysis.html#cb192-10" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb192-11"><a href="analysis.html#cb192-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">label =</span> label_francais)</span></code></pre></div>
<p>Now that the dataset and the Kobo tool are loaded, we can prepare the survey design:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="analysis.html#cb193-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> main <span class="sc">|&gt;</span> </span>
<span id="cb193-2"><a href="analysis.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  srvyr<span class="sc">::</span><span class="fu">as_survey_design</span>(</span>
<span id="cb193-3"><a href="analysis.html#cb193-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">strata =</span> stratum,</span>
<span id="cb193-4"><a href="analysis.html#cb193-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weights =</span> weights)</span></code></pre></div>
</div>
<div id="second-stage-one-variable-analysis" class="section level3 hasAnchor" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Second stage: One variable analysis<a href="analysis.html#second-stage-one-variable-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s give a few examples for the <code>svy_*()</code> family.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="analysis.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Median of respondent&#39;s age, with the confidence interval, no grouped analysis</span></span>
<span id="cb194-2"><a href="analysis.html#cb194-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">svy_median</span>(design, i_enquete_age, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   median median_low median_upp median_unw n_unw n_tot
##    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1     42         42         43         43  3896  3896</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="analysis.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion of respondent&#39;s gender, with the confidence interval, by setting (rural vs. urban)</span></span>
<span id="cb196-2"><a href="analysis.html#cb196-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">svy_prop</span>(design, i_enquete_genre, milieu, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span></code></pre></div>
<pre><code>## When `proportion` is unspecified, `survey_prop()` now defaults to `proportion = TRUE`.
## ℹ This should improve confidence interval coverage.
## This message is displayed once per session.</code></pre>
<pre><code>## # A tibble: 4 × 8
##   milieu i_enquete_genre  prop prop_low prop_upp n_unw prop_unw n_tot
##   &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;int&gt;
## 1 rural  femme           0.598    0.570    0.625   810    0.602  1346
## 2 rural  homme           0.402    0.375    0.430   536    0.398  1346
## 3 urbain femme           0.595    0.573    0.616  1485    0.582  2550
## 4 urbain homme           0.405    0.384    0.427  1065    0.418  2550</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="analysis.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratio of the number of 0-17 yo children that attended school, with the confidence interval and no group</span></span>
<span id="cb199-2"><a href="analysis.html#cb199-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">svy_ratio</span>(design, e_formellet, c_total_age_3a_17a, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   ratio ratio_low ratio_upp ratio_unw n_unw n_tot
##   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1 0.864     0.853     0.875     0.860  3896  3896</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="analysis.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 6 common profiles between type of sanitation and source of drinking water, by setting</span></span>
<span id="cb201-2"><a href="analysis.html#cb201-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">svy_interact</span>(design, <span class="fu">c</span>(h_2_type_latrine, h_1_principal_source_eau), <span class="at">group =</span> milieu, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   milieu h_2_type_latrine  h_1_principal_source…¹   prop prop_low prop_upp n_unw
##   &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt;                   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
## 1 rural  trou_ouvert       source_non_protege     0.122    0.104    0.140    177
## 2 rural  defecation_air_l… source_non_protege     0.118    0.100    0.137    164
## 3 rural  trou_ouvert       robinet_public         0.0707   0.0564   0.0851    97
## 4 urbain toilette_chasse_… reseau_dinepa          0.0679   0.0588   0.0770   189
## 5 urbain trou_ouvert       robinet_public         0.0664   0.0543   0.0784   142
## 6 urbain toilette_chasse_… camion_citerne         0.0526   0.0445   0.0607   144
## # ℹ abbreviated name: ¹​h_1_principal_source_eau
## # ℹ 2 more variables: prop_unw &lt;dbl&gt;, n_tot &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="analysis.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="do">## It means that unprotected water springs and open pit is the most common profile for rural hhs (12%), whereas the most common profile for urban hhs is flush and pour toilet and tap water with national network (7%).</span></span></code></pre></div>
</div>
<div id="third-stage-one-analysis-at-a-time-with-the-kobo-tool" class="section level3 hasAnchor" number="7.5.4">
<h3><span class="header-section-number">7.5.4</span> Third stage: one analysis at a time with the Kobo tool<a href="analysis.html#third-stage-one-analysis-at-a-time-with-the-kobo-tool" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we understands the <code>svy_*()</code> family of functions, we can use <code>make_analysis()</code> which is a wrapper around those for making analysis for medians, means, ratios, proportions of select ones and select multiples. The output of <code>make_analysis()</code> has standardized columns among all types of analysis and labels are pulled out if possible thanks to the survey and choices sheets.</p>
<p>Let’s say you don’t have a full DAP sheet, and you just want to make individual analyses.</p>
<p>1- Proportion for a single choice question:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="analysis.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single choice question, sanitation facility type</span></span>
<span id="cb204-2"><a href="analysis.html#cb204-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, h_2_type_latrine, <span class="st">&quot;prop_simple&quot;</span>, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb204-3"><a href="analysis.html#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="analysis.html#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Same thing without labels, do not get labels of choices</span></span>
<span id="cb204-5"><a href="analysis.html#cb204-5" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, h_2_type_latrine, <span class="st">&quot;prop_simple&quot;</span>, <span class="at">get_label =</span> <span class="cn">FALSE</span>)</span>
<span id="cb204-6"><a href="analysis.html#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="analysis.html#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Single choice question, by group setting (rural vs. urban) - group needs to be a character string here</span></span>
<span id="cb204-8"><a href="analysis.html#cb204-8" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, h_2_type_latrine, <span class="st">&quot;prop_simple&quot;</span>, <span class="at">group =</span> <span class="st">&quot;milieu&quot;</span>)</span></code></pre></div>
<p>2- Proportion overall: calculate the proportion with NAs as a category, this can be useful in case of a skip logic and you want to make the calculation over the whole population:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="analysis.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single choice question: </span></span>
<span id="cb205-2"><a href="analysis.html#cb205-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, r_1_date_reception_assistance, <span class="st">&quot;prop_simple_overall&quot;</span>, <span class="at">none_label =</span> <span class="st">&quot;No assistance received, do not know, prefere not to say, or missing data&quot;</span>)</span></code></pre></div>
<p>3- Multiple proportion:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="analysis.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple choice question, here computing self-reported priority needs</span></span>
<span id="cb206-2"><a href="analysis.html#cb206-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, r_1_besoin_prioritaire, <span class="st">&quot;prop_multiple&quot;</span>, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb206-3"><a href="analysis.html#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="analysis.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple choice question, with no label and with groups</span></span>
<span id="cb206-5"><a href="analysis.html#cb206-5" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, r_1_besoin_prioritaire, <span class="st">&quot;prop_multiple&quot;</span>, <span class="at">get_label =</span> <span class="cn">FALSE</span>, <span class="at">group =</span> <span class="st">&quot;milieu&quot;</span>)</span></code></pre></div>
<p>4- Multiple proportion overall: calculate the proportion for each choice over the whole population (replaces NAs by 0s in the dummy columns):</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="analysis.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple choice question, estimates calculated over the whole population.</span></span>
<span id="cb207-2"><a href="analysis.html#cb207-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, r_1_besoin_prioritaire, <span class="st">&quot;prop_multiple_overall&quot;</span>)</span></code></pre></div>
<p>5- Mean, median and counting numeric as character:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="analysis.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean of interviewee&#39;s age</span></span>
<span id="cb208-2"><a href="analysis.html#cb208-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, i_enquete_age, <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb208-3"><a href="analysis.html#cb208-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-4"><a href="analysis.html#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Median of interviewee&#39;s age</span></span>
<span id="cb208-5"><a href="analysis.html#cb208-5" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, i_enquete_age, <span class="st">&quot;median&quot;</span>)</span>
<span id="cb208-6"><a href="analysis.html#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="analysis.html#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion counting a numeric variable as a character variable</span></span>
<span id="cb208-8"><a href="analysis.html#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Could be used for some particular numeric variables. For instance, below is the % of HHs by daily duration of access to electricity by setting (rural or urban).</span></span>
<span id="cb208-9"><a href="analysis.html#cb208-9" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, a_6_acces_courant, <span class="st">&quot;count_numeric&quot;</span>, <span class="at">group =</span> <span class="st">&quot;milieu&quot;</span>)</span></code></pre></div>
<p>6 - Last but not least, ratios (it does not consider NAs). For this, it is only necessary to write a character string with the two variable names separated by a comma:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="analysis.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s calculate the % of children aged 3-17 that were registered to a formal school among the HHs that reported having children aged 3-17.</span></span>
<span id="cb209-2"><a href="analysis.html#cb209-2" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis</span>(design, survey, choices, <span class="st">&quot;e_formellet,c_total_age_3a_17a&quot;</span>, <span class="st">&quot;ratio&quot;</span>)</span></code></pre></div>
<div id="fourth-stage-using-a-data-analysis-plan" class="section level4 hasAnchor" number="7.5.4.1">
<h4><span class="header-section-number">7.5.4.1</span> Fourth stage: Using a data analysis plan<a href="analysis.html#fourth-stage-using-a-data-analysis-plan" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now we can use a dap, which mainly consists of a data frame with needed information for performing the analysis. One line is one requested analysis. All variables in the dap must exist in the dataset to be analysed. Usually an excel sheet is the easiest way to go as it can be co-constructed by both an AO and a DO.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="analysis.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here I produce a three-line DAP directly in R just for the sake of the example.</span></span>
<span id="cb210-2"><a href="analysis.html#cb210-2" aria-hidden="true" tabindex="-1"></a>dap <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb210-3"><a href="analysis.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: unique analaysis id identifier</span></span>
<span id="cb210-4"><a href="analysis.html#cb210-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_analysis =</span> <span class="fu">c</span>(<span class="st">&quot;foodsec_1&quot;</span>, <span class="st">&quot;foodsec_3&quot;</span>, <span class="st">&quot;foodsec_3&quot;</span>),</span>
<span id="cb210-5"><a href="analysis.html#cb210-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: sector/research question</span></span>
<span id="cb210-6"><a href="analysis.html#cb210-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rq =</span> <span class="fu">c</span>(<span class="st">&quot;FSL&quot;</span>, <span class="st">&quot;FSL&quot;</span>, <span class="st">&quot;FSL&quot;</span>),</span>
<span id="cb210-7"><a href="analysis.html#cb210-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: sub-sector, sub research question</span></span>
<span id="cb210-8"><a href="analysis.html#cb210-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub_rq =</span> <span class="fu">c</span>(<span class="st">&quot;Food security&quot;</span>, <span class="st">&quot;Food security&quot;</span>, <span class="st">&quot;Livelihoods&quot;</span>),</span>
<span id="cb210-9"><a href="analysis.html#cb210-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: indicator name</span></span>
<span id="cb210-10"><a href="analysis.html#cb210-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">indicator =</span> <span class="fu">c</span>(<span class="st">&quot;% of HHs by FCS category&quot;</span>, <span class="st">&quot;% of HHs by HHS level&quot;</span>, <span class="st">&quot;% of HHs by LCSI category&quot;</span>),</span>
<span id="cb210-11"><a href="analysis.html#cb210-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: recall period</span></span>
<span id="cb210-12"><a href="analysis.html#cb210-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">recall =</span> <span class="fu">c</span>(<span class="st">&quot;7 days&quot;</span>, <span class="st">&quot;30 days&quot;</span>, <span class="st">&quot;30 days&quot;</span>),</span>
<span id="cb210-13"><a href="analysis.html#cb210-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: the variable name in the dataset </span></span>
<span id="cb210-14"><a href="analysis.html#cb210-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">question_name =</span> <span class="fu">c</span>(<span class="st">&quot;fcs_cat&quot;</span>, <span class="st">&quot;hhs_cat&quot;</span>, <span class="st">&quot;lcs_cat&quot;</span>),</span>
<span id="cb210-15"><a href="analysis.html#cb210-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: subset (to be written by hand, does the calculation operates on a substed of the population)</span></span>
<span id="cb210-16"><a href="analysis.html#cb210-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> <span class="fu">c</span>(<span class="cn">NA_character_</span>, <span class="cn">NA_character_</span>, <span class="cn">NA_character_</span>),</span>
<span id="cb210-17"><a href="analysis.html#cb210-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: analysis name to be passed to `make_analysis()`</span></span>
<span id="cb210-18"><a href="analysis.html#cb210-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysis =</span> <span class="fu">c</span>(<span class="st">&quot;prop_simple&quot;</span>, <span class="st">&quot;prop_simple&quot;</span>, <span class="st">&quot;prop_simple&quot;</span>),</span>
<span id="cb210-19"><a href="analysis.html#cb210-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: analysis name used to be displayed later on</span></span>
<span id="cb210-20"><a href="analysis.html#cb210-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">analysis_name =</span> <span class="fu">c</span>(<span class="st">&quot;Proportion&quot;</span>, <span class="st">&quot;Proportion&quot;</span>, <span class="st">&quot;Proportion&quot;</span>),</span>
<span id="cb210-21"><a href="analysis.html#cb210-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: if using analysis &quot;prop_simple_overall&quot;, what is the label for NAs, passed through `make_analysis()`</span></span>
<span id="cb210-22"><a href="analysis.html#cb210-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">none_label =</span> <span class="fu">c</span>(<span class="cn">NA_character_</span>, <span class="cn">NA_character_</span>, <span class="cn">NA_character_</span>),</span>
<span id="cb210-23"><a href="analysis.html#cb210-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: group label</span></span>
<span id="cb210-24"><a href="analysis.html#cb210-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">group_name =</span> <span class="st">&quot;General population&quot;</span>,</span>
<span id="cb210-25"><a href="analysis.html#cb210-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: group variable from which to disaggregate (setting as an example)</span></span>
<span id="cb210-26"><a href="analysis.html#cb210-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(<span class="st">&quot;milieu&quot;</span>, <span class="st">&quot;milieu&quot;</span>, <span class="st">&quot;milieu&quot;</span>),</span>
<span id="cb210-27"><a href="analysis.html#cb210-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: level of confidence</span></span>
<span id="cb210-28"><a href="analysis.html#cb210-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.95</span>, <span class="fl">0.95</span>),</span>
<span id="cb210-29"><a href="analysis.html#cb210-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column: should NAs be removed?</span></span>
<span id="cb210-30"><a href="analysis.html#cb210-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">na_rm =</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;TRUE&quot;</span>),</span>
<span id="cb210-31"><a href="analysis.html#cb210-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column! var type, here we want confidence intervals</span></span>
<span id="cb210-32"><a href="analysis.html#cb210-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">vartype =</span> <span class="fu">c</span>(<span class="st">&quot;ci&quot;</span>, <span class="st">&quot;ci&quot;</span>, <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb210-33"><a href="analysis.html#cb210-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb210-34"><a href="analysis.html#cb210-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-35"><a href="analysis.html#cb210-35" aria-hidden="true" tabindex="-1"></a>dap</span></code></pre></div>
<pre><code>## # A tibble: 3 × 15
##   id_analysis rq    sub_rq        indicator recall question_name subset analysis
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;   
## 1 foodsec_1   FSL   Food security % of HHs… 7 days fcs_cat       &lt;NA&gt;   prop_si…
## 2 foodsec_3   FSL   Food security % of HHs… 30 da… hhs_cat       &lt;NA&gt;   prop_si…
## 3 foodsec_3   FSL   Livelihoods   % of HHs… 30 da… lcs_cat       &lt;NA&gt;   prop_si…
## # ℹ 7 more variables: analysis_name &lt;chr&gt;, none_label &lt;chr&gt;, group_name &lt;chr&gt;,
## #   group &lt;chr&gt;, level &lt;dbl&gt;, na_rm &lt;chr&gt;, vartype &lt;chr&gt;</code></pre>
<p>Let’s produce an analysis:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="analysis.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting a list</span></span>
<span id="cb212-2"><a href="analysis.html#cb212-2" aria-hidden="true" tabindex="-1"></a>an <span class="ot">&lt;-</span> impactR<span class="sc">::</span><span class="fu">make_analysis_from_dap</span>(design, survey, choices, dap)</span>
<span id="cb212-3"><a href="analysis.html#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that if the variables&#39; labels cannot be found in the Kobo tool, the variable&#39;s values are used as choices labels</span></span>
<span id="cb212-4"><a href="analysis.html#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="analysis.html#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting a long dataframe</span></span>
<span id="cb212-6"><a href="analysis.html#cb212-6" aria-hidden="true" tabindex="-1"></a>impactR<span class="sc">::</span><span class="fu">make_analysis_from_dap</span>(design, survey, choices, dap, <span class="at">bind =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb212-7"><a href="analysis.html#cb212-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-8"><a href="analysis.html#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="co"># To perform the same analysis without grouping, you can just replace the &quot;group&quot; variable by NAs</span></span>
<span id="cb212-9"><a href="analysis.html#cb212-9" aria-hidden="true" tabindex="-1"></a>dap <span class="sc">|&gt;</span> </span>
<span id="cb212-10"><a href="analysis.html#cb212-10" aria-hidden="true" tabindex="-1"></a>  srvyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">rep</span>(<span class="cn">NA_character_</span>, <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb212-11"><a href="analysis.html#cb212-11" aria-hidden="true" tabindex="-1"></a>  impactR<span class="sc">::</span><span class="fu">make_analysis_from_dap</span>(design, survey, choices, <span class="at">dap =</span> _, <span class="at">bind =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb212-12"><a href="analysis.html#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="example-survey-analysis-using-illuminate" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> EXAMPLE :: Survey analysis using illuminate<a href="analysis.html#example-survey-analysis-using-illuminate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>illuminate</code> is designed for making the data analysis easy and less time consuming. The package is based on tidyr, dplyr,srvyr packages.You can install the package from <a href="https://github.com/mhkhan27/illuminate">here</a>. HOWEVER the package is not maintained by the author anymore and it doesnt includes any tests.</p>
<div id="step-0-call-libraries" class="section level3 hasAnchor" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Step 0:: Call libraries<a href="analysis.html#step-0-call-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="analysis.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(illuminate)</span>
<span id="cb213-2"><a href="analysis.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb213-3"><a href="analysis.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb213-4"><a href="analysis.html#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb213-5"><a href="analysis.html#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb213-6"><a href="analysis.html#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span></code></pre></div>
</div>
<div id="step-1-read-data" class="section level3 hasAnchor" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> Step 1:: Read data<a href="analysis.html#step-1-read-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Read data with <code>read_sheets()</code>. This will make sure your data is stored as appropriate data type. It is important to make sure that all the select multiple are stored as logical, otherwise un weighted count will be wrong. It is recommended to use the <code>read_sheets()</code> to read the data. use `<code>?read_sheets()</code> for more details.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="analysis.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  [recommended] read_sheets(&quot;[datapath]&quot;,data_type_fix = T,remove_all_NA_col = T,na_strings = c(&quot;NA&quot;,&quot;&quot;,&quot; &quot;))</span></span>
<span id="cb214-2"><a href="analysis.html#cb214-2" aria-hidden="true" tabindex="-1"></a>data_up<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>)</span></code></pre></div>
<p>The above code will give a dataframe called <code>data_up</code></p>
</div>
<div id="step-optional-preaparing-the-data" class="section level3 hasAnchor" number="7.6.3">
<h3><span class="header-section-number">7.6.3</span> Step OPTIONAL:: Preaparing the data<a href="analysis.html#step-optional-preaparing-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span style="color: red;">ONLY APPLICABLE WHEN YOU ARE NOT READING YOUR DATA WITH <code>read_sheets()</code></span></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="analysis.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_up &lt;- read_excel(&quot;data/data.xlsx&quot;)</span></span>
<span id="cb215-2"><a href="analysis.html#cb215-2" aria-hidden="true" tabindex="-1"></a>data_up <span class="ot">&lt;-</span> <span class="fu">fix_data_type</span>(<span class="at">df =</span> data_up)</span></code></pre></div>
</div>
<div id="step-2-weight-calculation" class="section level3 hasAnchor" number="7.6.4">
<h3><span class="header-section-number">7.6.4</span> Step 2:: Weight calculation<a href="analysis.html#step-2-weight-calculation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To do the weighted analysis, you will need to calculate the weights. If your dataset already have the weights column then you can ignore this part</p>
</div>
<div id="read-sampleframe" class="section level3 hasAnchor" number="7.6.5">
<h3><span class="header-section-number">7.6.5</span> Read sampleframe<a href="analysis.html#read-sampleframe" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="analysis.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy code.</span></span>
<span id="cb216-2"><a href="analysis.html#cb216-2" aria-hidden="true" tabindex="-1"></a>sampling_frame <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;[Sample frame path]&quot;</span>)</span></code></pre></div>
<p>This will give a data frame called <code>sampling_frame</code></p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="analysis.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy code.</span></span>
<span id="cb217-2"><a href="analysis.html#cb217-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-3"><a href="analysis.html#cb217-3" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> data_up <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(governorate1) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb217-4"><a href="analysis.html#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_count =</span> <span class="fu">n</span>()</span>
<span id="cb217-5"><a href="analysis.html#cb217-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(sampling_frame,<span class="at">by =</span><span class="fu">c</span>(<span class="st">&quot;governorate1&quot;</span><span class="ot">=</span><span class="st">&quot;strata.names&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb217-6"><a href="analysis.html#cb217-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_global=</span><span class="fu">sum</span>(survey_count),</span>
<span id="cb217-7"><a href="analysis.html#cb217-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_global=</span><span class="fu">sum</span>(population),</span>
<span id="cb217-8"><a href="analysis.html#cb217-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">survey_weight=</span> (population<span class="sc">/</span>pop_global)<span class="sc">/</span>(survey_count<span class="sc">/</span>sample_global)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(governorate1,survey_weight)</span></code></pre></div>
</div>
<div id="add-weights-to-the-dataframe" class="section level3 hasAnchor" number="7.6.6">
<h3><span class="header-section-number">7.6.6</span> Add weights to the dataframe<a href="analysis.html#add-weights-to-the-dataframe" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="analysis.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy code.</span></span>
<span id="cb218-2"><a href="analysis.html#cb218-2" aria-hidden="true" tabindex="-1"></a>data_up <span class="ot">&lt;-</span> data_up <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(weights,<span class="at">by=</span> <span class="st">&quot;governorate1&quot;</span>)</span></code></pre></div>
</div>
<div id="step-3.1-weighted-analysis" class="section level3 hasAnchor" number="7.6.7">
<h3><span class="header-section-number">7.6.7</span> Step 3.1:: Weighted analysis<a href="analysis.html#step-3.1-weighted-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To do the weighted analysis, you need to set <code>weights</code> parameter to <code>TRUE</code> and provide <code>weight_column</code> and <code>strata</code>. You should define the name of the data set weight column in the <code>weight_column</code> parameter and name of the strata column name from the data set.</p>
<p>Additionally, please define the name of the columns which you would like to analyze in <code>vars_to_analyze</code>. Default will analyze all the variables that exist in the data set.</p>
<p>Lastly, please define the <code>sm_sep</code> parameter carefully. It must be either <code>/</code> or <code>,</code>. Use <code>/</code> when your select multiple type questions are separated by <code>/</code> (example- parent_name/child_name1,parent_name/child_name2,
parent_name/child_name3…..). On the other hand use <code>.</code> when the multiple choices are separated by <code>.</code>. (example - parent_name.child_name1,parent_name.child_name2,parent_name.child_name3)</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="analysis.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy code.</span></span>
<span id="cb219-2"><a href="analysis.html#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="analysis.html#cb219-3" aria-hidden="true" tabindex="-1"></a>overall_analysis <span class="ot">&lt;-</span> <span class="fu">survey_analysis</span>(<span class="at">df =</span> data_up,<span class="at">weights =</span> T,<span class="at">weight_column =</span> <span class="st">&quot;survey_weight&quot;</span>,<span class="at">strata =</span> <span class="st">&quot;governorate1&quot;</span>)</span>
<span id="cb219-4"><a href="analysis.html#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="analysis.html#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="co"># As var_to_analyze is not defined, here the function will analyze all the variables. </span></span></code></pre></div>
</div>
<div id="step-3.2-unweighted-analysis" class="section level3 hasAnchor" number="7.6.8">
<h3><span class="header-section-number">7.6.8</span> Step 3.2:: Unweighted analysis<a href="analysis.html#step-3.2-unweighted-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To do unweighted analysis, you need to set the <code>weights</code> parameter <code>FALSE</code>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="analysis.html#cb220-1" aria-hidden="true" tabindex="-1"></a>columns_to_analyze <span class="ot">&lt;-</span> data_up[<span class="dv">20</span><span class="sc">:</span><span class="dv">50</span>] <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="do">## Defining  names of the variables to be analyzed. </span></span>
<span id="cb220-2"><a href="analysis.html#cb220-2" aria-hidden="true" tabindex="-1"></a>overall_analysis <span class="ot">&lt;-</span> <span class="fu">survey_analysis</span>(<span class="at">df =</span> data_up,<span class="at">weights =</span> F,<span class="at">vars_to_analyze =</span> columns_to_analyze )</span></code></pre></div>
<pre><code>## [1] &quot;b10_1_hohh_vulnerability_other&quot;
## [1] &quot;b11_hohh_chronic_illness.blood_pressure_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.cardiovascular_disease&quot;
## [1] &quot;b11_hohh_chronic_illness.diabetes_need_insulin&quot;
## [1] &quot;b11_hohh_chronic_illness.diabetes_does_not_need_insulin&quot;
## [1] &quot;b11_hohh_chronic_illness.chronic_respiratory_condition&quot;
## [1] &quot;b11_hohh_chronic_illness.musculoskeletal_system_and_joints&quot;
## [1] &quot;b11_hohh_chronic_illness.cancer&quot;
## [1] &quot;b11_hohh_chronic_illness.neurological&quot;
## [1] &quot;b11_hohh_chronic_illness.sensory_disorder&quot;
## [1] &quot;b11_hohh_chronic_illness.gastrointestinal_digestive_tract_incl_liver_gallbladder_pancreas_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.genitourinary_system_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.endocrine_system_thyroid_gland_and_other_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.other_specify&quot;
## [1] &quot;b11_1_hohh_chronic_illness_other&quot;
## [1] &quot;b12_situation_description&quot;
## [1] &quot;b12_1_situation_description_other&quot;
## [1] &quot;b13_why_hohh_unemployed&quot;
## [1] &quot;b13_1_why_hohh_unemployed_other&quot;
## [1] &quot;b14_sector_hohh_employed&quot;
## [1] &quot;b14_1_sector_hohh_employed_other&quot;
## [1] &quot;b15_hohh_income&quot;
## [1] &quot;b16_hohh_pension_eligible&quot;
## [1] &quot;b17_hohh_pension_receive&quot;
## [1] &quot;b18_hohh_benefit_eligible&quot;
## [1] &quot;b19_hohh_benefit_receive&quot;
## [1] &quot;b20_hohh_level_education&quot;
## [1] &quot;hohh_age_18&quot;
## [1] &quot;age_18&quot;
## [1] &quot;b21_num_additional_hh_members&quot;
## [1] &quot;b11_hohh_chronic_illness.blood_pressure_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.cardiovascular_disease&quot;
## [1] &quot;b11_hohh_chronic_illness.diabetes_need_insulin&quot;
## [1] &quot;b11_hohh_chronic_illness.diabetes_does_not_need_insulin&quot;
## [1] &quot;b11_hohh_chronic_illness.chronic_respiratory_condition&quot;
## [1] &quot;b11_hohh_chronic_illness.musculoskeletal_system_and_joints&quot;
## [1] &quot;b11_hohh_chronic_illness.cancer&quot;
## [1] &quot;b11_hohh_chronic_illness.neurological&quot;
## [1] &quot;b11_hohh_chronic_illness.sensory_disorder&quot;
## [1] &quot;b11_hohh_chronic_illness.gastrointestinal_digestive_tract_incl_liver_gallbladder_pancreas_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.genitourinary_system_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.endocrine_system_thyroid_gland_and_other_diseases&quot;
## [1] &quot;b11_hohh_chronic_illness.other_specify&quot;</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="analysis.html#cb222-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(overall_analysis,<span class="at">caption =</span> <span class="st">&quot;Example::Analysis table&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1f446acd0e3a7077a972" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1f446acd0e3a7077a972">{"x":{"filter":"none","vertical":false,"caption":"<caption>Example::Analysis table<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129"],["b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b10_1_hohh_vulnerability_other","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_hohh_chronic_illness","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b11_1_hohh_chronic_illness_other","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_situation_description","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b12_1_situation_description_other","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_why_hohh_unemployed","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b13_1_why_hohh_unemployed_other","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_sector_hohh_employed","b14_1_sector_hohh_employed_other","b14_1_sector_hohh_employed_other","b14_1_sector_hohh_employed_other","b14_1_sector_hohh_employed_other","b14_1_sector_hohh_employed_other","b14_1_sector_hohh_employed_other","b15_hohh_income","b16_hohh_pension_eligible","b16_hohh_pension_eligible","b17_hohh_pension_receive","b17_hohh_pension_receive","b18_hohh_benefit_eligible","b18_hohh_benefit_eligible","b18_hohh_benefit_eligible","b19_hohh_benefit_receive","b19_hohh_benefit_receive","b20_hohh_level_education","b20_hohh_level_education","b20_hohh_level_education","b20_hohh_level_education","b20_hohh_level_education","b20_hohh_level_education","b20_hohh_level_education","b20_hohh_level_education","hohh_age_18","age_18","b21_num_additional_hh_members"],["\"Child of war\" status","\"Child of war\" status, \"Veteran of labour\" status ","A carer for a disabled child","A carer for a disabled person","Chernobyl liquidator","Child custody","Deprived orphan","Family with a child with disability","Has a status of the victim of human trafficing ","Husband has disability group 3","Low-income family ","Own apartment destroyed, rented housing","o., 2 level of disability, lives in another HH)","Raises a nephew","Was injured during the conflict","blood_pressure_diseases","cardiovascular_disease","diabetes_need_insulin","diabetes_does_not_need_insulin","chronic_respiratory_condition","musculoskeletal_system_and_joints","cancer","neurological","sensory_disorder","gastrointestinal_digestive_tract_incl_liver_gallbladder_pancreas_diseases","genitourinary_system_diseases","endocrine_system_thyroid_gland_and_other_diseases","other_specify","Allergy","Aseptic necrosis, deforming arthritus","Asthma","Blood disease (blood immune deficiency)","Blood pressure ","Cataract","Chronical asthma","Dermatological problems","Eyes","Eyes glaucoma ","Eyesight","Gynecological problems","Hardly hears","Head trauma","Hypertension","Hypertension, osteochondrosis","Phlebeurysm","Phlebeurysm, needs a surgery","Problems with hearing","Psoriasis","Silicosis","Thrombosis","Tuberculosis","doing_housework_looking_after_children_or_other_persons_unpaid","in_education_doesnt_work","military_service","other_specify","paid_work","permanently_sick_or_disabled_cant_work","retired_but_still_working","retired_not_working","unemployed_looking_for","unemployed_not_looking","Benefit payments for hard labour conditions"," Receives dauthers pension and carer payments\\","Currently applied pension application pending","Earning money abroad","On maternity leave","Pension application pending, has not receiced any payments so far","Pregnant","Receives payments as a carer for a disabled child","Receives social payments because not enough seniority","closing_the_enterprise","cost_cutting_by_employer","end_of_the_contract","health_reasons","lack_of_relevant_vacancies_in_the_settlement","no_employment_opportunities_in_settlement","other_specify","pay_too_low","personal_family_reasons","Can not find a job because of age","Difficult to find a vacancy because of the age","Due to the military conflict","No vacancies in the settlement, does not have means of transportation to seek outside the settlement ","Not a citizen of Ukraine","Quit job because of the military actions","Released from jail","Seasonal work","Upon agreement with employer","agriculture","construction","education","health_care","industry","it","mines","municipal_sector_fire_department_police_sanitation","other_specify","service_cleaner_hairdresser_plumber_carpenter_etc","social_service","state_service","trade_selling_small_household_goods_for_income_eg_settlement_shop_households_own_production","transportation","Agrarian","Electrical grid","Energetics","Energetics (miner)","Mine","Sausage shop",null,"no","yes","no","yes","dont_know_ns","no","yes","no","yes","basic_higher","basic_secondary","complete_higher","complete_secondary","none","preschool","primary_education","vocational",null,null,null],[0.05,0.05,0.05,0.05,0.15,0.05,0.05,0.05,0.05,0.05,0.2,0.05,0.05,0.05,0.05,0.551451187335092,0.509234828496042,0.0158311345646438,0.110817941952507,0.0606860158311346,0.368073878627968,0.0395778364116095,0.0778364116094987,0.0514511873350923,0.217678100263852,0.0804749340369393,0.114775725593668,0.0211081794195251,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0769230769230769,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.115384615384615,0.0384615384615385,0.0384615384615385,0.0384615384615385,0.0841063698206555,0.00371057513914657,0.000618429189857761,0.00556586270871985,0.253555967841682,0.0278293135435993,0.0333951762523191,0.50834879406308,0.0531849103277675,0.0296846011131725,0.111111111111111,0.111111111111111,0.111111111111111,0.111111111111111,0.111111111111111,0.111111111111111,0.111111111111111,0.111111111111111,0.111111111111111,0.0447761194029851,0.111940298507463,0.0223880597014925,0.082089552238806,0.335820895522388,0.261194029850746,0.0746268656716418,0.0223880597014925,0.0447761194029851,0.1,0.1,0.2,0.1,0.1,0.1,0.1,0.1,0.1,0.0926829268292683,0.0292682926829268,0.114634146341463,0.0414634146341463,0.175609756097561,0.0024390243902439,0.0219512195121951,0.0463414634146341,0.0024390243902439,0.163414634146341,0.0146341463414634,0.0317073170731707,0.209756097560976,0.0536585365853659,0.0909090909090909,0.0909090909090909,0.181818181818182,0.0909090909090909,0.454545454545455,0.0909090909090909,3444.02390180879,0.00684931506849315,0.993150684931507,0.0149425287356322,0.985057471264368,0.00618429189857761,0.763760049474335,0.230055658627087,0.317204301075269,0.682795698924731,0.0463821892393321,0.0822510822510823,0.0970933828076685,0.192331478045764,0.00123685837971552,0.000618429189857761,0.00927643784786642,0.570810142238714,0,0.00309214594928881,1.17810760667904],[-0.0520329300357907,-0.0520329300357907,-0.0520329300357908,-0.0520329300357908,-0.0171662675926225,-0.0520329300357907,-0.0520329300357907,-0.0520329300357908,-0.0520329300357908,-0.0520329300357908,0.0127363238150032,-0.0520329300357908,-0.0520329300357908,-0.0520329300357907,-0.0520329300357908,0.515977924066207,0.473578332284963,0.00692819184008558,0.0884285069667059,0.0436568860491121,0.333675070032851,0.0256719121496927,0.0587274038682288,0.0356943050198095,0.18824453564813,0.0610725610448747,0.0920407533113276,0.0108555446523966,-0.039237248763559,-0.039237248763559,-0.0392372487635591,-0.039237248763559,-0.0307395208052051,-0.039237248763559,-0.0392372487635591,-0.039237248763559,-0.039237248763559,-0.039237248763559,-0.039237248763559,-0.039237248763559,-0.039237248763559,-0.039237248763559,-0.039237248763559,-0.0392372487635591,-0.0392372487635591,-0.0392372487635591,-0.039237248763559,-0.0136983046321424,-0.039237248763559,-0.039237248763559,-0.039237248763559,0.070564152609399,0.000743925990931654,-0.000594578265666509,0.00193585899880439,0.232328980771265,0.0198037540281764,0.024628819089712,0.483955959795501,0.0422357803096107,0.0214037517885481,-0.130532681187163,-0.130532681187163,-0.130532681187163,-0.130532681187163,-0.130532681187163,-0.130532681187163,-0.130532681187163,-0.130532681187163,-0.130532681187163,0.00942725011789152,0.0580495734589145,-0.00289858413946045,0.0351710851239535,0.255098103152506,0.186110179418861,0.0297103810447455,-0.00289858413946046,0.00942725011789153,-0.114673462224896,-0.114673462224896,-0.0862312829665283,-0.114673462224896,-0.114673462224896,-0.114673462224896,-0.114673462224896,-0.114673462224896,-0.114673462224896,0.0645213503242948,0.0128991530230311,0.0836958826638899,0.0221030099540566,0.138659428481899,-0.00235119438920294,0.00772180155305433,0.0259260173140664,-0.00235119438920299,0.127507713957333,0.00297249634362984,0.0146911937451656,0.170218031223526,0.031774829241344,-0.102282204899138,-0.102282204899138,-0.0773751402348995,-0.102282204899138,0.119928314625535,-0.102282204899138,3293.60549862818,0.00137836608866904,0.987679735951683,0.00686700060936644,0.976981943138102,0.00235912199273637,0.743034409381801,0.209520458596087,0.269742417695912,0.635333815545374,0.0361205767450031,0.0688455036648475,0.0826466697766738,0.173100800980908,-0.000478062362095104,-0.000594578265666505,0.00459887450495194,0.54665979510025,0,0.000383137791390313,1.11774617658237],[0.152032930035791,0.152032930035791,0.152032930035791,0.152032930035791,0.317166267592623,0.152032930035791,0.152032930035791,0.152032930035791,0.152032930035791,0.152032930035791,0.387263676184997,0.152032930035791,0.152032930035791,0.152032930035791,0.152032930035791,0.586924450603977,0.544891324707121,0.024734077289202,0.133207376938307,0.077715145613157,0.402472687223086,0.0534837606735263,0.0969454193507686,0.0672080696503752,0.247111664879574,0.099877307029004,0.137510697876007,0.0313608141866535,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.184585674651359,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.116160325686636,0.244467535401373,0.116160325686636,0.116160325686636,0.116160325686636,0.0976485870319121,0.00667722428736148,0.00183143664538203,0.00919586641863531,0.274782954912099,0.0358548730590221,0.0421615334149262,0.532741628330659,0.0641340403459243,0.037965450437797,0.352754903409385,0.352754903409385,0.352754903409385,0.352754903409385,0.352754903409385,0.352754903409385,0.352754903409385,0.352754903409385,0.352754903409385,0.0801249886880786,0.165831023556011,0.0476747035424455,0.129008019353658,0.41654368789227,0.336277880282632,0.119543350298538,0.0476747035424455,0.0801249886880786,0.314673462224896,0.314673462224896,0.486231282966528,0.314673462224896,0.314673462224896,0.314673462224896,0.314673462224896,0.314673462224896,0.314673462224896,0.120844503334242,0.0456374323428226,0.145572410019037,0.0608238193142361,0.212560083713223,0.00722924316969074,0.0361806374713359,0.0667569095152019,0.0072292431696908,0.19932155433535,0.026295796339297,0.0487234404011759,0.249294163898425,0.0755422439293877,0.284100386717319,0.284100386717319,0.441011503871263,0.284100386717319,0.789162594465375,0.284100386717319,3594.44230498939,0.0123202640483173,0.998621633911331,0.0230180568618979,0.993132999390634,0.0100094618044189,0.784485689566869,0.250590858658088,0.364666184454626,0.730257582304089,0.0566438017336611,0.095656660837317,0.111540095838663,0.21156215511062,0.00295177912152615,0.00183143664538203,0.0139540011907809,0.594960489377177,0,0.0058011541071873,1.2384690367757],[1,1,1,1,3,1,1,1,1,1,4,1,1,1,1,418,386,12,84,46,279,30,59,39,165,61,87,16,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,136,6,1,9,410,45,54,822,86,48,1,1,1,1,1,1,1,1,1,6,15,3,11,45,35,10,3,6,1,1,2,1,1,1,1,1,1,38,12,47,17,72,1,9,19,1,67,6,13,86,22,1,1,2,1,5,1,1548,6,870,13,857,10,1235,372,118,254,75,133,157,311,2,1,15,923,0,5,1617],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2500,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1],[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,758,758,758,758,758,758,758,758,758,758,758,758,758,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,1617,1617,1617,1617,1617,1617,1617,1617,1617,1617,9,9,9,9,9,9,9,9,9,134,134,134,134,134,134,134,134,134,10,10,10,10,10,10,10,10,10,410,410,410,410,410,410,410,410,410,410,410,410,410,410,11,11,11,11,11,11,1548,876,876,870,870,1617,1617,1617,372,372,1617,1617,1617,1617,1617,1617,1617,1617,1617,1617,1617],["prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_multiple","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","mean","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","prop_select_one","mean","mean","mean"],["prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ \"Child of war\" status @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ \"Child of war\" status, \"Veteran of labour\" status  @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ A carer for a disabled child @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ A carer for a disabled person @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Chernobyl liquidator @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Child custody @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Deprived orphan @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Family with a child with disability @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Has a status of the victim of human trafficing  @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Husband has disability group 3 @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Low-income family  @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Own apartment destroyed, rented housing @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ o., 2 level of disability, lives in another HH) @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Raises a nephew @/@ NA ~/~ NA","prop_select_one @/@ b10_1_hohh_vulnerability_other ~/~ Was injured during the conflict @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ blood_pressure_diseases @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ cardiovascular_disease @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ diabetes_need_insulin @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ diabetes_does_not_need_insulin @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ chronic_respiratory_condition @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ musculoskeletal_system_and_joints @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ cancer @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ neurological @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ sensory_disorder @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ gastrointestinal_digestive_tract_incl_liver_gallbladder_pancreas_diseases @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ genitourinary_system_diseases @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ endocrine_system_thyroid_gland_and_other_diseases @/@ NA ~/~ NA","prop_select_multiple @/@ b11_hohh_chronic_illness ~/~ other_specify @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Allergy @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Aseptic necrosis, deforming arthritus @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Asthma @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Blood disease (blood immune deficiency) @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Blood pressure  @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Cataract @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Chronical asthma @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Dermatological problems @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Eyes @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Eyes glaucoma  @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Eyesight @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Gynecological problems @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Hardly hears @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Head trauma @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Hypertension @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Hypertension, osteochondrosis @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Phlebeurysm @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Phlebeurysm, needs a surgery @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Problems with hearing @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Psoriasis @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Silicosis @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Thrombosis @/@ NA ~/~ NA","prop_select_one @/@ b11_1_hohh_chronic_illness_other ~/~ Tuberculosis @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ doing_housework_looking_after_children_or_other_persons_unpaid @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ in_education_doesnt_work @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ military_service @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ other_specify @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ paid_work @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ permanently_sick_or_disabled_cant_work @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ retired_but_still_working @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ retired_not_working @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ unemployed_looking_for @/@ NA ~/~ NA","prop_select_one @/@ b12_situation_description ~/~ unemployed_not_looking @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Benefit payments for hard labour conditions @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~  Receives dauthers pension and carer payments\\ @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Currently applied pension application pending @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Earning money abroad @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ On maternity leave @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Pension application pending, has not receiced any payments so far @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Pregnant @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Receives payments as a carer for a disabled child @/@ NA ~/~ NA","prop_select_one @/@ b12_1_situation_description_other ~/~ Receives social payments because not enough seniority @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ closing_the_enterprise @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ cost_cutting_by_employer @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ end_of_the_contract @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ health_reasons @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ lack_of_relevant_vacancies_in_the_settlement @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ no_employment_opportunities_in_settlement @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ other_specify @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ pay_too_low @/@ NA ~/~ NA","prop_select_one @/@ b13_why_hohh_unemployed ~/~ personal_family_reasons @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Can not find a job because of age @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Difficult to find a vacancy because of the age @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Due to the military conflict @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ No vacancies in the settlement, does not have means of transportation to seek outside the settlement  @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Not a citizen of Ukraine @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Quit job because of the military actions @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Released from jail @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Seasonal work @/@ NA ~/~ NA","prop_select_one @/@ b13_1_why_hohh_unemployed_other ~/~ Upon agreement with employer @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ agriculture @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ construction @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ education @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ health_care @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ industry @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ it @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ mines @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ municipal_sector_fire_department_police_sanitation @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ other_specify @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ service_cleaner_hairdresser_plumber_carpenter_etc @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ social_service @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ state_service @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ trade_selling_small_household_goods_for_income_eg_settlement_shop_households_own_production @/@ NA ~/~ NA","prop_select_one @/@ b14_sector_hohh_employed ~/~ transportation @/@ NA ~/~ NA","prop_select_one @/@ b14_1_sector_hohh_employed_other ~/~ Agrarian @/@ NA ~/~ NA","prop_select_one @/@ b14_1_sector_hohh_employed_other ~/~ Electrical grid @/@ NA ~/~ NA","prop_select_one @/@ b14_1_sector_hohh_employed_other ~/~ Energetics @/@ NA ~/~ NA","prop_select_one @/@ b14_1_sector_hohh_employed_other ~/~ Energetics (miner) @/@ NA ~/~ NA","prop_select_one @/@ b14_1_sector_hohh_employed_other ~/~ Mine @/@ NA ~/~ NA","prop_select_one @/@ b14_1_sector_hohh_employed_other ~/~ Sausage shop @/@ NA ~/~ NA","mean @/@ b15_hohh_income ~/~ NA @/@ NA ~/~ NA","prop_select_one @/@ b16_hohh_pension_eligible ~/~ no @/@ NA ~/~ NA","prop_select_one @/@ b16_hohh_pension_eligible ~/~ yes @/@ NA ~/~ NA","prop_select_one @/@ b17_hohh_pension_receive ~/~ no @/@ NA ~/~ NA","prop_select_one @/@ b17_hohh_pension_receive ~/~ yes @/@ NA ~/~ NA","prop_select_one @/@ b18_hohh_benefit_eligible ~/~ dont_know_ns @/@ NA ~/~ NA","prop_select_one @/@ b18_hohh_benefit_eligible ~/~ no @/@ NA ~/~ NA","prop_select_one @/@ b18_hohh_benefit_eligible ~/~ yes @/@ NA ~/~ NA","prop_select_one @/@ b19_hohh_benefit_receive ~/~ no @/@ NA ~/~ NA","prop_select_one @/@ b19_hohh_benefit_receive ~/~ yes @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ basic_higher @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ basic_secondary @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ complete_higher @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ complete_secondary @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ none @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ preschool @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ primary_education @/@ NA ~/~ NA","prop_select_one @/@ b20_hohh_level_education ~/~ vocational @/@ NA ~/~ NA","mean @/@ hohh_age_18 ~/~ NA @/@ NA ~/~ NA","mean @/@ age_18 ~/~ NA @/@ NA ~/~ NA","mean @/@ b21_num_additional_hh_members ~/~ NA @/@ NA ~/~ NA"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>main_variable<\/th>\n      <th>choice<\/th>\n      <th>stat<\/th>\n      <th>stat_low<\/th>\n      <th>stat_upp<\/th>\n      <th>n_unweighted<\/th>\n      <th>median<\/th>\n      <th>response_count<\/th>\n      <th>analysis_type<\/th>\n      <th>key_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="step-3.3-weighted-and-disaggregated-by-gender-analysis" class="section level3 hasAnchor" number="7.6.9">
<h3><span class="header-section-number">7.6.9</span> Step 3.3:: Weighted and disaggregated by gender analysis<a href="analysis.html#step-3.3-weighted-and-disaggregated-by-gender-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use <code>?survey_analysis()</code> to know about the perameters.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="analysis.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy code.</span></span>
<span id="cb223-2"><a href="analysis.html#cb223-2" aria-hidden="true" tabindex="-1"></a>analysis_by_gender <span class="ot">&lt;-</span>  <span class="fu">survey_analysis</span>(<span class="at">df =</span> data_up,<span class="at">weights =</span> T,<span class="at">weight_column =</span> <span class="st">&quot;survey_weight&quot;</span>,<span class="at">vars_to_analyze =</span> columns_to_analyze,</span>
<span id="cb223-3"><a href="analysis.html#cb223-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">strata =</span> <span class="st">&quot;governorate1&quot;</span>,<span class="at">disag =</span> <span class="fu">c</span>(<span class="st">&quot;va_child_income&quot;</span>,<span class="st">&quot;gender_speaker&quot;</span>))</span></code></pre></div>
</div>
<div id="step-4-export-with-write_formatted_excel" class="section level3 hasAnchor" number="7.6.10">
<h3><span class="header-section-number">7.6.10</span> Step 4:: Export with <code>write_formatted_excel()</code><a href="analysis.html#step-4-export-with-write_formatted_excel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can use any function to export the analysis however <code>write_formatted_excel()</code> can export formatted file. See the documentation for more details.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="analysis.html#cb224-1" aria-hidden="true" tabindex="-1"></a>write_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">overall_analysis =</span><span class="st">&quot;overall_analysis&quot;</span>,</span>
<span id="cb224-2"><a href="analysis.html#cb224-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">analysis_by_gender =</span><span class="st">&quot;analysis_by_gender&quot;</span></span>
<span id="cb224-3"><a href="analysis.html#cb224-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-4"><a href="analysis.html#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_formatted_excel</span>(write_list,<span class="st">&quot;analysis_output.xlsx&quot;</span>,</span>
<span id="cb224-5"><a href="analysis.html#cb224-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">header_front_size =</span> <span class="dv">12</span>,</span>
<span id="cb224-6"><a href="analysis.html#cb224-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">body_front =</span> <span class="st">&quot;Times&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="repeating-the-above" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Repeating the above<a href="analysis.html#repeating-the-above" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="analysis---top-x-ranking-select-one-and-select-multiple" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> Analysis - top X / ranking (select one and select multiple)<a href="analysis.html#analysis---top-x-ranking-select-one-and-select-multiple" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First: select_one question</p>
<p>The indicator of interest is <strong>e1_shelter_type</strong> and the options are:</p>
<ul>
<li>solid_finished_house</li>
<li>solid_finished_apartment</li>
<li>unfinished_nonenclosed_building</li>
<li>collective_shelter</li>
<li>tent</li>
<li>makeshift_shelter</li>
<li>none_sleeping_in_open</li>
<li>other_specify</li>
<li>dont_know_refuse_to_answer</li>
</ul>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="analysis.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top X/ranking for select_one type questions </span></span>
<span id="cb225-2"><a href="analysis.html#cb225-2" aria-hidden="true" tabindex="-1"></a>select_one_topX <span class="ot">&lt;-</span> <span class="cf">function</span>(df, question_name, <span class="at">X =</span> <span class="dv">3</span>) { <span class="co"># by default return top 3</span></span>
<span id="cb225-3"><a href="analysis.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test message</span></span>
<span id="cb225-4"><a href="analysis.html#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">colnames</span>(df)[<span class="fu">grepl</span>(question_name, <span class="fu">colnames</span>(df), <span class="at">fixed =</span> T)]) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb225-5"><a href="analysis.html#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;question name:&quot;</span>, question_name, <span class="st">&quot;doesn&#39;t exist in the main dataset. Please double check and make required changes!&quot;</span>)))</span>
<span id="cb225-6"><a href="analysis.html#cb225-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb225-7"><a href="analysis.html#cb225-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-8"><a href="analysis.html#cb225-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb225-9"><a href="analysis.html#cb225-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name))<span class="sc">%&gt;%</span>          </span>
<span id="cb225-10"><a href="analysis.html#cb225-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name))) <span class="sc">%&gt;%</span> <span class="co"># remove NA values from percentage calculations </span></span>
<span id="cb225-11"><a href="analysis.html#cb225-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(question_name, as.factor) <span class="sc">%&gt;%</span>  <span class="co"># added to have all groups</span></span>
<span id="cb225-12"><a href="analysis.html#cb225-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name), <span class="at">.drop=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb225-13"><a href="analysis.html#cb225-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb225-14"><a href="analysis.html#cb225-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">percentages =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb225-15"><a href="analysis.html#cb225-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(percentages)) <span class="sc">%&gt;%</span> </span>
<span id="cb225-16"><a href="analysis.html#cb225-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(question_name, as.character) <span class="sc">%&gt;%</span> </span>
<span id="cb225-17"><a href="analysis.html#cb225-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(X)   <span class="co"># keep top X percentages only </span></span>
<span id="cb225-18"><a href="analysis.html#cb225-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-19"><a href="analysis.html#cb225-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">warning</span>(<span class="st">&quot;None of the choices was selected!&quot;</span>)</span>
<span id="cb225-20"><a href="analysis.html#cb225-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb225-21"><a href="analysis.html#cb225-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb225-22"><a href="analysis.html#cb225-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb225-23"><a href="analysis.html#cb225-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-24"><a href="analysis.html#cb225-24" aria-hidden="true" tabindex="-1"></a><span class="co"># return top 4 shelter types</span></span>
<span id="cb225-25"><a href="analysis.html#cb225-25" aria-hidden="true" tabindex="-1"></a>shelter_type_top4 <span class="ot">&lt;-</span> <span class="fu">select_one_topX</span>(<span class="at">df =</span> main_dataset, <span class="at">question_name =</span> <span class="st">&quot;e1_shelter_type&quot;</span>, <span class="at">X =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Second: select_multiple question</p>
<p>The indicator of interest is <strong>e3_shelter_enclosure_issues</strong> and the options are:</p>
<ul>
<li>no_issues</li>
<li>lack_of_insulation_from_cold</li>
<li>leaks_during_light_rain_snow</li>
<li>leaks_during_heavy_rain_snow</li>
<li>limited_ventilation_less_than_05m2_ventilation_in_each_room_including_kitchen</li>
<li>presence_of_dirt_or_debris_removable</li>
<li>presence_of_dirt_or_debris_nonremovable</li>
<li>none_of_the_above</li>
<li>other_specify</li>
<li>dont_know</li>
</ul>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="analysis.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top X/ranking for select_multiple type questions</span></span>
<span id="cb226-2"><a href="analysis.html#cb226-2" aria-hidden="true" tabindex="-1"></a>select_multiple_topX <span class="ot">&lt;-</span> <span class="cf">function</span>(df, question_name, <span class="at">X =</span> <span class="dv">3</span>) {</span>
<span id="cb226-3"><a href="analysis.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test message</span></span>
<span id="cb226-4"><a href="analysis.html#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">colnames</span>(df)[<span class="fu">grepl</span>(question_name, <span class="fu">colnames</span>(df), <span class="at">fixed =</span> T)]) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb226-5"><a href="analysis.html#cb226-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;question name:&quot;</span>, question_name, <span class="st">&quot;doesn&#39;t exist in the main dataset. Please double check and make required changes!&quot;</span>)))</span>
<span id="cb226-6"><a href="analysis.html#cb226-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb226-7"><a href="analysis.html#cb226-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-8"><a href="analysis.html#cb226-8" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb226-9"><a href="analysis.html#cb226-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">colnames</span>(df)[<span class="fu">grepl</span>(<span class="fu">paste0</span>(question_name, <span class="st">&quot;.&quot;</span>), <span class="fu">colnames</span>(df), <span class="at">fixed =</span> T)])</span>
<span id="cb226-10"><a href="analysis.html#cb226-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-11"><a href="analysis.html#cb226-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if question was not answered</span></span>
<span id="cb226-12"><a href="analysis.html#cb226-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(df))) <span class="fu">warning</span>(<span class="st">&quot;None of the choices was selected!&quot;</span>)</span>
<span id="cb226-13"><a href="analysis.html#cb226-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-14"><a href="analysis.html#cb226-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keeping only the options names in the colnames</span></span>
<span id="cb226-15"><a href="analysis.html#cb226-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="fu">paste0</span>(question_name, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>), <span class="st">&quot;&quot;</span>, <span class="fu">colnames</span>(df))</span>
<span id="cb226-16"><a href="analysis.html#cb226-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-17"><a href="analysis.html#cb226-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate top X percentages</span></span>
<span id="cb226-18"><a href="analysis.html#cb226-18" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb226-19"><a href="analysis.html#cb226-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_all</span>(as.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb226-20"><a href="analysis.html#cb226-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> question_name, <span class="at">values_to =</span> <span class="st">&quot;choices&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb226-21"><a href="analysis.html#cb226-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(question_name), <span class="at">.drop=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb226-22"><a href="analysis.html#cb226-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(choices, <span class="at">na.rm =</span> T),</span>
<span id="cb226-23"><a href="analysis.html#cb226-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">percentages =</span> <span class="fu">round</span>(<span class="fu">sum</span>(choices, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">n</span>() <span class="sc">*</span> <span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove NA values from percentages calculations</span></span>
<span id="cb226-24"><a href="analysis.html#cb226-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(percentages)) <span class="sc">%&gt;%</span> </span>
<span id="cb226-25"><a href="analysis.html#cb226-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(X)   <span class="co"># keep top X percentages only </span></span>
<span id="cb226-26"><a href="analysis.html#cb226-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb226-27"><a href="analysis.html#cb226-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb226-28"><a href="analysis.html#cb226-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb226-29"><a href="analysis.html#cb226-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-30"><a href="analysis.html#cb226-30" aria-hidden="true" tabindex="-1"></a><span class="co"># return top 7 shelter enclosure issues</span></span>
<span id="cb226-31"><a href="analysis.html#cb226-31" aria-hidden="true" tabindex="-1"></a>shelter_enclosure_issues_top7 <span class="ot">&lt;-</span> <span class="fu">select_multiple_topX</span>(<span class="at">df =</span> main_dataset, <span class="at">question_name =</span> <span class="st">&quot;e3_shelter_enclosure_issues&quot;</span>, <span class="at">X =</span> <span class="dv">7</span>)</span></code></pre></div>
</div>
<div id="borda-count" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> Borda count<a href="analysis.html#borda-count" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="hypothesis-testing" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> Hypothesis testing<a href="analysis.html#hypothesis-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="t-test" class="section level3 hasAnchor" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> T-test<a href="analysis.html#t-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="what-is-a-t-test" class="section level4 hasAnchor" number="7.10.1.1">
<h4><span class="header-section-number">7.10.1.1</span> What is a T-test<a href="analysis.html#what-is-a-t-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A t-test is a type of inferential statistic used to determine if there is a significant difference between the means of two groups. A t-test is used as a hypothesis testing tool, which allows testing of an assumption applicable to a population.</p>
</div>
<div id="how-it-works" class="section level4 hasAnchor" number="7.10.1.2">
<h4><span class="header-section-number">7.10.1.2</span> How it works<a href="analysis.html#how-it-works" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Mathematically, the t-test takes a sample from each of the two sets and establishes the problem statement by assuming a null hypothesis that the two means are equal. Based on the applicable formulas, certain values are calculated and compared against the standard values, and the assumed null hypothesis is accepted or rejected accordingly.</p>
<p>If the null hypothesis qualifies to be rejected, it indicates that data readings are strong and are probably not due to chance.</p>
</div>
<div id="t-test-assumptions" class="section level4 hasAnchor" number="7.10.1.3">
<h4><span class="header-section-number">7.10.1.3</span> T-Test Assumptions<a href="analysis.html#t-test-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>The first assumption made regarding t-tests concerns the scale of measurement. The assumption for a t-test is that the scale of measurement applied to the data collected follows a continuous or ordinal scale, such as the scores for an IQ test.</p></li>
<li><p>The second assumption made is that of a simple random sample, that the data is collected from a representative, randomly selected portion of the total population.</p></li>
<li><p>The third assumption is the data, when plotted, results in a normal distribution, bell-shaped distribution curve.</p></li>
<li><p>The final assumption is the homogeneity of variance. Homogeneous, or equal, variance exists when the standard deviations of samples are approximately equal.</p></li>
</ul>
</div>
<div id="example" class="section level4 hasAnchor" number="7.10.1.4">
<h4><span class="header-section-number">7.10.1.4</span> Example<a href="analysis.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We are going to look at the income of the household for female/male headed household. The main_dataset doesn’t contain the head of household gender information, so we are creating and randomly populating the gender variable.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="analysis.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb227-2"><a href="analysis.html#cb227-2" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>hoh_gender <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>), <span class="fu">nrow</span>(main_dataset), <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb227-3"><a href="analysis.html#cb227-3" aria-hidden="true" tabindex="-1"></a>main_dataset<span class="sc">$</span>b15_hohh_income <span class="ot">=</span> <span class="fu">as.numeric</span>(main_dataset<span class="sc">$</span>b15_hohh_income)</span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="analysis.html#cb228-1" aria-hidden="true" tabindex="-1"></a>t_test_results <span class="ot">&lt;-</span> <span class="fu">t.test</span>(b15_hohh_income <span class="sc">~</span> hoh_gender, <span class="at">data =</span> main_dataset)</span>
<span id="cb228-2"><a href="analysis.html#cb228-2" aria-hidden="true" tabindex="-1"></a>t_test_results</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  b15_hohh_income by hoh_gender
## t = 0.19105, df = 1525.6, p-value = 0.8485
## alternative hypothesis: true difference in means between group Female and group Male is not equal to 0
## 95 percent confidence interval:
##  -270.3420  328.6883
## sample estimates:
## mean in group Female   mean in group Male 
##             3459.044             3429.871</code></pre>
<p>In the result above :</p>
<p>t is the t-test statistic value (t = -0.19105),
df is the degrees of freedom (df= 1525.6),
p-value is the significance level of the t-test (p-value = 0.8485).
conf.int is the confidence interval of the means difference at 95% (conf.int = [-270.3420, 328.6883]);
sample estimates is the mean value of the sample (mean = 3459.044, 3429.871).</p>
<p><strong>Interpretation:</strong></p>
<p>The p-value of the test is 0.8485, which is higher than the significance level alpha = 0.05. We can’t reject the null hypothesis and we can’t conclude that men headed household average income is significantly different from women headed household average income. Which makes sense in this case given that the gender variable was randomly generated.</p>
</div>
</div>
<div id="anova" class="section level3 hasAnchor" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> ANOVA<a href="analysis.html#anova" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="what-is-anova" class="section level4 hasAnchor" number="7.10.2.1">
<h4><span class="header-section-number">7.10.2.1</span> What is ANOVA<a href="analysis.html#what-is-anova" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Similar to T-test, ANOVA is a statistical test for estimating how a quantitative dependent variable changes according to the levels of one or more categorical independent variables. ANOVA tests whether there is a difference in means of the groups at each level of the independent variable.</p>
<p>The null hypothesis (H0) of the ANOVA is no difference in means, and the alternate hypothesis (Ha) is that the means are different from one another.</p>
<p>The T-test is used to compare the means between two groups, whereas ANOVA is used to compare the means among three or more groups.</p>
</div>
<div id="types-of-anova" class="section level4 hasAnchor" number="7.10.2.2">
<h4><span class="header-section-number">7.10.2.2</span> Types of ANOVA<a href="analysis.html#types-of-anova" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two main types of ANOVA: one-way (or unidirectional) and two-way.
A two-way ANOVA is an extension of the one-way ANOVA. With a one-way, you have one independent variable affecting a dependent variable. With a two-way ANOVA, there are two independents. For example, a two-way ANOVA allows a company to compare worker productivity based on two independent variables, such as salary and skill set. It is utilized to observe the interaction between the two factors and tests the effect of two factors at the same time.</p>
</div>
<div id="example-1" class="section level4 hasAnchor" number="7.10.2.3">
<h4><span class="header-section-number">7.10.2.3</span> Example<a href="analysis.html#example-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We are using the same example as the previous test.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="analysis.html#cb230-1" aria-hidden="true" tabindex="-1"></a>res.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(b15_hohh_income <span class="sc">~</span> hoh_gender, <span class="at">data =</span> main_dataset)</span>
<span id="cb230-2"><a href="analysis.html#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="analysis.html#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res.aov)</span></code></pre></div>
<pre><code>##               Df    Sum Sq Mean Sq F value Pr(&gt;F)
## hoh_gender     1 3.291e+05  329075   0.036  0.849
## Residuals   1546 1.408e+10 9109185               
## 69 observations deleted due to missingness</code></pre>
<p>As the p-value is more than the significance level 0.05, we can’t conclude that there are significant differences between the hoh_gender groups.</p>
</div>
<div id="bonus-visualization-of-the-data-to-confirm-the-findinds" class="section level4 hasAnchor" number="7.10.2.4">
<h4><span class="header-section-number">7.10.2.4</span> Bonus : Visualization of the data to confirm the findinds<a href="analysis.html#bonus-visualization-of-the-data-to-confirm-the-findinds" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="analysis.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggpubr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:spatstat.geom&#39;:
## 
##     border, rotate</code></pre>
<pre><code>## The following object is masked from &#39;package:expss&#39;:
## 
##     compare_means</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="analysis.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggline</span>(main_dataset, <span class="at">x =</span> <span class="st">&quot;hoh_gender&quot;</span>, <span class="at">y =</span> <span class="st">&quot;b15_hohh_income&quot;</span>, </span>
<span id="cb236-2"><a href="analysis.html#cb236-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="fu">c</span>(<span class="st">&quot;mean_se&quot;</span>, <span class="st">&quot;jitter&quot;</span>), </span>
<span id="cb236-3"><a href="analysis.html#cb236-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">order =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>),</span>
<span id="cb236-4"><a href="analysis.html#cb236-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">&quot;HH income&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;hoh gender&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
</div>
</div>
<div id="chi-squares" class="section level3 hasAnchor" number="7.10.3">
<h3><span class="header-section-number">7.10.3</span> chi-squares<a href="analysis.html#chi-squares" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pearson`s chi-squared test.
Chi-squared test is a statistical hypothesis test, based on comparing expected and observed frequencies of 2-way distribution (2-way table).</p>
<p>There are three types of tests (hypothesis) that could be tested with chi-squared: independence of variables, homogenity of distribution of the characteristic across “stratas” and goodness of fit (whether the actual distribution is different from the hypothetical one). Two former versions use the same calculation.</p>
<p>Chi-squared test is a non-parametric test.
It is used with nominal to nominal (nominal to ordinal) scales.
For running chi-squared test, each cell of the crosstab should contain at least 5 observations.</p>
<p>Note, that chi-squared test indicates significance of differences in values on a <em>table level</em>. Thus, it is impossible to track significance in differences for particular options.</p>
<p>(For example, it is possible to say that satisfaction with public transport and living in urban / rural areas are connected. However, we can conclude from the test itself, that “satisfied” and “dissatisfied” options differ, while “indifferent” does not. By the way, it is possible to come up with this conclusion while interpreting a corresponding crosstab. Also, chi-squared test can tell nothing about the strength and the direction of a liaison between variables).</p>
<div id="chi-squared-test-for-independence" class="section level4 hasAnchor" number="7.10.3.1">
<h4><span class="header-section-number">7.10.3.1</span> Chi-squared test for independence<a href="analysis.html#chi-squared-test-for-independence" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The test for weighted data is being run with the survey library</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="analysis.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb237-2"><a href="analysis.html#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb237-3"><a href="analysis.html#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(weights)</span></code></pre></div>
<p>The use of the survey package functions requires specifying survey design object (which reslects sampling approach).</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="analysis.html#cb238-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb238-2"><a href="analysis.html#cb238-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-3"><a href="analysis.html#cb238-3" aria-hidden="true" tabindex="-1"></a>svy_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">data=</span>main_dataset, </span>
<span id="cb238-4"><a href="analysis.html#cb238-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb238-5"><a href="analysis.html#cb238-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">strata =</span> main_dataset<span class="sc">$</span>strata, </span>
<span id="cb238-6"><a href="analysis.html#cb238-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">probs =</span> <span class="cn">NULL</span>,</span>
<span id="cb238-7"><a href="analysis.html#cb238-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights =</span> main_dataset<span class="sc">$</span>stratum.weight)</span></code></pre></div>
<p>Specifying function for getting chi-squared outputs.</p>
<p>Hereby test Chi^2 test of independence is used. So, the test is performed to find out if strata variable and target variable are independent,
<strong>H0</strong> - the distribution of target variable values is equal across all stratas
<strong>H1</strong> - strata and target var are not independent, so distribution varies across stratas.</p>
<p>Apart from getting test statistic and p value, we would like to detect manually what are the biggest and the smallest values across groups/stratas (in case if the difference is significant and it makes sense to do it).</p>
<p>Hereby test Chi^2 test of independence is used. So, the test is performed to find out if strata variable and target variable are independent,
H0 - the distribution of target var. values is equal across all stratas
H1 - strata and target var are not independent, so distribution varies across stratas.</p>
<p>Within the Survey package, the suggested function uses Scott &amp; Rao adjustment for complex survey design</p>
<p>#####Simple single call of the test.</p>
<p>Let’s say that the research aim is to understand whether the main water source is dependent on the area where HH lives (strata variable).</p>
<p>Thus, in our case:
H0 - the distribution of water source is equal across stratas and these variables are independent
H1 - the distribution of water source differs by strata and these variables are not independent.</p>
<p>Running the chi-squared test:</p>
<p>(Survey version - requires a survey design object)</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="analysis.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svychisq</span>(<span class="sc">~</span> f11_dinking_water_source <span class="sc">+</span> strata, <span class="at">design =</span> svy_design, <span class="at">statistic =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s X^2: Rao &amp; Scott adjustment
## 
## data:  svychisq(~f11_dinking_water_source + strata, design = svy_design,     statistic = &quot;Chisq&quot;)
## X-squared = 244.62, df = 21, p-value &lt; 2.2e-16</code></pre>
<p>The current output presents the result of Pearson’s chi-squared test (Rao &amp; Scott adjustment accounts for weighted data) [<a href="https://www.researchgate.net/publication/38360147_On_Simple_Adjustments_to_Chi-Square_Tests_with_Sample_Survey_Data" class="uri">https://www.researchgate.net/publication/38360147_On_Simple_Adjustments_to_Chi-Square_Tests_with_Sample_Survey_Data</a>].</p>
<p>The output consist of three parameters:
1. X-squared - observed value of chi-squared parameter,
2. df - “degrees of freedom” or number of independent categories in data -1
Having only these two elements it is possible to see, if with the current number of df, the value of chi-squared parameter is greater than the critical value for the chosen level of probability, using (tables of chi-squared critical values) [<a href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm" class="uri">https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm</a>]
Fortunately, R provides us with the third parameter, which allows us to skip this step.
3. p-value - stands for the probability of getting value of the chi-squared parameter greater or equal to the given one assuming that H0 is true. If p-value &lt; 0.05 (for 95% confidence level, or 0.01 for 99%), the H0 can be rejected.</p>
<p>In the current example, as p-value is very low, H0 can be rejected, and hence, strata variable and drinking water source are not independent.</p>
<p>(Weights package - can work with the dataframe directly, without the survey design object)</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="analysis.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wtd.chi.sq</span>(<span class="at">var1 =</span> main_dataset<span class="sc">$</span>f11_dinking_water_source, <span class="at">var2 =</span> main_dataset<span class="sc">$</span>strata, <span class="at">weight =</span> main_dataset<span class="sc">$</span>stratum.weight)</span></code></pre></div>
<pre><code>##        Chisq           df      p.value 
## 2.446205e+02 2.100000e+01 4.928158e-40</code></pre>
<p>Specifying the function for crosstabs with chi-squared tests for independence.</p>
<p>#####Functions to have test results along with crosstabs</p>
<ol style="list-style-type: decimal">
<li>The function with survey design object.</li>
</ol>
<p>Apart from getting test statistic and p value, we would like to detect manually what are the biggest and the smallest values across groups/stratas (in case if the difference is significant and it makes sense to do it).</p>
<p>The function also helps to find out smallest and the largest values per row</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="analysis.html#cb243-1" aria-hidden="true" tabindex="-1"></a>chi2_ind_extr <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, design){</span>
<span id="cb243-2"><a href="analysis.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  my_var <span class="ot">&lt;-</span> y</span>
<span id="cb243-3"><a href="analysis.html#cb243-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-4"><a href="analysis.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="co"># running Pearson&#39;s chi-squared test</span></span>
<span id="cb243-5"><a href="analysis.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  s_chi <span class="ot">&lt;-</span> <span class="fu">svychisq</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~&quot;</span>, x,<span class="st">&quot;+&quot;</span>, y)), design, <span class="at">statistic =</span> <span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb243-6"><a href="analysis.html#cb243-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-7"><a href="analysis.html#cb243-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extracting basic parameters</span></span>
<span id="cb243-8"><a href="analysis.html#cb243-8" aria-hidden="true" tabindex="-1"></a>  wmy_t <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(s_chi<span class="sc">$</span>observed)</span>
<span id="cb243-9"><a href="analysis.html#cb243-9" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>p <span class="ot">&lt;-</span> s_chi<span class="sc">$</span>p.value</span>
<span id="cb243-10"><a href="analysis.html#cb243-10" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>chi_adj <span class="ot">&lt;-</span> s_chi<span class="sc">$</span>statistic</span>
<span id="cb243-11"><a href="analysis.html#cb243-11" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>df <span class="ot">&lt;-</span> s_chi<span class="sc">$</span>parameter</span>
<span id="cb243-12"><a href="analysis.html#cb243-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#indicating significance</span></span>
<span id="cb243-13"><a href="analysis.html#cb243-13" aria-hidden="true" tabindex="-1"></a>  wmy_t<span class="sc">$</span>independence <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wmy_t<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">&quot;h1&quot;</span>, <span class="st">&quot;h0&quot;</span>)</span>
<span id="cb243-14"><a href="analysis.html#cb243-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(wmy_t)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var_x&quot;</span>, <span class="st">&quot;var_y&quot;</span>)</span>
<span id="cb243-15"><a href="analysis.html#cb243-15" aria-hidden="true" tabindex="-1"></a>  wmy_t_w <span class="ot">&lt;-</span> <span class="fu">spread</span>(wmy_t, var_y, Freq)</span>
<span id="cb243-16"><a href="analysis.html#cb243-16" aria-hidden="true" tabindex="-1"></a>  wmy_t_w[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(x, <span class="st">&quot; &quot;</span>, wmy_t_w[,<span class="dv">1</span>])</span>
<span id="cb243-17"><a href="analysis.html#cb243-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(wmy_t_w)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;variable&quot;</span></span>
<span id="cb243-18"><a href="analysis.html#cb243-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># getting percent from weighted frequencies</span></span>
<span id="cb243-19"><a href="analysis.html#cb243-19" aria-hidden="true" tabindex="-1"></a>  cols_no_prop <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;independence&quot;</span>, <span class="st">&quot;max&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;chi_adj&quot;</span>, <span class="st">&quot;df&quot;</span>)</span>
<span id="cb243-20"><a href="analysis.html#cb243-20" aria-hidden="true" tabindex="-1"></a>  wmy_t_w[, <span class="sc">!</span><span class="fu">colnames</span>(wmy_t_w) <span class="sc">%in%</span> cols_no_prop] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(wmy_t_w[, <span class="sc">!</span><span class="fu">colnames</span>(wmy_t_w) <span class="sc">%in%</span> cols_no_prop], <span class="cf">function</span>(x){x<span class="sc">/</span><span class="fu">sum</span>(x, <span class="at">na.rm =</span> T)})</span>
<span id="cb243-21"><a href="analysis.html#cb243-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># indicating extremum values</span></span>
<span id="cb243-22"><a href="analysis.html#cb243-22" aria-hidden="true" tabindex="-1"></a>  cols_to_compare <span class="ot">&lt;-</span> <span class="fu">colnames</span>(wmy_t_w)[<span class="sc">!</span><span class="fu">colnames</span>(wmy_t_w) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;chi_adj&quot;</span>, <span class="st">&quot;df&quot;</span>, <span class="st">&quot;independence&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;max&quot;</span>, <span class="st">&quot;variable&quot;</span>)]</span>
<span id="cb243-23"><a href="analysis.html#cb243-23" aria-hidden="true" tabindex="-1"></a>  wmy_t_w<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wmy_t_w<span class="sc">$</span>independence <span class="sc">==</span> <span class="st">&quot;h1&quot;</span>, cols_to_compare[<span class="fu">apply</span>(wmy_t_w, <span class="dv">1</span>, which.max)], <span class="dv">0</span>)</span>
<span id="cb243-24"><a href="analysis.html#cb243-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-25"><a href="analysis.html#cb243-25" aria-hidden="true" tabindex="-1"></a>  wmy_t_w<span class="sc">$</span>min <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wmy_t_w<span class="sc">$</span>independence <span class="sc">==</span> <span class="st">&quot;h1&quot;</span>, cols_to_compare[<span class="fu">apply</span>(wmy_t_w, <span class="dv">1</span>, which.min)], <span class="dv">0</span>)</span>
<span id="cb243-26"><a href="analysis.html#cb243-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-27"><a href="analysis.html#cb243-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#adding Overall value to the table</span></span>
<span id="cb243-28"><a href="analysis.html#cb243-28" aria-hidden="true" tabindex="-1"></a>  ovl_tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">svytable</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;~&quot;</span>,x)), design)))</span>
<span id="cb243-29"><a href="analysis.html#cb243-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ovl_tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;options&quot;</span>, <span class="st">&quot;overall&quot;</span>)</span>
<span id="cb243-30"><a href="analysis.html#cb243-30" aria-hidden="true" tabindex="-1"></a>  wmy_t_w <span class="ot">&lt;-</span> wmy_t_w <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(ovl_tab)</span>
<span id="cb243-31"><a href="analysis.html#cb243-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(wmy_t_w)</span>
<span id="cb243-32"><a href="analysis.html#cb243-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The use with a single-choice question</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="analysis.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi2_ind_extr</span>(<span class="st">&quot;f11_dinking_water_source&quot;</span>, <span class="st">&quot;strata&quot;</span>, svy_design)</span></code></pre></div>
<pre><code>##                                                                                 variable
## 1                      f11_dinking_water_source bottled_water_water_purchased_in_bottles
## 2 f11_dinking_water_source drinking_water_from_water_kiosk_booth_with_water_for_bottling
## 3                                                 f11_dinking_water_source other_specify
## 4                                                 f11_dinking_water_source personal_well
## 5                        f11_dinking_water_source public_well_or_boreholes_shared_access
## 6                   f11_dinking_water_source tap_drinking_water_centralized_water_supply
## 7                                         f11_dinking_water_source technical_piped_water
## 8                        f11_dinking_water_source trucked_in_water_truck_with_a_tank_etc
##              p  chi_adj df independence 20km_rural 20km_urban   5km_rural
## 1 9.386389e-50 244.6205 21           h1 0.02457002 0.07673267 0.034825871
## 2 9.386389e-50 244.6205 21           h1 0.19901720 0.29950495 0.131840796
## 3 9.386389e-50 244.6205 21           h1 0.01228501 0.00000000 0.007462687
## 4 9.386389e-50 244.6205 21           h1 0.32432432 0.09653465 0.482587065
## 5 9.386389e-50 244.6205 21           h1 0.15724816 0.05445545 0.151741294
## 6 9.386389e-50 244.6205 21           h1 0.22358722 0.43316832 0.144278607
## 7 9.386389e-50 244.6205 21           h1 0.00000000 0.00000000 0.000000000
## 8 9.386389e-50 244.6205 21           h1 0.05896806 0.03960396 0.047263682
##     5km_urban       max        min
## 1 0.032178218 5km_rural 20km_urban
## 2 0.274752475 5km_rural 20km_urban
## 3 0.007425743 5km_rural       &lt;NA&gt;
## 4 0.121287129 5km_rural 20km_urban
## 5 0.099009901 5km_rural 20km_urban
## 6 0.383663366 5km_rural 20km_urban
## 7 0.004950495 5km_rural       &lt;NA&gt;
## 8 0.076732673 5km_rural 20km_urban
##                                                         options     overall
## 1                      bottled_water_water_purchased_in_bottles 0.049170548
## 2 drinking_water_from_water_kiosk_booth_with_water_for_bottling 0.263132750
## 3                                                 other_specify 0.005188695
## 4                                                 personal_well 0.167758525
## 5                        public_well_or_boreholes_shared_access 0.093728457
## 6                   tap_drinking_water_centralized_water_supply 0.362248561
## 7                                         technical_piped_water 0.001836837
## 8                        trucked_in_water_truck_with_a_tank_etc 0.056935627</code></pre>
<p>In the given output, <strong>p</strong> indicates chi-squared test p-value, <strong>chi_adj</strong> - value of chi-squared parameter, <strong>df</strong> - degrees of freedom, <strong>independence</strong> - indicates which hypothesis is accepted, h0 or h1. In the current function, H1 is accepted if p &lt; 0.05. In case H0 is rejected and H1 accepted, in <strong>min</strong> and <strong>max</strong> columns minimum and maximum y variable categories are given.</p>
<p>The use with a multiple-choice question.</p>
<p>The test would not work if any of dummies consists from zeros only, it need to be checked in advance, thus, let’s filter such variables out from the vector of variable names</p>
<p>Getting full range of dummies from the question</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="analysis.html#cb246-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb246-2"><a href="analysis.html#cb246-2" aria-hidden="true" tabindex="-1"></a>f12 <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;f12_drinking_water_treat.&quot;</span>, names)]</span></code></pre></div>
<p>Defining a function which would remove zero-sum variables for us</p>
<p>if the absence of empty cells for each strata is needed, per_cell = T</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="analysis.html#cb247-1" aria-hidden="true" tabindex="-1"></a>non_zero_for_test <span class="ot">&lt;-</span> <span class="cf">function</span>(var, strata, dataset, <span class="at">per_cell =</span> F){</span>
<span id="cb247-2"><a href="analysis.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(dataset[, <span class="fu">names</span>(dataset) <span class="sc">%in%</span> var], sum))</span>
<span id="cb247-3"><a href="analysis.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rownames</span>(sum), sum)</span>
<span id="cb247-4"><a href="analysis.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  filtered <span class="ot">&lt;-</span> sum[sum[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb247-5"><a href="analysis.html#cb247-5" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(dataset[,<span class="fu">names</span>(dataset) <span class="sc">%in%</span> filtered], table, dataset[, strata]))</span>
<span id="cb247-6"><a href="analysis.html#cb247-6" aria-hidden="true" tabindex="-1"></a>  ntab <span class="ot">&lt;-</span> <span class="fu">names</span>(tab)</span>
<span id="cb247-7"><a href="analysis.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#if the absence of empty cells for each strata is needed, per_cell = T</span></span>
<span id="cb247-8"><a href="analysis.html#cb247-8" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> tab[, <span class="fu">which</span>(<span class="fu">colnames</span>(tab) <span class="sc">%in%</span> ntab)]</span>
<span id="cb247-9"><a href="analysis.html#cb247-9" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">apply</span>(tab, <span class="dv">2</span>, <span class="cf">function</span>(x) x<span class="sc">==</span><span class="dv">0</span>), <span class="dv">2</span>, any)</span>
<span id="cb247-10"><a href="analysis.html#cb247-10" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> zeros[zeros <span class="sc">==</span> F]</span>
<span id="cb247-11"><a href="analysis.html#cb247-11" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(zeros)</span>
<span id="cb247-12"><a href="analysis.html#cb247-12" aria-hidden="true" tabindex="-1"></a>  zeros <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rownames</span>(zeros), zeros)</span>
<span id="cb247-13"><a href="analysis.html#cb247-13" aria-hidden="true" tabindex="-1"></a>  zeros_lab <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(zeros[,<span class="dv">1</span>], <span class="at">split =</span> <span class="st">&quot;.Freq&quot;</span>)))</span>
<span id="cb247-14"><a href="analysis.html#cb247-14" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb247-15"><a href="analysis.html#cb247-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(per_cell <span class="sc">==</span> T){</span>
<span id="cb247-16"><a href="analysis.html#cb247-16" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> zeros_lab</span>
<span id="cb247-17"><a href="analysis.html#cb247-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb247-18"><a href="analysis.html#cb247-18" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> ntab</span>
<span id="cb247-19"><a href="analysis.html#cb247-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb247-20"><a href="analysis.html#cb247-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="fu">abs</span>(<span class="fu">length</span>(var) <span class="sc">-</span> <span class="fu">length</span>(result)), <span class="st">&quot; variables were removed because of containing zeros in stratas&quot;</span>))</span>
<span id="cb247-21"><a href="analysis.html#cb247-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb247-22"><a href="analysis.html#cb247-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb247-23"><a href="analysis.html#cb247-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Using the test with multiple choice question.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="analysis.html#cb248-1" aria-hidden="true" tabindex="-1"></a>nz_f12 <span class="ot">&lt;-</span> <span class="fu">non_zero_for_test</span>(f12, <span class="st">&quot;strata&quot;</span>, main_dataset, <span class="at">per_cell =</span> F)</span></code></pre></div>
<pre><code>## 2 variables were removed because of containing zeros in stratas</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="analysis.html#cb250-1" aria-hidden="true" tabindex="-1"></a>f12_sig <span class="ot">&lt;-</span> <span class="fu">lapply</span>(nz_f12, chi2_ind_extr, <span class="at">y =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">design =</span> svy_design)</span>
<span id="cb250-2"><a href="analysis.html#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="analysis.html#cb250-3" aria-hidden="true" tabindex="-1"></a>f12_sig_df <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(rbind, f12_sig)</span>
<span id="cb250-4"><a href="analysis.html#cb250-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-5"><a href="analysis.html#cb250-5" aria-hidden="true" tabindex="-1"></a><span class="co">#removing 0 (&quot;not selected&quot;) options</span></span>
<span id="cb250-6"><a href="analysis.html#cb250-6" aria-hidden="true" tabindex="-1"></a>f12_sig_df <span class="ot">&lt;-</span> f12_sig_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(options <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb250-7"><a href="analysis.html#cb250-7" aria-hidden="true" tabindex="-1"></a>f12_sig_df</span></code></pre></div>
<pre><code>##                                                                variable
## 1       f12_drinking_water_treat.cleaning_with_chemicals_chlorination 1
## 2                        f12_drinking_water_treat.water_precipitation 1
## 3         f12_drinking_water_treat.filtering_the_water_pitcher_filter 1
## 4 f12_drinking_water_treat.filtering_the_water_reverse_osmosis_filter 1
## 5                                    f12_drinking_water_treat.boiling 1
## 6                                f12_drinking_water_treat.percolation 1
## 7                              f12_drinking_water_treat.other_specify 1
## 8                      f12_drinking_water_treat.do_not_process_purify 1
##            p  chi_adj df independence  20km_rural  20km_urban   5km_rural
## 1 0.03100696 4.780006  3           h1 0.000000000 0.004950495 0.000000000
## 2 0.02775288 7.977278  3           h1 0.073710074 0.126237624 0.104477612
## 3 0.55635016 1.828231  3           h0 0.046683047 0.069306931 0.059701493
## 4 0.44029529 2.347539  3           h0 0.027027027 0.037128713 0.017412935
## 5 0.02724163 8.191084  3           h1 0.260442260 0.274752475 0.223880597
## 6 0.24801653 3.459406  3           h0 0.004914005 0.002475248 0.007462687
## 7 0.28029092 2.860754  3           h0 0.004914005 0.002475248 0.000000000
## 8 0.01762880 9.011919  3           h1 0.624078624 0.551980198 0.674129353
##    5km_urban       max        min options     overall
## 1 0.00000000 5km_rural       &lt;NA&gt;       1 0.002000313
## 2 0.14108911 5km_rural 20km_urban       1 0.122036605
## 3 0.06930693         0          0       1 0.065108190
## 4 0.04207921         0          0       1 0.036036995
## 5 0.20792079 5km_rural 20km_urban       1 0.244239386
## 6 0.00000000         0          0       1 0.002279393
## 7 0.00000000         0          0       1 0.001769625
## 8 0.60643564 5km_rural 20km_urban       1 0.591818943</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>The function without the survey design object</li>
</ol>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="analysis.html#cb252-1" aria-hidden="true" tabindex="-1"></a>chi2_ind_wtd <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, weight, dataset){</span>
<span id="cb252-2"><a href="analysis.html#cb252-2" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb252-3"><a href="analysis.html#cb252-3" aria-hidden="true" tabindex="-1"></a>  table_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb252-4"><a href="analysis.html#cb252-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb252-5"><a href="analysis.html#cb252-5" aria-hidden="true" tabindex="-1"></a>  ni <span class="ot">&lt;-</span> x[i]</span>
<span id="cb252-6"><a href="analysis.html#cb252-6" aria-hidden="true" tabindex="-1"></a>  ti <span class="ot">&lt;-</span> dataset <span class="sc">%&gt;%</span> </span>
<span id="cb252-7"><a href="analysis.html#cb252-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(y))) <span class="sc">%&gt;%</span></span>
<span id="cb252-8"><a href="analysis.html#cb252-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(y), <span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> </span>
<span id="cb252-9"><a href="analysis.html#cb252-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb252-10"><a href="analysis.html#cb252-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weight)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb252-11"><a href="analysis.html#cb252-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">varnam =</span> ni)</span>
<span id="cb252-12"><a href="analysis.html#cb252-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var_ind&quot;</span>, <span class="st">&quot;var_dep_val&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>,  <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;dep_var_nam&quot;</span>)</span>
<span id="cb252-13"><a href="analysis.html#cb252-13" aria-hidden="true" tabindex="-1"></a>  ti <span class="ot">&lt;-</span> ti <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">base =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(n)))</span>
<span id="cb252-14"><a href="analysis.html#cb252-14" aria-hidden="true" tabindex="-1"></a>  chi_test  <span class="ot">&lt;-</span> <span class="fu">wtd.chi.sq</span>(<span class="at">var1 =</span> dataset[, <span class="fu">paste0</span>(y)], <span class="at">var2 =</span> dataset[, <span class="fu">paste0</span>(ni)], <span class="at">weight =</span> dataset[, <span class="fu">paste0</span>(weight)])</span>
<span id="cb252-15"><a href="analysis.html#cb252-15" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>chisq <span class="ot">&lt;-</span> chi_test[<span class="dv">1</span>]</span>
<span id="cb252-16"><a href="analysis.html#cb252-16" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>df <span class="ot">&lt;-</span> chi_test[<span class="dv">2</span>]</span>
<span id="cb252-17"><a href="analysis.html#cb252-17" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>p <span class="ot">&lt;-</span> chi_test[<span class="dv">3</span>]</span>
<span id="cb252-18"><a href="analysis.html#cb252-18" aria-hidden="true" tabindex="-1"></a>  ti<span class="sc">$</span>hypo <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ti<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">&quot;h1&quot;</span>, <span class="st">&quot;h0&quot;</span>)</span>
<span id="cb252-19"><a href="analysis.html#cb252-19" aria-hidden="true" tabindex="-1"></a>  table_new <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_new, ti)</span>
<span id="cb252-20"><a href="analysis.html#cb252-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb252-21"><a href="analysis.html#cb252-21" aria-hidden="true" tabindex="-1"></a>table_cl_new_1 <span class="ot">&lt;-</span> table_new <span class="sc">%&gt;%</span> </span>
<span id="cb252-22"><a href="analysis.html#cb252-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(var_dep_val != &quot;0&quot;) %&gt;% </span></span>
<span id="cb252-23"><a href="analysis.html#cb252-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var_dep_val))</span>
<span id="cb252-24"><a href="analysis.html#cb252-24" aria-hidden="true" tabindex="-1"></a><span class="co">#mutate(var_id = paste0(dep_var_nam, &quot;.&quot;, var_dep_val))</span></span>
<span id="cb252-25"><a href="analysis.html#cb252-25" aria-hidden="true" tabindex="-1"></a>table_cl_new_1 <span class="ot">&lt;-</span> table_cl_new_1[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb252-26"><a href="analysis.html#cb252-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-27"><a href="analysis.html#cb252-27" aria-hidden="true" tabindex="-1"></a>table_sprd <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">spread</span>(table_cl_new_1, var_ind, prop) <span class="sc">%&gt;%</span></span>
<span id="cb252-28"><a href="analysis.html#cb252-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dep_var_nam)</span>
<span id="cb252-29"><a href="analysis.html#cb252-29" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(table_sprd)</span>
<span id="cb252-30"><a href="analysis.html#cb252-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The use with the single choice question</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="analysis.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi2_ind_wtd</span>(<span class="at">x =</span> <span class="st">&quot;f11_dinking_water_source&quot;</span>, <span class="at">y =</span> <span class="st">&quot;strata&quot;</span>,</span>
<span id="cb253-2"><a href="analysis.html#cb253-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">weight =</span> <span class="st">&quot;stratum.weight&quot;</span>, main_dataset)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;strata&#39;. You can
## override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 8 × 11
##   var_dep_val          dep_var_nam  base chisq    df        p hypo  `20km_rural`
##   &lt;chr&gt;                &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1 bottled_water_water… f11_dinkin…  1617  245.    21 4.93e-40 h1          0.0246
## 2 drinking_water_from… f11_dinkin…  1617  245.    21 4.93e-40 h1          0.199 
## 3 other_specify        f11_dinkin…  1617  245.    21 4.93e-40 h1          0.0123
## 4 personal_well        f11_dinkin…  1617  245.    21 4.93e-40 h1          0.324 
## 5 public_well_or_bore… f11_dinkin…  1617  245.    21 4.93e-40 h1          0.157 
## 6 tap_drinking_water_… f11_dinkin…  1617  245.    21 4.93e-40 h1          0.224 
## 7 technical_piped_wat… f11_dinkin…  1617  245.    21 4.93e-40 h1         NA     
## 8 trucked_in_water_tr… f11_dinkin…  1617  245.    21 4.93e-40 h1          0.0590
## # ℹ 3 more variables: `20km_urban` &lt;dbl&gt;, `5km_rural` &lt;dbl&gt;, `5km_urban` &lt;dbl&gt;</code></pre>
<p>The use with multiple choice questions</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="analysis.html#cb256-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb256-2"><a href="analysis.html#cb256-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-3"><a href="analysis.html#cb256-3" aria-hidden="true" tabindex="-1"></a>f12_names <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;f12_drinking_water_treat.&quot;</span>, names)]</span>
<span id="cb256-4"><a href="analysis.html#cb256-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-5"><a href="analysis.html#cb256-5" aria-hidden="true" tabindex="-1"></a>f12_sig2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(f12_names, chi2_ind_wtd, <span class="at">y =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">weight =</span> <span class="st">&quot;stratum.weight&quot;</span>, main_dataset)</span>
<span id="cb256-6"><a href="analysis.html#cb256-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-7"><a href="analysis.html#cb256-7" aria-hidden="true" tabindex="-1"></a>f12_tab_df <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(rbind, f12_sig2)</span>
<span id="cb256-8"><a href="analysis.html#cb256-8" aria-hidden="true" tabindex="-1"></a>f12_tab_df</span></code></pre></div>
<pre><code>## # A tibble: 18 × 11
##    var_dep_val dep_var_nam            base chisq    df      p hypo  `20km_rural`
##          &lt;int&gt; &lt;chr&gt;                 &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1           0 f12_drinking_water_t…  1617  4.78     3 0.189  h0         1      
##  2           1 f12_drinking_water_t…  1617  4.78     3 0.189  h0        NA      
##  3           0 f12_drinking_water_t…  1617  7.98     3 0.0465 h1         0.926  
##  4           1 f12_drinking_water_t…  1617  7.98     3 0.0465 h1         0.0737 
##  5           0 f12_drinking_water_t…  1617  1.83     3 0.609  h0         0.953  
##  6           1 f12_drinking_water_t…  1617  1.83     3 0.609  h0         0.0467 
##  7           0 f12_drinking_water_t…  1617  2.35     3 0.503  h0         0.973  
##  8           1 f12_drinking_water_t…  1617  2.35     3 0.503  h0         0.0270 
##  9           0 f12_drinking_water_t…  1617  8.19     3 0.0422 h1         0.740  
## 10           1 f12_drinking_water_t…  1617  8.19     3 0.0422 h1         0.260  
## 11           0 f12_drinking_water_t…  1617  3.46     3 0.326  h0         0.995  
## 12           1 f12_drinking_water_t…  1617  3.46     3 0.326  h0         0.00491
## 13           0 f12_drinking_water_t…  1617  2.86     3 0.414  h0         0.995  
## 14           1 f12_drinking_water_t…  1617  2.86     3 0.414  h0         0.00491
## 15           0 f12_drinking_water_t…  1617  0        0 1      h0         1      
## 16           0 f12_drinking_water_t…  1617  0        0 1      h0         1      
## 17           0 f12_drinking_water_t…  1617  9.01     3 0.0291 h1         0.376  
## 18           1 f12_drinking_water_t…  1617  9.01     3 0.0291 h1         0.624  
## # ℹ 3 more variables: `20km_urban` &lt;dbl&gt;, `5km_rural` &lt;dbl&gt;, `5km_urban` &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="chi-squared-goodness-of-fit-test" class="section level3 hasAnchor" number="7.10.4">
<h3><span class="header-section-number">7.10.4</span> Chi-squared Goodness of Fit test<a href="analysis.html#chi-squared-goodness-of-fit-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Goodness of test chi-squared test is used to compare the observed distribution with the hypothetical one,</p>
<p>For instance, we would like to test the hypothesis, that 90% of HHs had soap in their HHs at the moment of the survey.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="analysis.html#cb258-1" aria-hidden="true" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">soap =</span> <span class="fu">case_when</span>(</span>
<span id="cb258-2"><a href="analysis.html#cb258-2" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;dont_know_refuse_to_answer&quot;</span> <span class="sc">~</span> <span class="st">&quot;NA&quot;</span>,</span>
<span id="cb258-3"><a href="analysis.html#cb258-3" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">~</span> <span class="st">&quot;no&quot;</span>,</span>
<span id="cb258-4"><a href="analysis.html#cb258-4" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;yes_soap_is_not_shown&quot;</span> <span class="sc">~</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb258-5"><a href="analysis.html#cb258-5" aria-hidden="true" tabindex="-1"></a> p16_soap_household <span class="sc">==</span> <span class="st">&quot;yes_soap_is_shown&quot;</span> <span class="sc">~</span> <span class="st">&quot;yes&quot;</span></span>
<span id="cb258-6"><a href="analysis.html#cb258-6" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb258-7"><a href="analysis.html#cb258-7" aria-hidden="true" tabindex="-1"></a>soap_prob <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(main_dataset<span class="sc">$</span>soap)))</span>
<span id="cb258-8"><a href="analysis.html#cb258-8" aria-hidden="true" tabindex="-1"></a>soap_prob <span class="ot">&lt;-</span> soap_prob[, <span class="dv">2</span>]</span>
<span id="cb258-9"><a href="analysis.html#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="co"># please, note that this is a function call with unweighted data!</span></span>
<span id="cb258-10"><a href="analysis.html#cb258-10" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(soap_prob, <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.9</span>))</span></code></pre></div>
<pre><code>## Warning in chisq.test(soap_prob, p = c(0, 0.1, 0.9)): Chi-squared approximation
## may be incorrect</code></pre>
<pre><code>## 
##  Chi-squared test for given probabilities
## 
## data:  soap_prob
## X-squared = Inf, df = 2, p-value &lt; 2.2e-16</code></pre>
<p>As p value is lower than the chosen confidence level, hypothesis of equality of the current distribution to hypothetical 90% / 10% of soap-owners can be rejected.</p>
<p>Defining a function for checking the distribution within a particular group, against the “hypothetical” overall sample.</p>
<p>For the overall sample we would need a variable which has the same value across all observations (e.g. informed consent == yes etc.)</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="analysis.html#cb261-1" aria-hidden="true" tabindex="-1"></a>chi2_GoF <span class="ot">&lt;-</span> <span class="cf">function</span>(name, stratum_hyp, stratum_2, value_stratum_hyp, value_stratum_2, data, weights){</span>
<span id="cb261-2"><a href="analysis.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb261-3"><a href="analysis.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  table_1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb261-4"><a href="analysis.html#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name)) {</span>
<span id="cb261-5"><a href="analysis.html#cb261-5" aria-hidden="true" tabindex="-1"></a>    ni <span class="ot">&lt;-</span> name[i]</span>
<span id="cb261-6"><a href="analysis.html#cb261-6" aria-hidden="true" tabindex="-1"></a>    ti <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb261-7"><a href="analysis.html#cb261-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(stratum_hyp) <span class="sc">==</span> <span class="fu">paste0</span>(value_stratum_hyp)) <span class="sc">%&gt;%</span></span>
<span id="cb261-8"><a href="analysis.html#cb261-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb261-9"><a href="analysis.html#cb261-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weights)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb261-10"><a href="analysis.html#cb261-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">base =</span> <span class="fu">sum</span>(wtn), <span class="at">cnt =</span> <span class="fu">sum</span>(n))<span class="sc">%&gt;%</span></span>
<span id="cb261-11"><a href="analysis.html#cb261-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">varnam =</span> ni)</span>
<span id="cb261-12"><a href="analysis.html#cb261-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;base_w&quot;</span>, <span class="st">&quot;count&quot;</span>, <span class="st">&quot;nam&quot;</span>)</span>
<span id="cb261-13"><a href="analysis.html#cb261-13" aria-hidden="true" tabindex="-1"></a>    table_1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_1, ti)</span>
<span id="cb261-14"><a href="analysis.html#cb261-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb261-15"><a href="analysis.html#cb261-15" aria-hidden="true" tabindex="-1"></a>  table_cl_1 <span class="ot">&lt;-</span> table_1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb261-16"><a href="analysis.html#cb261-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var_id =</span> <span class="fu">paste0</span>(nam, <span class="st">&quot;.&quot;</span>, var))</span>
<span id="cb261-17"><a href="analysis.html#cb261-17" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb261-18"><a href="analysis.html#cb261-18" aria-hidden="true" tabindex="-1"></a>  table_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb261-19"><a href="analysis.html#cb261-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name)) {</span>
<span id="cb261-20"><a href="analysis.html#cb261-20" aria-hidden="true" tabindex="-1"></a>    ni <span class="ot">&lt;-</span> name[i]</span>
<span id="cb261-21"><a href="analysis.html#cb261-21" aria-hidden="true" tabindex="-1"></a>    ti <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb261-22"><a href="analysis.html#cb261-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(stratum_2) <span class="sc">==</span> <span class="fu">paste0</span>(value_stratum_2)) <span class="sc">%&gt;%</span></span>
<span id="cb261-23"><a href="analysis.html#cb261-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb261-24"><a href="analysis.html#cb261-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weights)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb261-25"><a href="analysis.html#cb261-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">base =</span> <span class="fu">sum</span>(wtn), <span class="at">cnt =</span> <span class="fu">sum</span>(n))<span class="sc">%&gt;%</span></span>
<span id="cb261-26"><a href="analysis.html#cb261-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">varnam =</span> ni)</span>
<span id="cb261-27"><a href="analysis.html#cb261-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;base_w&quot;</span>, <span class="st">&quot;count&quot;</span>, <span class="st">&quot;nam&quot;</span>)</span>
<span id="cb261-28"><a href="analysis.html#cb261-28" aria-hidden="true" tabindex="-1"></a>    table_2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_2, ti)</span>
<span id="cb261-29"><a href="analysis.html#cb261-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb261-30"><a href="analysis.html#cb261-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-31"><a href="analysis.html#cb261-31" aria-hidden="true" tabindex="-1"></a>  table_cl_2 <span class="ot">&lt;-</span> table_2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb261-32"><a href="analysis.html#cb261-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var_id =</span> <span class="fu">paste0</span>(nam, <span class="st">&quot;.&quot;</span>, var))</span>
<span id="cb261-33"><a href="analysis.html#cb261-33" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> <span class="fu">merge</span>(table_cl_1, table_cl_2, <span class="at">by =</span> <span class="st">&quot;var_id&quot;</span>, <span class="at">all =</span> T)</span>
<span id="cb261-34"><a href="analysis.html#cb261-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(table_cl_compare) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var.id&quot;</span>, <span class="st">&quot;var.hyp&quot;</span>, <span class="st">&quot;wtn.hyp&quot;</span>, <span class="st">&quot;n.hyp&quot;</span>, <span class="st">&quot;prop.hyp&quot;</span>, <span class="st">&quot;base.hyp&quot;</span>, <span class="st">&quot;base_nw.hyp&quot;</span>,<span class="st">&quot;nam.hyp&quot;</span>, <span class="st">&quot;var.2&quot;</span>, <span class="st">&quot;wtn.2&quot;</span>, <span class="st">&quot;n.2&quot;</span>, <span class="st">&quot;prop.2&quot;</span>, <span class="st">&quot;base.2&quot;</span>, <span class="st">&quot;base_nw.2&quot;</span>, <span class="st">&quot;nam.2&quot;</span>)</span>
<span id="cb261-35"><a href="analysis.html#cb261-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-36"><a href="analysis.html#cb261-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Dealing with NA issues</span></span>
<span id="cb261-37"><a href="analysis.html#cb261-37" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>nam.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.hyp)] <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.hyp)]</span>
<span id="cb261-38"><a href="analysis.html#cb261-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-39"><a href="analysis.html#cb261-39" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>)] <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam<span class="fl">.2</span>)]</span>
<span id="cb261-40"><a href="analysis.html#cb261-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-41"><a href="analysis.html#cb261-41" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>to_split <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.hyp</span>
<span id="cb261-42"><a href="analysis.html#cb261-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-43"><a href="analysis.html#cb261-43" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> <span class="fu">separate</span>(table_cl_compare, <span class="at">col =</span> to_split, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;indctr&quot;</span>, <span class="st">&quot;item&quot;</span>), <span class="at">sep =</span><span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>)</span>
<span id="cb261-44"><a href="analysis.html#cb261-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-45"><a href="analysis.html#cb261-45" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.hyp, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.hyp, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb261-46"><a href="analysis.html#cb261-46" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.hyp, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.hyp, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb261-47"><a href="analysis.html#cb261-47" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw<span class="fl">.2</span>, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw<span class="fl">.2</span>, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb261-48"><a href="analysis.html#cb261-48" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base<span class="fl">.2</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.hyp, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base<span class="fl">.2</span>, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb261-49"><a href="analysis.html#cb261-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-50"><a href="analysis.html#cb261-50" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>prop.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>prop.hyp)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb261-51"><a href="analysis.html#cb261-51" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>prop<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>prop<span class="fl">.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb261-52"><a href="analysis.html#cb261-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-53"><a href="analysis.html#cb261-53" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>wtn.hyp[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>wtn.hyp)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb261-54"><a href="analysis.html#cb261-54" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb261-55"><a href="analysis.html#cb261-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-56"><a href="analysis.html#cb261-56" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>chi2 <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>, <span class="at">p =</span> table_cl_compare<span class="sc">$</span>prop.hyp)<span class="sc">$</span>statistic</span>
<span id="cb261-57"><a href="analysis.html#cb261-57" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>, <span class="at">p =</span> table_cl_compare<span class="sc">$</span>prop.hyp)<span class="sc">$</span>p.value</span>
<span id="cb261-58"><a href="analysis.html#cb261-58" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>df <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(table_cl_compare<span class="sc">$</span>wtn<span class="fl">.2</span>, <span class="at">p =</span> table_cl_compare<span class="sc">$</span>prop.hyp)<span class="sc">$</span>df</span>
<span id="cb261-59"><a href="analysis.html#cb261-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb261-60"><a href="analysis.html#cb261-60" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>H0 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(table_cl_compare<span class="sc">$</span>p <span class="sc">&lt;=</span> <span class="fl">0.05</span>, <span class="st">&quot;H1 - different&quot;</span>, <span class="st">&quot;H0 - same&quot;</span>)</span>
<span id="cb261-61"><a href="analysis.html#cb261-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(table_cl_compare)</span>
<span id="cb261-62"><a href="analysis.html#cb261-62" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Using the function with a single choice question</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="analysis.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chi2_GoF</span>(<span class="at">name =</span> <span class="st">&quot;f11_dinking_water_source&quot;</span>, <span class="at">stratum_hyp =</span> <span class="st">&quot;a1_informed_consent&quot;</span>, <span class="at">stratum_2 =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">value_stratum_hyp =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">value_stratum_2 =</span> <span class="st">&quot;5km_rural&quot;</span>, <span class="at">data =</span> main_dataset, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in
## 8 rows [1, 2, 3, 4, 5, 6, 7, 8].</code></pre>
<pre><code>## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect

## Warning in chisq.test(table_cl_compare$wtn.2, p = table_cl_compare$prop.hyp):
## Chi-squared approximation may be incorrect</code></pre>
<pre><code>## # A tibble: 8 × 20
##   var.id       var.hyp wtn.hyp n.hyp prop.hyp base.hyp base_nw.hyp nam.hyp var.2
##   &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;
## 1 f11_dinking… bottle…   79.5     68  0.0492     1617.        1617 f11_di… bott…
## 2 f11_dinking… drinki…  425.     366  0.263      1617.        1617 f11_di… drin…
## 3 f11_dinking… other_…    8.39    11  0.00519    1617.        1617 f11_di… othe…
## 4 f11_dinking… person…  271.     414  0.168      1617.        1617 f11_di… pers…
## 5 f11_dinking… public…  152.     187  0.0937     1617.        1617 f11_di… publ…
## 6 f11_dinking… tap_dr…  586.     479  0.362      1617.        1617 f11_di… tap_…
## 7 f11_dinking… techni…    2.97     2  0.00184    1617.        1617 f11_di… &lt;NA&gt; 
## 8 f11_dinking… trucke…   92.1     90  0.0569     1617.        1617 f11_di… truc…
## # ℹ 11 more variables: wtn.2 &lt;dbl&gt;, n.2 &lt;int&gt;, prop.2 &lt;dbl&gt;, base.2 &lt;dbl&gt;,
## #   base_nw.2 &lt;int&gt;, nam.2 &lt;chr&gt;, indctr &lt;chr&gt;, item &lt;chr&gt;, chi2 &lt;dbl&gt;,
## #   p &lt;dbl&gt;, H0 &lt;chr&gt;</code></pre>
<p>Using the function with the multiple responce set</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="analysis.html#cb266-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb266-2"><a href="analysis.html#cb266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-3"><a href="analysis.html#cb266-3" aria-hidden="true" tabindex="-1"></a>f12_names <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;f12_drinking_water_treat.&quot;</span>, names)]</span>
<span id="cb266-4"><a href="analysis.html#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="analysis.html#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co">#removing empty variables from the MR set</span></span>
<span id="cb266-6"><a href="analysis.html#cb266-6" aria-hidden="true" tabindex="-1"></a>nz_f12 <span class="ot">&lt;-</span> <span class="fu">non_zero_for_test</span>(f12_names, <span class="st">&quot;strata&quot;</span>, main_dataset, <span class="at">per_cell =</span> F)</span></code></pre></div>
<pre><code>## 2 variables were removed because of containing zeros in stratas</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="analysis.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(main_dataset[, nz_f12[<span class="dv">4</span>]], main_dataset[, <span class="st">&quot;strata&quot;</span>])</span></code></pre></div>
<pre><code>##    
##     20km_rural 20km_urban 5km_rural 5km_urban
##   0        396        389       395       387
##   1         11         15         7        17</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="analysis.html#cb270-1" aria-hidden="true" tabindex="-1"></a>f12_sig2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(nz_f12, chi2_GoF, <span class="at">stratum_hyp =</span> <span class="st">&quot;a1_informed_consent&quot;</span>, <span class="at">stratum_2 =</span> <span class="st">&quot;strata&quot;</span>, <span class="at">value_stratum_hyp =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">value_stratum_2 =</span> <span class="st">&quot;5km_rural&quot;</span>, <span class="at">data =</span> main_dataset, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span>
<span id="cb270-2"><a href="analysis.html#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="analysis.html#cb270-3" aria-hidden="true" tabindex="-1"></a>f12_sig2_df <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(rbind, f12_sig2)</span>
<span id="cb270-4"><a href="analysis.html#cb270-4" aria-hidden="true" tabindex="-1"></a>f12_sig2_df</span></code></pre></div>
<pre><code>## # A tibble: 16 × 20
##    var.id      var.hyp wtn.hyp n.hyp prop.hyp base.hyp base_nw.hyp nam.hyp var.2
##    &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
##  1 f12_drinki…       0 1614.    1615  0.998      1617.        1617 f12_dr…     0
##  2 f12_drinki…       1    3.23     2  0.00200    1617.        1617 f12_dr…    NA
##  3 f12_drinki…       0 1420.    1437  0.878      1617.        1617 f12_dr…     0
##  4 f12_drinki…       1  197.     180  0.122      1617.        1617 f12_dr…     1
##  5 f12_drinki…       0 1512.    1518  0.935      1617.        1617 f12_dr…     0
##  6 f12_drinki…       1  105.      99  0.0651     1617.        1617 f12_dr…     1
##  7 f12_drinki…       0 1559.    1567  0.964      1617.        1617 f12_dr…     0
##  8 f12_drinki…       1   58.3     50  0.0360     1617.        1617 f12_dr…     1
##  9 f12_drinki…       0 1222.    1226  0.756      1617.        1617 f12_dr…     0
## 10 f12_drinki…       1  395.     391  0.244      1617.        1617 f12_dr…     1
## 11 f12_drinki…       0 1613.    1611  0.998      1617.        1617 f12_dr…     0
## 12 f12_drinki…       1    3.69     6  0.00228    1617.        1617 f12_dr…     1
## 13 f12_drinki…       0 1614.    1614  0.998      1617.        1617 f12_dr…     0
## 14 f12_drinki…       1    2.86     3  0.00177    1617.        1617 f12_dr…    NA
## 15 f12_drinki…       0  660.     624  0.408      1617.        1617 f12_dr…     0
## 16 f12_drinki…       1  957.     993  0.592      1617.        1617 f12_dr…     1
## # ℹ 11 more variables: wtn.2 &lt;dbl&gt;, n.2 &lt;int&gt;, prop.2 &lt;dbl&gt;, base.2 &lt;dbl&gt;,
## #   base_nw.2 &lt;int&gt;, nam.2 &lt;chr&gt;, indctr &lt;chr&gt;, item &lt;chr&gt;, chi2 &lt;dbl&gt;,
## #   p &lt;dbl&gt;, H0 &lt;chr&gt;</code></pre>
</div>
<div id="proportion-tests-z-test" class="section level3 hasAnchor" number="7.10.5">
<h3><span class="header-section-number">7.10.5</span> Proportion tests (z-test)<a href="analysis.html#proportion-tests-z-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Test for equality of proportions for independent samples. To compare column proportions for independent samples, two tailed z-test of proportions could be used.</p>
<p>Main assumptions of use of this test are:</p>
<ol style="list-style-type: decimal">
<li>normally distributed data</li>
<li>sample size &gt; 30 and n at each point &gt;= 5 (!Thus, for the variables were there are few observations, approximation could be incorrect!)
The detailed explanation of this statistic and its use in R could be found here: <a href="http://www.sthda.com/english/wiki/two-proportions-z-test-in-r" class="uri">http://www.sthda.com/english/wiki/two-proportions-z-test-in-r</a></li>
</ol>
<p>As in our datasets weighting is used, in the current test, we use weighted proportions and weighted counts for calculating test statistics.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="analysis.html#cb272-1" aria-hidden="true" tabindex="-1"></a>zprop_compare_weighted <span class="ot">&lt;-</span> <span class="cf">function</span>(data_old, data_new, stratum, value_stratum, name, weights, <span class="at">strict =</span> F){</span>
<span id="cb272-2"><a href="analysis.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  names_new <span class="ot">&lt;-</span> <span class="fu">names</span>(data_new)</span>
<span id="cb272-3"><a href="analysis.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  not_in_new <span class="ot">&lt;-</span> names_new[<span class="fu">which</span>(<span class="sc">!</span>(name <span class="sc">%in%</span> names_new))]</span>
<span id="cb272-4"><a href="analysis.html#cb272-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb272-5"><a href="analysis.html#cb272-5" aria-hidden="true" tabindex="-1"></a>table_old <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb272-6"><a href="analysis.html#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name)) {</span>
<span id="cb272-7"><a href="analysis.html#cb272-7" aria-hidden="true" tabindex="-1"></a>  ni <span class="ot">&lt;-</span> name[i]</span>
<span id="cb272-8"><a href="analysis.html#cb272-8" aria-hidden="true" tabindex="-1"></a>  ti <span class="ot">&lt;-</span> data_old <span class="sc">%&gt;%</span> </span>
<span id="cb272-9"><a href="analysis.html#cb272-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(stratum) <span class="sc">==</span> <span class="fu">paste0</span>(value_stratum)) <span class="sc">%&gt;%</span></span>
<span id="cb272-10"><a href="analysis.html#cb272-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb272-11"><a href="analysis.html#cb272-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni) <span class="sc">!=</span> <span class="st">&#39;refuse&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb272-12"><a href="analysis.html#cb272-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weights)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb272-13"><a href="analysis.html#cb272-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">base =</span> <span class="fu">sum</span>(wtn), <span class="at">cnt =</span> <span class="fu">sum</span>(n))<span class="sc">%&gt;%</span></span>
<span id="cb272-14"><a href="analysis.html#cb272-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">varnam =</span> ni)</span>
<span id="cb272-15"><a href="analysis.html#cb272-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;base_w&quot;</span>, <span class="st">&quot;count&quot;</span>, <span class="st">&quot;nam&quot;</span>)</span>
<span id="cb272-16"><a href="analysis.html#cb272-16" aria-hidden="true" tabindex="-1"></a>  table_old <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_old, ti)</span>
<span id="cb272-17"><a href="analysis.html#cb272-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-18"><a href="analysis.html#cb272-18" aria-hidden="true" tabindex="-1"></a>table_cl_old <span class="ot">&lt;-</span> table_old <span class="sc">%&gt;%</span> <span class="fu">filter</span>(var <span class="sc">!=</span> <span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb272-19"><a href="analysis.html#cb272-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_id =</span> <span class="fu">paste0</span>(nam, <span class="st">&quot;.&quot;</span>, var))</span>
<span id="cb272-20"><a href="analysis.html#cb272-20" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb272-21"><a href="analysis.html#cb272-21" aria-hidden="true" tabindex="-1"></a>table_new <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb272-22"><a href="analysis.html#cb272-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(name)) {</span>
<span id="cb272-23"><a href="analysis.html#cb272-23" aria-hidden="true" tabindex="-1"></a>  ni <span class="ot">&lt;-</span> name[i]</span>
<span id="cb272-24"><a href="analysis.html#cb272-24" aria-hidden="true" tabindex="-1"></a>  ti <span class="ot">&lt;-</span> data_new <span class="sc">%&gt;%</span> </span>
<span id="cb272-25"><a href="analysis.html#cb272-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(stratum) <span class="sc">==</span> <span class="fu">paste0</span>(value_stratum)) <span class="sc">%&gt;%</span></span>
<span id="cb272-26"><a href="analysis.html#cb272-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni))) <span class="sc">%&gt;%</span></span>
<span id="cb272-27"><a href="analysis.html#cb272-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni) <span class="sc">!=</span> <span class="st">&#39;refuse&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb272-28"><a href="analysis.html#cb272-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">wtn =</span> <span class="fu">sum</span>(<span class="sc">!!</span><span class="fu">sym</span>(weights)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb272-29"><a href="analysis.html#cb272-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> wtn<span class="sc">/</span><span class="fu">sum</span>(wtn), <span class="at">base =</span> <span class="fu">sum</span>(wtn), <span class="at">cnt =</span> <span class="fu">sum</span>(n))<span class="sc">%&gt;%</span></span>
<span id="cb272-30"><a href="analysis.html#cb272-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">varnam =</span> ni)</span>
<span id="cb272-31"><a href="analysis.html#cb272-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ti) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, <span class="st">&quot;wtn&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;base_w&quot;</span>, <span class="st">&quot;count&quot;</span>, <span class="st">&quot;nam&quot;</span>)</span>
<span id="cb272-32"><a href="analysis.html#cb272-32" aria-hidden="true" tabindex="-1"></a>  table_new <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_new, ti)</span>
<span id="cb272-33"><a href="analysis.html#cb272-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-34"><a href="analysis.html#cb272-34" aria-hidden="true" tabindex="-1"></a>table_cl_new <span class="ot">&lt;-</span> table_new <span class="sc">%&gt;%</span> <span class="fu">filter</span>(var <span class="sc">!=</span> <span class="st">&quot;0&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(var)) <span class="sc">%&gt;%</span></span>
<span id="cb272-35"><a href="analysis.html#cb272-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var_id =</span> <span class="fu">paste0</span>(nam, <span class="st">&quot;.&quot;</span>, var))</span>
<span id="cb272-36"><a href="analysis.html#cb272-36" aria-hidden="true" tabindex="-1"></a>table_cl_compare <span class="ot">&lt;-</span> <span class="fu">merge</span>(table_cl_old, table_cl_new, <span class="at">by =</span> <span class="st">&quot;var_id&quot;</span>, <span class="at">all =</span> T)</span>
<span id="cb272-37"><a href="analysis.html#cb272-37" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table_cl_compare) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var.id&quot;</span>, <span class="st">&quot;var.old&quot;</span>, <span class="st">&quot;wtn.old&quot;</span>, <span class="st">&quot;n.old&quot;</span>, <span class="st">&quot;prop.old&quot;</span>, <span class="st">&quot;base.old&quot;</span>, <span class="st">&quot;base_nw.old&quot;</span>,<span class="st">&quot;nam.old&quot;</span>, <span class="st">&quot;var.new&quot;</span>, <span class="st">&quot;wtn.new&quot;</span>, <span class="st">&quot;n.new&quot;</span>, <span class="st">&quot;prop.new&quot;</span>, <span class="st">&quot;base.new&quot;</span>, <span class="st">&quot;base_nw.new&quot;</span>, <span class="st">&quot;nam.new&quot;</span>)</span>
<span id="cb272-38"><a href="analysis.html#cb272-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-39"><a href="analysis.html#cb272-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Dealing with NA issues</span></span>
<span id="cb272-40"><a href="analysis.html#cb272-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-41"><a href="analysis.html#cb272-41" aria-hidden="true" tabindex="-1"></a>  table_cl_compare<span class="sc">$</span>nam.old[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.old)] <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.new[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.old)]</span>
<span id="cb272-42"><a href="analysis.html#cb272-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb272-43"><a href="analysis.html#cb272-43" aria-hidden="true" tabindex="-1"></a>    table_cl_compare<span class="sc">$</span>nam.new[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.new)] <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.old[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>nam.new)]</span>
<span id="cb272-44"><a href="analysis.html#cb272-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-45"><a href="analysis.html#cb272-45" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>to_split <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>nam.old</span>
<span id="cb272-46"><a href="analysis.html#cb272-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb272-47"><a href="analysis.html#cb272-47" aria-hidden="true" tabindex="-1"></a>table_cl_compare <span class="ot">&lt;-</span> <span class="fu">separate</span>(table_cl_compare, <span class="at">col =</span> to_split, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;indctr&quot;</span>, <span class="st">&quot;item&quot;</span>), <span class="at">sep =</span><span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>)</span>
<span id="cb272-48"><a href="analysis.html#cb272-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-49"><a href="analysis.html#cb272-49" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.old, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.old, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb272-50"><a href="analysis.html#cb272-50" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.old, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.old, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb272-51"><a href="analysis.html#cb272-51" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.new, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.new, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb272-52"><a href="analysis.html#cb272-52" aria-hidden="true" tabindex="-1"></a>  table_cl_compare <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(indctr) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.new) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base_nw.old, <span class="at">.direction  =</span> <span class="st">&quot;down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fill</span>(base.new, <span class="at">.direction  =</span> <span class="st">&quot;up&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb272-53"><a href="analysis.html#cb272-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-54"><a href="analysis.html#cb272-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-55"><a href="analysis.html#cb272-55" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>prop.old[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>prop.old)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb272-56"><a href="analysis.html#cb272-56" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>prop.new[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>prop.new)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb272-57"><a href="analysis.html#cb272-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-58"><a href="analysis.html#cb272-58" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>wtn.old[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>wtn.old)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb272-59"><a href="analysis.html#cb272-59" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>wtn.new[<span class="fu">is.na</span>(table_cl_compare<span class="sc">$</span>wtn.new)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb272-60"><a href="analysis.html#cb272-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-61"><a href="analysis.html#cb272-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(table_cl_compare)){</span>
<span id="cb272-62"><a href="analysis.html#cb272-62" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x =</span> <span class="fu">c</span>(table_cl_compare<span class="sc">$</span>wtn.old[i], table_cl_compare<span class="sc">$</span>wtn.new[i]), <span class="at">n =</span> <span class="fu">c</span>(table_cl_compare<span class="sc">$</span>base.old[i], table_cl_compare<span class="sc">$</span>base.new[i]))</span>
<span id="cb272-63"><a href="analysis.html#cb272-63" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>prp_tst_p[i] <span class="ot">&lt;-</span> pt<span class="sc">$</span>p.value</span>
<span id="cb272-64"><a href="analysis.html#cb272-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-65"><a href="analysis.html#cb272-65" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(table_cl_compare<span class="sc">$</span>prp_tst_p <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">&quot;Significant diff.&quot;</span>, <span class="st">&quot;Not significant&quot;</span>)</span>
<span id="cb272-66"><a href="analysis.html#cb272-66" aria-hidden="true" tabindex="-1"></a>table_cl_compare<span class="sc">$</span>stratum <span class="ot">&lt;-</span> <span class="fu">paste0</span>(value_stratum)</span>
<span id="cb272-67"><a href="analysis.html#cb272-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-68"><a href="analysis.html#cb272-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-69"><a href="analysis.html#cb272-69" aria-hidden="true" tabindex="-1"></a>table_cl_compare_final <span class="ot">&lt;-</span> table_cl_compare <span class="sc">%&gt;%</span> </span>
<span id="cb272-70"><a href="analysis.html#cb272-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">case_when</span>(strict <span class="sc">==</span> T <span class="sc">~</span> (prop.old<span class="sc">*</span>n.new <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> prop.old<span class="sc">*</span>n.old <span class="sc">&gt;=</span><span class="dv">10</span>),</span>
<span id="cb272-71"><a href="analysis.html#cb272-71" aria-hidden="true" tabindex="-1"></a>                   strict <span class="sc">==</span> F <span class="sc">~</span> (base_nw.old <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> base_nw.new <span class="sc">&gt;=</span><span class="dv">30</span>)))</span>
<span id="cb272-72"><a href="analysis.html#cb272-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-73"><a href="analysis.html#cb272-73" aria-hidden="true" tabindex="-1"></a>table_cl_compare_final <span class="ot">&lt;-</span> table_cl_compare_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(nam.old <span class="sc">%in%</span> not_in_new))</span>
<span id="cb272-74"><a href="analysis.html#cb272-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-75"><a href="analysis.html#cb272-75" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(table_cl_compare_final) <span class="sc">&lt;</span> <span class="fu">nrow</span>(table_cl_compare)){</span>
<span id="cb272-76"><a href="analysis.html#cb272-76" aria-hidden="true" tabindex="-1"></a>  ss_vars <span class="ot">&lt;-</span> table_cl_compare<span class="sc">$</span>var.id[<span class="fu">which</span>(<span class="sc">!</span>(table_cl_compare<span class="sc">$</span>var.id <span class="sc">%in%</span> table_cl_compare_final<span class="sc">$</span>var.id))]</span>
<span id="cb272-77"><a href="analysis.html#cb272-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;Too small sample size. Variables that were removed from the analysis&quot;</span>, ss_vars))</span>
<span id="cb272-78"><a href="analysis.html#cb272-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-79"><a href="analysis.html#cb272-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-80"><a href="analysis.html#cb272-80" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(table_cl_compare_final)</span>
<span id="cb272-81"><a href="analysis.html#cb272-81" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="applying-the-function" class="section level5 hasAnchor" number="7.10.5.0.1">
<h5><span class="header-section-number">7.10.5.0.1</span> Applying the function<a href="analysis.html#applying-the-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Z-tests can be used for wave to wave or round to round comparisons.</p>
<p>Assuming, there was staged data collection and at stage1 Luhansk oblast was assessed, while at stage2 Donetsk oblast was assessed (it is an artificial division, for correct comparison between wave), hence we have two different datasets for Donetska and Luhanska regions (UA14 and UA44 respectively) and the question is whether proportions of female-led households, living in each shelter type are the same.</p>
<p>Thus, H0 - proportions are the same, H1 - proportions are different.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="analysis.html#cb273-1" aria-hidden="true" tabindex="-1"></a>ds_ua14 <span class="ot">&lt;-</span> main_dataset <span class="sc">|&gt;</span> <span class="fu">filter</span>(r1_current_oblast <span class="sc">==</span> <span class="st">&quot;UA14&quot;</span>)</span>
<span id="cb273-2"><a href="analysis.html#cb273-2" aria-hidden="true" tabindex="-1"></a>ds_ua44 <span class="ot">&lt;-</span> main_dataset <span class="sc">|&gt;</span> <span class="fu">filter</span>(r1_current_oblast <span class="sc">==</span> <span class="st">&quot;UA44&quot;</span>)</span></code></pre></div>
<p>Applying the function for single choices</p>
<ul>
<li><em>data_old, data_new</em> - dataset1 and dataset2;</li>
<li><em>stratum</em> - independent variable (should be the same for both datasets), if there is no need for independent variable, variable that have same value across the entire dataset can be used (e.g. “informed consent”);</li>
<li><em>value_stratum</em> - independent variable value, that should be used for crosstabulations (e.g. we would like to compare the proportions for certain settlement or household type);</li>
<li><em>name</em> - dependent variable name;</li>
<li><em>weights</em> - weighting variable;</li>
<li><em>strict</em> - (TRUE/FALSE) specifies if the less strict restrictment to sample size (n&gt;30) or more strict one (n at each point &gt;= 5) should be applied. FALSE be default</li>
</ul>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="analysis.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb274-2"><a href="analysis.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="co"># without independent variable</span></span>
<span id="cb274-3"><a href="analysis.html#cb274-3" aria-hidden="true" tabindex="-1"></a>marital_prop_test <span class="ot">&lt;-</span> <span class="fu">zprop_compare_weighted</span>(<span class="at">data_old =</span> ds_ua14, <span class="at">data_new =</span> ds_ua44, <span class="at">stratum =</span> <span class="st">&quot;a1_informed_consent&quot;</span>, <span class="at">value_stratum =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">name =</span> <span class="st">&quot;b9_hohh_marital_status&quot;</span>, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span>
<span id="cb274-4"><a href="analysis.html#cb274-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-5"><a href="analysis.html#cb274-5" aria-hidden="true" tabindex="-1"></a>marital_prop_test</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##   var.id     var.old wtn.old n.old prop.old base.old base_nw.old nam.old var.new
##   &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  
## 1 b9_hohh_m… divorc…   141.    127   0.116     1220.        1168 b9_hoh… divorc…
## 2 b9_hohh_m… married   538.    515   0.441     1220.        1168 b9_hoh… married
## 3 b9_hohh_m… separa…    33.3    32   0.0273    1220.        1168 b9_hoh… separa…
## 4 b9_hohh_m… single    113.     99   0.0924    1220.        1168 b9_hoh… single 
## 5 b9_hohh_m… unmarr…    61.6    65   0.0505    1220.        1168 b9_hoh… unmarr…
## 6 b9_hohh_m… widowed   333.    330   0.273     1220.        1168 b9_hoh… widowed
## # ℹ 11 more variables: wtn.new &lt;dbl&gt;, n.new &lt;int&gt;, prop.new &lt;dbl&gt;,
## #   base.new &lt;dbl&gt;, base_nw.new &lt;int&gt;, nam.new &lt;chr&gt;, indctr &lt;chr&gt;, item &lt;chr&gt;,
## #   prp_tst_p &lt;dbl&gt;, sig &lt;chr&gt;, stratum &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="analysis.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with an independent variable</span></span>
<span id="cb276-2"><a href="analysis.html#cb276-2" aria-hidden="true" tabindex="-1"></a>house_type_married <span class="ot">&lt;-</span> <span class="fu">zprop_compare_weighted</span>(<span class="at">data_old =</span> ds_ua14, <span class="at">data_new =</span> ds_ua44, <span class="at">stratum =</span> <span class="st">&quot;b9_hohh_marital_status&quot;</span>, <span class="at">value_stratum =</span> <span class="st">&quot;married&quot;</span>, <span class="at">name =</span> <span class="st">&quot;e2_home_type&quot;</span>, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span></code></pre></div>
<p>Output numeric columns:
- <em>wtn.old</em> - weighted counts for the first (old) data
- <em>n.old</em> - unweighted counts for the first (old) data
- <em>prop.old</em> - weighted proportion for the first (old) data
- <em>base.old</em> - weighted base (total count) for the first (old) data
- <em>base_nw.old</em> - unweighted base (total count) for the first (old) data
- <em>wtn.new</em> - weighted counts for the second (new) data
- <em>n.new</em> - unweighted counts for the second (new) data
- <em>prop.new</em> - weighted proportion for for the second (new) data
- <em>base.new</em> - weighted base (total count) for the second (new) data
- <em>base_nw.new</em> - unweighted base (total count) for the second (new) data
- <em>prp_tst_p</em> - p-value for proportions test
- <em>sig</em> - indication if p&lt;0.05</p>
<p>Applying the function for multiple choice questions</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="analysis.html#cb277-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">names</span>(ds_ua14)</span>
<span id="cb277-2"><a href="analysis.html#cb277-2" aria-hidden="true" tabindex="-1"></a>ng5 <span class="ot">&lt;-</span> names[<span class="fu">grepl</span>(<span class="st">&quot;b10_hohh_vulnerability&quot;</span>, names)]</span>
<span id="cb277-3"><a href="analysis.html#cb277-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-4"><a href="analysis.html#cb277-4" aria-hidden="true" tabindex="-1"></a>vulnerability_prop_test <span class="ot">&lt;-</span> <span class="fu">zprop_compare_weighted</span>(<span class="at">data_old =</span> ds_ua14, <span class="at">data_new =</span> ds_ua44, <span class="at">stratum =</span> <span class="st">&quot;a1_informed_consent&quot;</span>, <span class="at">value_stratum =</span> <span class="st">&quot;yes&quot;</span>, <span class="at">name =</span> ng5, <span class="at">weights =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span>
<span id="cb277-5"><a href="analysis.html#cb277-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-6"><a href="analysis.html#cb277-6" aria-hidden="true" tabindex="-1"></a>vulnerability_prop_test</span></code></pre></div>
<pre><code>## # A tibble: 61 × 20
##    var.id    var.old wtn.old n.old prop.old base.old base_nw.old nam.old var.new
##    &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  
##  1 b10_hohh… chroni…  75.3      68 0.0618      1220.        1168 b10_ho… chroni…
##  2 b10_hohh… chroni…   7.38      7 0.00605     1220.        1168 b10_ho… chroni…
##  3 b10_hohh… chroni…  16.4      24 0.0134      1220.        1168 b10_ho… chroni…
##  4 b10_hohh… chroni…   0.275     1 0.000225    1220.        1168 b10_ho… &lt;NA&gt;   
##  5 b10_hohh… chroni…  10.4      11 0.00855     1220.        1168 b10_ho… chroni…
##  6 b10_hohh… 1       505.      496 0.414       1220.        1168 b10_ho… 1      
##  7 b10_hohh… disabi…  24.8      24 0.0204      1220.        1168 b10_ho… disabi…
##  8 b10_hohh… disabi…  12.4      10 0.0102      1220.        1168 b10_ho… disabi…
##  9 b10_hohh… disabi…   4.99      4 0.00410     1220.        1168 b10_ho… &lt;NA&gt;   
## 10 b10_hohh… disabi…   2.03      3 0.00167     1220.        1168 b10_ho… &lt;NA&gt;   
## # ℹ 51 more rows
## # ℹ 11 more variables: wtn.new &lt;dbl&gt;, n.new &lt;int&gt;, prop.new &lt;dbl&gt;,
## #   base.new &lt;dbl&gt;, base_nw.new &lt;int&gt;, nam.new &lt;chr&gt;, indctr &lt;chr&gt;, item &lt;chr&gt;,
## #   prp_tst_p &lt;dbl&gt;, sig &lt;chr&gt;, stratum &lt;chr&gt;</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="composite-indicators.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="outputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
