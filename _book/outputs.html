<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Outputs | R cookbook for analysis with IMPACT</title>
  <meta name="description" content="8 Outputs | R cookbook for analysis with IMPACT" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Outputs | R cookbook for analysis with IMPACT" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Outputs | R cookbook for analysis with IMPACT" />
  
  
  

<meta name="author" content="R Squad" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="analysis.html"/>
<link rel="next" href="miscellaneous.html"/>
<script src="libs/header-attrs-2.19/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#hello" id="toc-hello"><span class="toc-section-number">1</span> Hello</a></li>
<li><a href="meta-information.html#meta-information" id="toc-meta-information"><span class="toc-section-number">2</span> Meta information</a>
<ul>
<li><a href="meta-information.html#creating-the-questionnaire-object" id="toc-creating-the-questionnaire-object"><span class="toc-section-number">2.1</span> Creating the questionnaire object</a></li>
</ul></li>
<li><a href="downloading-data-from-kobo-server.html#downloading-data-from-kobo-server" id="toc-downloading-data-from-kobo-server"><span class="toc-section-number">3</span> Downloading data from kobo server</a>
<ul>
<li><a href="downloading-data-from-kobo-server.html#defining-the-needed-functions" id="toc-defining-the-needed-functions"><span class="toc-section-number">3.1</span> Defining the needed functions</a></li>
<li><a href="downloading-data-from-kobo-server.html#creating-data-url-and-credentials-variables" id="toc-creating-data-url-and-credentials-variables"><span class="toc-section-number">3.2</span> Creating data url and credentials variables</a></li>
<li><a href="downloading-data-from-kobo-server.html#fetching-the-data-from-the-server" id="toc-fetching-the-data-from-the-server"><span class="toc-section-number">3.3</span> Fetching the data from the server</a></li>
</ul></li>
<li><a href="pre-analysis.html#pre-analysis" id="toc-pre-analysis"><span class="toc-section-number">4</span> Pre analysis</a>
<ul>
<li><a href="pre-analysis.html#checking-the-xls-kobo-tools-for-constraints-errors" id="toc-checking-the-xls-kobo-tools-for-constraints-errors"><span class="toc-section-number">4.1</span> Checking the XLS kobo tools for constraints errors</a></li>
<li><a href="pre-analysis.html#sampling" id="toc-sampling"><span class="toc-section-number">4.2</span> Sampling</a>
<ul>
<li><a href="pre-analysis.html#simple-random-sampling" id="toc-simple-random-sampling"><span class="toc-section-number">4.2.1</span> Simple Random sampling</a></li>
<li><a href="pre-analysis.html#stratified-random-sampling" id="toc-stratified-random-sampling"><span class="toc-section-number">4.2.2</span> Stratified Random sampling</a></li>
<li><a href="pre-analysis.html#cluster-sampling" id="toc-cluster-sampling"><span class="toc-section-number">4.2.3</span> Cluster sampling</a></li>
<li><a href="pre-analysis.html#stages-random-sampling" id="toc-stages-random-sampling"><span class="toc-section-number">4.2.4</span> 2 stages random sampling</a></li>
<li><a href="pre-analysis.html#sample-distribution-usin-population-raster" id="toc-sample-distribution-usin-population-raster"><span class="toc-section-number">4.2.5</span> Sample distribution usin population raster</a></li>
</ul></li>
</ul></li>
<li><a href="data-collection-and-processing.html#data-collection-and-processing" id="toc-data-collection-and-processing"><span class="toc-section-number">5</span> Data Collection and Processing</a>
<ul>
<li><a href="data-collection-and-processing.html#testing-the-tool" id="toc-testing-the-tool"><span class="toc-section-number">5.1</span> Testing the tool</a>
<ul>
<li><a href="data-collection-and-processing.html#creating-dummy-data" id="toc-creating-dummy-data"><span class="toc-section-number">5.1.1</span> Creating dummy data</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#download-data" id="toc-download-data"><span class="toc-section-number">5.2</span> Download data</a>
<ul>
<li><a href="data-collection-and-processing.html#downloading-audit-files-using-audit_url" id="toc-downloading-audit-files-using-audit_url"><span class="toc-section-number">5.2.1</span> Downloading Audit files using audit_URL</a></li>
<li><a href="data-collection-and-processing.html#download-audit-files-using-form-name" id="toc-download-audit-files-using-form-name"><span class="toc-section-number">5.2.2</span> Download audit files using form name</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#data-collection-follow-up" id="toc-data-collection-follow-up"><span class="toc-section-number">5.3</span> Data collection follow-up</a>
<ul>
<li><a href="data-collection-and-processing.html#checking-surveys-against-the-sampling-frame" id="toc-checking-surveys-against-the-sampling-frame"><span class="toc-section-number">5.3.1</span> checking surveys against the sampling frame</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#data-falsification" id="toc-data-falsification"><span class="toc-section-number">5.4</span> Data falsification</a>
<ul>
<li><a href="data-collection-and-processing.html#check-for-time-in-the-dataset" id="toc-check-for-time-in-the-dataset"><span class="toc-section-number">5.4.1</span> Check for time (in the dataset)</a></li>
<li><a href="data-collection-and-processing.html#check-for-time-audit-files" id="toc-check-for-time-audit-files"><span class="toc-section-number">5.4.2</span> Check for time (audit files)</a></li>
<li><a href="data-collection-and-processing.html#check-for-time---calculating-the-elapsed-time-between-each-interview" id="toc-check-for-time---calculating-the-elapsed-time-between-each-interview"><span class="toc-section-number">5.4.3</span> Check for time - calculating the elapsed time between each interview</a></li>
<li><a href="data-collection-and-processing.html#silouhette-analysis" id="toc-silouhette-analysis"><span class="toc-section-number">5.4.4</span> Silouhette analysis</a></li>
<li><a href="data-collection-and-processing.html#check-for-duplicates" id="toc-check-for-duplicates"><span class="toc-section-number">5.4.5</span> Check for duplicates</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#data-checks" id="toc-data-checks"><span class="toc-section-number">5.5</span> Data checks</a>
<ul>
<li><a href="data-collection-and-processing.html#check-for-outliers" id="toc-check-for-outliers"><span class="toc-section-number">5.5.1</span> Check for outliers</a></li>
<li><a href="data-collection-and-processing.html#check-others" id="toc-check-others"><span class="toc-section-number">5.5.2</span> Check others</a></li>
<li><a href="data-collection-and-processing.html#issue-log-function" id="toc-issue-log-function"><span class="toc-section-number">5.5.3</span> Issue log Function</a></li>
<li><a href="data-collection-and-processing.html#check-for-logical-check" id="toc-check-for-logical-check"><span class="toc-section-number">5.5.4</span> Check for logical check</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#cleaninginspector---inspect_all" id="toc-cleaninginspector---inspect_all"><span class="toc-section-number">5.6</span> cleaninginspectoR - inspect_all</a></li>
<li><a href="data-collection-and-processing.html#data-cleaning" id="toc-data-cleaning"><span class="toc-section-number">5.7</span> Data cleaning</a>
<ul>
<li><a href="data-collection-and-processing.html#re-generate-text-column-for-select-multiple-questions" id="toc-re-generate-text-column-for-select-multiple-questions"><span class="toc-section-number">5.7.1</span> Re-generate text column for select multiple questions</a></li>
<li><a href="data-collection-and-processing.html#clean-data-base-on-cleaning-log" id="toc-clean-data-base-on-cleaning-log"><span class="toc-section-number">5.7.2</span> Clean data base on cleaning log</a></li>
<li><a href="data-collection-and-processing.html#check-cleaning-log-raw-dataset-and-clean-dataset" id="toc-check-cleaning-log-raw-dataset-and-clean-dataset"><span class="toc-section-number">5.7.3</span> Check cleaning log, raw dataset and clean dataset</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#data-cleaning---miscellaneous" id="toc-data-cleaning---miscellaneous"><span class="toc-section-number">5.8</span> Data cleaning - miscellaneous</a>
<ul>
<li><a href="data-collection-and-processing.html#check-for-data-sanity-check-if-the-data-follow-odk-format-select_one-select_multiple-xxx-choices" id="toc-check-for-data-sanity-check-if-the-data-follow-odk-format-select_one-select_multiple-xxx-choices"><span class="toc-section-number">5.8.1</span> Check for data sanity check if the data follow ODK format (select_one, select_multiple, xxx, choices)</a></li>
<li><a href="data-collection-and-processing.html#turns-label-to-xml" id="toc-turns-label-to-xml"><span class="toc-section-number">5.8.2</span> Turns label to xml</a></li>
<li><a href="data-collection-and-processing.html#statistical-disclosure-control-methods" id="toc-statistical-disclosure-control-methods"><span class="toc-section-number">5.8.3</span> Statistical Disclosure Control Methods</a></li>
</ul></li>
<li><a href="data-collection-and-processing.html#translation-using-microsoft-api" id="toc-translation-using-microsoft-api"><span class="toc-section-number">5.9</span> Translation using Microsoft API</a></li>
</ul></li>
<li><a href="composite-indicators.html#composite-indicators" id="toc-composite-indicators"><span class="toc-section-number">6</span> Composite indicators</a>
<ul>
<li><a href="composite-indicators.html#composite-with-1-categorical-variable---select-one" id="toc-composite-with-1-categorical-variable---select-one"><span class="toc-section-number">6.1</span> Composite with 1 categorical variable - select one</a></li>
<li><a href="composite-indicators.html#composite-with-2-categorical-variables" id="toc-composite-with-2-categorical-variables"><span class="toc-section-number">6.2</span> Composite with 2 categorical variables</a></li>
<li><a href="composite-indicators.html#composite-with-1-categorical-variable---select-multiple" id="toc-composite-with-1-categorical-variable---select-multiple"><span class="toc-section-number">6.3</span> Composite with 1 categorical variable - select multiple</a></li>
<li><a href="composite-indicators.html#composite-with-1-numerical-variable" id="toc-composite-with-1-numerical-variable"><span class="toc-section-number">6.4</span> Composite with 1 numerical variable</a></li>
<li><a href="composite-indicators.html#composite-with-2-numerical-variables" id="toc-composite-with-2-numerical-variables"><span class="toc-section-number">6.5</span> Composite with 2 numerical variables</a></li>
<li><a href="composite-indicators.html#composite-with-2-or-more-numerical-variables" id="toc-composite-with-2-or-more-numerical-variables"><span class="toc-section-number">6.6</span> Composite with 2 or more numerical variables</a></li>
<li><a href="composite-indicators.html#household-hunger-score-hhs" id="toc-household-hunger-score-hhs"><span class="toc-section-number">6.7</span> Household Hunger Score (HHS)</a></li>
<li><a href="composite-indicators.html#food-cconsumption-score-fcs" id="toc-food-cconsumption-score-fcs"><span class="toc-section-number">6.8</span> Food Cconsumption Score (FCS)</a></li>
<li><a href="composite-indicators.html#livelihood-coping-strategy-index-lcsi" id="toc-livelihood-coping-strategy-index-lcsi"><span class="toc-section-number">6.9</span> Livelihood coping strategy index (LCSI)</a></li>
<li><a href="composite-indicators.html#new-indicators-from-a-loop-to-main-dataset" id="toc-new-indicators-from-a-loop-to-main-dataset"><span class="toc-section-number">6.10</span> New indicators from a loop to main dataset</a></li>
<li><a href="composite-indicators.html#the-co-occurrence-of-needs-in-an-msni" id="toc-the-co-occurrence-of-needs-in-an-msni"><span class="toc-section-number">6.11</span> The co-occurrence of needs in an MSNI</a></li>
</ul></li>
<li><a href="analysis.html#analysis" id="toc-analysis"><span class="toc-section-number">7</span> Analysis</a>
<ul>
<li><a href="analysis.html#srvyr-package" id="toc-srvyr-package"><span class="toc-section-number">7.1</span> srvyr package</a>
<ul>
<li><a href="analysis.html#categorical-variables" id="toc-categorical-variables"><span class="toc-section-number">7.1.1</span> Categorical variables</a></li>
<li><a href="analysis.html#numeric-variables" id="toc-numeric-variables"><span class="toc-section-number">7.1.2</span> Numeric variables</a></li>
<li><a href="analysis.html#select_one" id="toc-select_one"><span class="toc-section-number">7.1.3</span> select_one</a></li>
<li><a href="analysis.html#select_mutiple" id="toc-select_mutiple"><span class="toc-section-number">7.1.4</span> select_mutiple</a></li>
</ul></li>
<li><a href="analysis.html#analysis-with-numerical-variables" id="toc-analysis-with-numerical-variables"><span class="toc-section-number">7.2</span> Analysis with numerical variables</a>
<ul>
<li><a href="analysis.html#averages" id="toc-averages"><span class="toc-section-number">7.2.1</span> Averages</a></li>
<li><a href="analysis.html#median" id="toc-median"><span class="toc-section-number">7.2.2</span> Median</a></li>
</ul></li>
<li><a href="analysis.html#ratios" id="toc-ratios"><span class="toc-section-number">7.3</span> Ratios</a>
<ul>
<li><a href="analysis.html#example1" id="toc-example1"><span class="toc-section-number">7.3.1</span> Example1:<br />
</a></li>
<li><a href="analysis.html#example2---analyzing-multiple-questions-and-combine-the-output" id="toc-example2---analyzing-multiple-questions-and-combine-the-output"><span class="toc-section-number">7.3.2</span> Example2 - Analyzing multiple questions and combine the output:<br />
</a></li>
<li><a href="analysis.html#example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted" id="toc-example3---no-dissagregation-is-needed-andor-the-data-is-not-weighted"><span class="toc-section-number">7.3.3</span> Example3 - No dissagregation is needed and/or the data is not weighted:<br />
</a></li>
</ul></li>
<li><a href="analysis.html#weights" id="toc-weights"><span class="toc-section-number">7.4</span> Weights</a>
<ul>
<li><a href="analysis.html#tidyverse" id="toc-tidyverse"><span class="toc-section-number">7.4.1</span> tidyverse</a></li>
<li><a href="analysis.html#surveyweights" id="toc-surveyweights"><span class="toc-section-number">7.4.2</span> surveyweights</a></li>
</ul></li>
<li><a href="analysis.html#impactr-based-on-srvyr" id="toc-impactr-based-on-srvyr"><span class="toc-section-number">7.5</span> impactR, based on <code>srvyr</code></a>
<ul>
<li><a href="analysis.html#introduction" id="toc-introduction"><span class="toc-section-number">7.5.1</span> Introduction</a></li>
<li><a href="analysis.html#first-stage-prepare-data-and-survey-design" id="toc-first-stage-prepare-data-and-survey-design"><span class="toc-section-number">7.5.2</span> First stage: prepare data and survey design</a></li>
<li><a href="analysis.html#second-stage-one-variable-analysis" id="toc-second-stage-one-variable-analysis"><span class="toc-section-number">7.5.3</span> Second stage: One variable analysis</a></li>
<li><a href="analysis.html#third-stage-one-analysis-at-a-time-with-the-kobo-tool" id="toc-third-stage-one-analysis-at-a-time-with-the-kobo-tool"><span class="toc-section-number">7.5.4</span> Third stage: one analysis at a time with the Kobo tool</a></li>
</ul></li>
<li><a href="analysis.html#example-survey-analysis-using-illuminate" id="toc-example-survey-analysis-using-illuminate"><span class="toc-section-number">7.6</span> EXAMPLE :: Survey analysis using illuminate</a>
<ul>
<li><a href="analysis.html#step-0-call-libraries" id="toc-step-0-call-libraries"><span class="toc-section-number">7.6.1</span> Step 0:: Call libraries</a></li>
<li><a href="analysis.html#step-1-read-data" id="toc-step-1-read-data"><span class="toc-section-number">7.6.2</span> Step 1:: Read data</a></li>
<li><a href="analysis.html#step-optional-preaparing-the-data" id="toc-step-optional-preaparing-the-data"><span class="toc-section-number">7.6.3</span> Step OPTIONAL:: Preaparing the data</a></li>
<li><a href="analysis.html#step-2-weight-calculation" id="toc-step-2-weight-calculation"><span class="toc-section-number">7.6.4</span> Step 2:: Weight calculation</a></li>
<li><a href="analysis.html#read-sampleframe" id="toc-read-sampleframe"><span class="toc-section-number">7.6.5</span> Read sampleframe</a></li>
<li><a href="analysis.html#add-weights-to-the-dataframe" id="toc-add-weights-to-the-dataframe"><span class="toc-section-number">7.6.6</span> Add weights to the dataframe</a></li>
<li><a href="analysis.html#step-3.1-weighted-analysis" id="toc-step-3.1-weighted-analysis"><span class="toc-section-number">7.6.7</span> Step 3.1:: Weighted analysis</a></li>
<li><a href="analysis.html#step-3.2-unweighted-analysis" id="toc-step-3.2-unweighted-analysis"><span class="toc-section-number">7.6.8</span> Step 3.2:: Unweighted analysis</a></li>
<li><a href="analysis.html#step-3.3-weighted-and-disaggregated-by-gender-analysis" id="toc-step-3.3-weighted-and-disaggregated-by-gender-analysis"><span class="toc-section-number">7.6.9</span> Step 3.3:: Weighted and disaggregated by gender analysis</a></li>
<li><a href="analysis.html#step-4-export-with-write_formatted_excel" id="toc-step-4-export-with-write_formatted_excel"><span class="toc-section-number">7.6.10</span> Step 4:: Export with <code>write_formatted_excel()</code></a></li>
</ul></li>
<li><a href="analysis.html#repeating-the-above" id="toc-repeating-the-above"><span class="toc-section-number">7.7</span> Repeating the above</a></li>
<li><a href="analysis.html#analysis---top-x-ranking-select-one-and-select-multiple" id="toc-analysis---top-x-ranking-select-one-and-select-multiple"><span class="toc-section-number">7.8</span> Analysis - top X / ranking (select one and select multiple)</a></li>
<li><a href="analysis.html#borda-count" id="toc-borda-count"><span class="toc-section-number">7.9</span> Borda count</a></li>
<li><a href="analysis.html#hypothesis-testing" id="toc-hypothesis-testing"><span class="toc-section-number">7.10</span> Hypothesis testing</a>
<ul>
<li><a href="analysis.html#t-test" id="toc-t-test"><span class="toc-section-number">7.10.1</span> T-test</a></li>
<li><a href="analysis.html#anova" id="toc-anova"><span class="toc-section-number">7.10.2</span> ANOVA</a></li>
<li><a href="analysis.html#chi-squares" id="toc-chi-squares"><span class="toc-section-number">7.10.3</span> chi-squares</a></li>
<li><a href="analysis.html#chi-squared-goodness-of-fit-test" id="toc-chi-squared-goodness-of-fit-test"><span class="toc-section-number">7.10.4</span> Chi-squared Goodness of Fit test</a></li>
<li><a href="analysis.html#proportion-tests-z-test" id="toc-proportion-tests-z-test"><span class="toc-section-number">7.10.5</span> Proportion tests (z-test)</a></li>
</ul></li>
</ul></li>
<li><a href="outputs.html#outputs" id="toc-outputs"><span class="toc-section-number">8</span> Outputs</a>
<ul>
<li><a href="outputs.html#from-long-to-large-table" id="toc-from-long-to-large-table"><span class="toc-section-number">8.1</span> From long to large table</a></li>
<li><a href="outputs.html#merge-file" id="toc-merge-file"><span class="toc-section-number">8.2</span> Merge file</a></li>
<li><a href="outputs.html#graphs" id="toc-graphs"><span class="toc-section-number">8.3</span> Graphs</a>
<ul>
<li><a href="outputs.html#spider-graphs" id="toc-spider-graphs"><span class="toc-section-number">8.3.1</span> spider graphs</a></li>
<li><a href="outputs.html#prison-graphs" id="toc-prison-graphs"><span class="toc-section-number">8.3.2</span> prison graphs</a></li>
<li><a href="outputs.html#bar-graphs" id="toc-bar-graphs"><span class="toc-section-number">8.3.3</span> Bar graphs</a></li>
<li><a href="outputs.html#euler-diagram" id="toc-euler-diagram"><span class="toc-section-number">8.3.4</span> Euler diagram</a></li>
<li><a href="outputs.html#venn-diagram" id="toc-venn-diagram"><span class="toc-section-number">8.3.5</span> Venn diagram</a></li>
<li><a href="outputs.html#upset-plots" id="toc-upset-plots"><span class="toc-section-number">8.3.6</span> UpSet plots</a></li>
<li><a href="outputs.html#boxplots" id="toc-boxplots"><span class="toc-section-number">8.3.7</span> boxplots</a></li>
<li><a href="outputs.html#circular-barplots" id="toc-circular-barplots"><span class="toc-section-number">8.3.8</span> Circular barplots</a></li>
</ul></li>
<li><a href="outputs.html#labels" id="toc-labels"><span class="toc-section-number">8.4</span> Labels</a>
<ul>
<li><a href="outputs.html#xml-to-label" id="toc-xml-to-label"><span class="toc-section-number">8.4.1</span> Xml to Label</a></li>
<li><a href="outputs.html#change-from-label-to-xml" id="toc-change-from-label-to-xml"><span class="toc-section-number">8.4.2</span> change from label to xml</a></li>
</ul></li>
<li><a href="outputs.html#dashboarding---sharing-information" id="toc-dashboarding---sharing-information"><span class="toc-section-number">8.5</span> Dashboarding - Sharing information</a></li>
<li><a href="outputs.html#outputs-with-hypothesis-testing-results" id="toc-outputs-with-hypothesis-testing-results"><span class="toc-section-number">8.6</span> Outputs with hypothesis testing results</a></li>
</ul></li>
<li><a href="miscellaneous.html#miscellaneous" id="toc-miscellaneous"><span class="toc-section-number">9</span> Miscellaneous</a></li>
<li><a href="archives.html#archives" id="toc-archives"><span class="toc-section-number">10</span> Archives</a>
<ul>
<li><a href="archives.html#pre-analysis-1" id="toc-pre-analysis-1"><span class="toc-section-number">10.1</span> 01 Pre analysis</a>
<ul>
<li><a href="archives.html#generation-of-random-sample-points" id="toc-generation-of-random-sample-points"><span class="toc-section-number">10.1.1</span> Generation of random sample points</a></li>
</ul></li>
<li><a href="archives.html#cleaning" id="toc-cleaning"><span class="toc-section-number">10.2</span> Cleaning</a></li>
<li><a href="archives.html#spatial-verification-checks" id="toc-spatial-verification-checks"><span class="toc-section-number">10.3</span> Spatial verification checks</a>
<ul>
<li><a href="archives.html#spatial-verification-checks-on-settlement-level" id="toc-spatial-verification-checks-on-settlement-level"><span class="toc-section-number">10.3.1</span> Spatial verification checks on settlement level</a></li>
<li><a href="archives.html#spatial-verification-checks-on-sample-point-level" id="toc-spatial-verification-checks-on-sample-point-level"><span class="toc-section-number">10.3.2</span> Spatial verification checks on sample point level</a></li>
</ul></li>
<li><a href="archives.html#analayis" id="toc-analayis"><span class="toc-section-number">10.4</span> Analayis</a>
<ul>
<li><a href="archives.html#hypegrammar" id="toc-hypegrammar"><span class="toc-section-number">10.4.1</span> hypegrammaR</a></li>
<li><a href="archives.html#butter-survey_collapse" id="toc-butter-survey_collapse"><span class="toc-section-number">10.4.2</span> butteR survey_collapse</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R cookbook for analysis with IMPACT</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="outputs" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Outputs<a href="outputs.html#outputs" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="from-long-to-large-table" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> From long to large table<a href="outputs.html#from-long-to-large-table" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>How to move from a tidy format to a large format</p>
</div>
<div id="merge-file" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Merge file<a href="outputs.html#merge-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>How to create a merge file</p>
</div>
<div id="graphs" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Graphs<a href="outputs.html#graphs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="spider-graphs" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> spider graphs<a href="outputs.html#spider-graphs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="prison-graphs" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> prison graphs<a href="outputs.html#prison-graphs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="bar-graphs" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Bar graphs<a href="outputs.html#bar-graphs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Loading libraries and the main dataset</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="outputs.html#cb287-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb287-2"><a href="outputs.html#cb287-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb287-3"><a href="outputs.html#cb287-3" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb287-4"><a href="outputs.html#cb287-4" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb287-5"><a href="outputs.html#cb287-5" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb287-6"><a href="outputs.html#cb287-6" tabindex="-1"></a><span class="fu">library</span>(reshape)</span>
<span id="cb287-7"><a href="outputs.html#cb287-7" tabindex="-1"></a></span>
<span id="cb287-8"><a href="outputs.html#cb287-8" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Choosing the needed indicator for building bar graph. The indicators in the questionnaire could be in 2 types: Only one answer can be selected (select_one question) and multiple answers can be selected (select_multiple question). Will review it separately.</p>
<ol style="list-style-type: decimal">
<li>For select one questions:</li>
</ol>
<p>Preparing values for visualization (replacing xml values to lables)</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="outputs.html#cb288-1" tabindex="-1"></a><span class="co"># Loading questionnaire</span></span>
<span id="cb288-2"><a href="outputs.html#cb288-2" tabindex="-1"></a>questions <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;survey&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb288-3"><a href="outputs.html#cb288-3" tabindex="-1"></a>choices <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_Questionnaire_24JUL2020.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;choices&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb288-4"><a href="outputs.html#cb288-4" tabindex="-1"></a></span>
<span id="cb288-5"><a href="outputs.html#cb288-5" tabindex="-1"></a><span class="co"># Based on value we get option type</span></span>
<span id="cb288-6"><a href="outputs.html#cb288-6" tabindex="-1"></a>q.list_name <span class="ot">&lt;-</span> <span class="fu">str_split</span>(questions[questions<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;b9_hohh_marital_status&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(questions<span class="sc">$</span>name), <span class="st">&quot;type&quot;</span>], <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb288-7"><a href="outputs.html#cb288-7" tabindex="-1"></a></span>
<span id="cb288-8"><a href="outputs.html#cb288-8" tabindex="-1"></a><span class="co"># New table with xml and labels</span></span>
<span id="cb288-9"><a href="outputs.html#cb288-9" tabindex="-1"></a>labels <span class="ot">&lt;-</span> choices <span class="sc">%&gt;%</span></span>
<span id="cb288-10"><a href="outputs.html#cb288-10" tabindex="-1"></a>  <span class="fu">filter</span>(list_name <span class="sc">==</span> q.list_name) <span class="sc">%&gt;%</span></span>
<span id="cb288-11"><a href="outputs.html#cb288-11" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="st">&quot;label::English&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb288-12"><a href="outputs.html#cb288-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">b9_hohh_marital_status =</span> name, <span class="at">b9_hohh_marital_status_label =</span> <span class="st">&quot;label::English&quot;</span>)</span>
<span id="cb288-13"><a href="outputs.html#cb288-13" tabindex="-1"></a></span>
<span id="cb288-14"><a href="outputs.html#cb288-14" tabindex="-1"></a><span class="co"># Add a column with English labels to the main dataset</span></span>
<span id="cb288-15"><a href="outputs.html#cb288-15" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">merge</span>(labels, main_dataset, <span class="at">by =</span> <span class="st">&#39;b9_hohh_marital_status&#39;</span>)</span></code></pre></div>
<p>Building a bar graph</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="outputs.html#cb289-1" tabindex="-1"></a><span class="fu">ggplot</span>((main_dataset <span class="sc">%&gt;%</span></span>
<span id="cb289-2"><a href="outputs.html#cb289-2" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(b9_hohh_marital_status_label)) <span class="sc">%&gt;%</span></span>
<span id="cb289-3"><a href="outputs.html#cb289-3" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(b9_hohh_marital_status_label) <span class="sc">%&gt;%</span></span>
<span id="cb289-4"><a href="outputs.html#cb289-4" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">weight_sum =</span> <span class="fu">round</span>(<span class="fu">sum</span>(stratum.weight), <span class="dv">2</span>))), <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">reorder</span>(b9_hohh_marital_status_label, weight_sum), <span class="at">x =</span> weight_sum<span class="sc">/</span><span class="fu">sum</span>(weight_sum))) <span class="sc">+</span></span>
<span id="cb289-5"><a href="outputs.html#cb289-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#EE5859&quot;</span>) <span class="sc">+</span></span>
<span id="cb289-6"><a href="outputs.html#cb289-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">round</span>((weight_sum<span class="sc">/</span><span class="fu">sum</span>(weight_sum)<span class="sc">*</span><span class="dv">100</span>),<span class="dv">0</span>),<span class="st">&quot;%&quot;</span>)), <span class="at">color =</span> <span class="st">&quot;#58585A&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb289-7"><a href="outputs.html#cb289-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb289-8"><a href="outputs.html#cb289-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#58585A&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb289-9"><a href="outputs.html#cb289-9" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="at">panel.background =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>Removing temporary data</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="outputs.html#cb290-1" tabindex="-1"></a><span class="fu">rm</span>(labels, q.list_name)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>For select multiple questions:</li>
</ol>
<p>Preparing values for visualization (replacing xml values to lables; calculating results)</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="outputs.html#cb291-1" tabindex="-1"></a><span class="co"># Getting needed columns from the main dataset (indicator and weight)</span></span>
<span id="cb291-2"><a href="outputs.html#cb291-2" tabindex="-1"></a>visual_dataset <span class="ot">&lt;-</span> main_dataset[,<span class="fu">grepl</span>(<span class="st">&quot;b10_hohh_vulnerability.|stratum.weight&quot;</span>, <span class="fu">names</span>(main_dataset))]</span>
<span id="cb291-3"><a href="outputs.html#cb291-3" tabindex="-1"></a></span>
<span id="cb291-4"><a href="outputs.html#cb291-4" tabindex="-1"></a><span class="co"># Reshaping the dataset</span></span>
<span id="cb291-5"><a href="outputs.html#cb291-5" tabindex="-1"></a>visual_dataset <span class="ot">&lt;-</span> <span class="fu">melt</span>(visual_dataset, <span class="at">id.vars =</span> <span class="st">&quot;stratum.weight&quot;</span>)</span>
<span id="cb291-6"><a href="outputs.html#cb291-6" tabindex="-1"></a></span>
<span id="cb291-7"><a href="outputs.html#cb291-7" tabindex="-1"></a><span class="co"># Grouping by choices and getting sum of weights</span></span>
<span id="cb291-8"><a href="outputs.html#cb291-8" tabindex="-1"></a>visual_dataset <span class="ot">&lt;-</span> visual_dataset <span class="sc">%&gt;%</span></span>
<span id="cb291-9"><a href="outputs.html#cb291-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> stratum.weight <span class="sc">*</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb291-10"><a href="outputs.html#cb291-10" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb291-11"><a href="outputs.html#cb291-11" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight_sum =</span> <span class="fu">sum</span>(<span class="fu">as.numeric</span>(weight))) <span class="sc">%&gt;%</span></span>
<span id="cb291-12"><a href="outputs.html#cb291-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">round</span>(weight_sum <span class="sc">/</span> <span class="fu">sum</span>(main_dataset<span class="sc">$</span>stratum.weight)<span class="sc">*</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb291-13"><a href="outputs.html#cb291-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">b10_hohh_vulnerability =</span> variable)</span>
<span id="cb291-14"><a href="outputs.html#cb291-14" tabindex="-1"></a></span>
<span id="cb291-15"><a href="outputs.html#cb291-15" tabindex="-1"></a><span class="co"># Based on value we get option type and replacing xmls to the labels and </span></span>
<span id="cb291-16"><a href="outputs.html#cb291-16" tabindex="-1"></a>q.list_name <span class="ot">&lt;-</span> <span class="fu">str_split</span>(questions[questions<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;b10_hohh_vulnerability&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(questions<span class="sc">$</span>name), <span class="st">&quot;type&quot;</span>], <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb291-17"><a href="outputs.html#cb291-17" tabindex="-1"></a></span>
<span id="cb291-18"><a href="outputs.html#cb291-18" tabindex="-1"></a><span class="co"># New table with xml and labels</span></span>
<span id="cb291-19"><a href="outputs.html#cb291-19" tabindex="-1"></a>labels <span class="ot">&lt;-</span> choices <span class="sc">%&gt;%</span></span>
<span id="cb291-20"><a href="outputs.html#cb291-20" tabindex="-1"></a>  <span class="fu">filter</span>(list_name <span class="sc">==</span> q.list_name) <span class="sc">%&gt;%</span></span>
<span id="cb291-21"><a href="outputs.html#cb291-21" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="st">&quot;label::English&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb291-22"><a href="outputs.html#cb291-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">b10_hohh_vulnerability =</span> name, <span class="at">b10_hohh_vulnerability_label =</span> <span class="st">&quot;label::English&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb291-23"><a href="outputs.html#cb291-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b10_hohh_vulnerability =</span> <span class="fu">paste0</span>(<span class="st">&quot;b10_hohh_vulnerability.&quot;</span>, b10_hohh_vulnerability))</span>
<span id="cb291-24"><a href="outputs.html#cb291-24" tabindex="-1"></a></span>
<span id="cb291-25"><a href="outputs.html#cb291-25" tabindex="-1"></a><span class="co"># Add a column with English labels to the visualization dataset</span></span>
<span id="cb291-26"><a href="outputs.html#cb291-26" tabindex="-1"></a>visual_dataset <span class="ot">&lt;-</span> <span class="fu">merge</span>(labels, visual_dataset, <span class="at">by =</span> <span class="st">&#39;b10_hohh_vulnerability&#39;</span>)</span></code></pre></div>
<p>Building a bar graph</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="outputs.html#cb292-1" tabindex="-1"></a><span class="fu">ggplot</span>(visual_dataset, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">reorder</span>(b10_hohh_vulnerability_label, percentage), <span class="at">x =</span> percentage)) <span class="sc">+</span></span>
<span id="cb292-2"><a href="outputs.html#cb292-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#EE5859&quot;</span>) <span class="sc">+</span></span>
<span id="cb292-3"><a href="outputs.html#cb292-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(percentage, <span class="st">&quot;%&quot;</span>)), <span class="at">color =</span> <span class="st">&quot;#58585A&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb292-4"><a href="outputs.html#cb292-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb292-5"><a href="outputs.html#cb292-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;#58585A&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb292-6"><a href="outputs.html#cb292-6" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="at">panel.background =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>Removing temporary data</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="outputs.html#cb293-1" tabindex="-1"></a><span class="fu">rm</span>(labels, q.list_name)</span></code></pre></div>
</div>
<div id="euler-diagram" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Euler diagram<a href="outputs.html#euler-diagram" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>An Euler diagram is a diagrammatic means of representing sets and their relationships. They are particularly useful for explaining complex hierarchies and overlapping definitions. They are similar to another set diagramming technique, Venn diagrams. Unlike Venn diagrams, which show all possible relations between different sets, the Euler diagram shows only relevant relationships. <a href="https://en.wikipedia.org/wiki/Euler_diagram">Source</a></em></p>
<p>First let’s load <a href="https://cran.r-project.org/web/packages/eulerr/vignettes/introduction.html">Eulerr library</a> and our dataset</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="outputs.html#cb294-1" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;inputs/UKR2007_MSNA20_HH_dataset_main_rcop.csv&quot;</span>, <span class="at">na.strings =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Euler diagrams are particularly useful to visualize overlaps between HH characteristics that help better understand the demographic profile of the area. For example, let’s visualize overlaps between such HH characteristics as age, displacement status, income level, disability, and employment status.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="outputs.html#cb295-1" tabindex="-1"></a><span class="fu">library</span>(eulerr)</span>
<span id="cb295-2"><a href="outputs.html#cb295-2" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb295-3"><a href="outputs.html#cb295-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb295-4"><a href="outputs.html#cb295-4" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb295-5"><a href="outputs.html#cb295-5" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb295-6"><a href="outputs.html#cb295-6" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb295-7"><a href="outputs.html#cb295-7" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb295-8"><a href="outputs.html#cb295-8" tabindex="-1"></a><span class="fu">library</span>(UpSetR)</span>
<span id="cb295-9"><a href="outputs.html#cb295-9" tabindex="-1"></a></span>
<span id="cb295-10"><a href="outputs.html#cb295-10" tabindex="-1"></a>vulnerability_data <span class="ot">&lt;-</span> main_dataset <span class="sc">%&gt;%</span></span>
<span id="cb295-11"><a href="outputs.html#cb295-11" tabindex="-1"></a>    <span class="fu">select</span>(b10_hohh_vulnerability.disability_not_including_chronic_illness,b10_hohh_vulnerability.older_person,</span>
<span id="cb295-12"><a href="outputs.html#cb295-12" tabindex="-1"></a>           b10_hohh_vulnerability.unemployed,d1_hh_displacement_status,b15_hohh_income,X_uuid, strata, stratum.weight)<span class="sc">%&gt;%</span></span>
<span id="cb295-13"><a href="outputs.html#cb295-13" tabindex="-1"></a>  <span class="co">#select all necessary columns</span></span>
<span id="cb295-14"><a href="outputs.html#cb295-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">displaced =</span> <span class="fu">ifelse</span>(d1_hh_displacement_status <span class="sc">==</span> <span class="st">&quot;no&quot;</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb295-15"><a href="outputs.html#cb295-15" tabindex="-1"></a>           <span class="at">low_income =</span> <span class="fu">ifelse</span>(<span class="fu">as.numeric</span>(b15_hohh_income) <span class="sc">&gt;=</span> <span class="dv">2189</span>, <span class="dv">0</span>, <span class="dv">1</span>))<span class="sc">%&gt;%</span> <span class="co">#2189 UAH(83$) is minimal monthly income in 2020</span></span>
<span id="cb295-16"><a href="outputs.html#cb295-16" tabindex="-1"></a>  <span class="co">#calculate binary indicators in case they are not available in the dataset directly from select multiple questions</span></span>
<span id="cb295-17"><a href="outputs.html#cb295-17" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>d1_hh_displacement_status, <span class="sc">-</span>b15_hohh_income)<span class="sc">%&gt;%</span></span>
<span id="cb295-18"><a href="outputs.html#cb295-18" tabindex="-1"></a>    <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;disability&quot;</span>, <span class="st">&quot;60+&quot;</span>, <span class="st">&quot;unemployed&quot;</span>, <span class="st">&quot;uuid&quot;</span>, <span class="st">&quot;strata&quot;</span>, <span class="st">&quot;weight&quot;</span>, <span class="st">&quot;displaced&quot;</span>, <span class="st">&quot;low_income&quot;</span>))</span>
<span id="cb295-19"><a href="outputs.html#cb295-19" tabindex="-1"></a>  <span class="co">#remove unnecessary columns and rename other column</span></span>
<span id="cb295-20"><a href="outputs.html#cb295-20" tabindex="-1"></a></span>
<span id="cb295-21"><a href="outputs.html#cb295-21" tabindex="-1"></a>vulnerability_data <span class="ot">&lt;-</span> <span class="co">#create column that will combine all binary columns into one (same approach as in </span><span class="al">###</span><span class="co"> Re-generate text                             column  for select multiple questions section of Data Cleaning chapter)</span></span>
<span id="cb295-22"><a href="outputs.html#cb295-22" tabindex="-1"></a>    <span class="fu">map2_df</span>(vulnerability_data, <span class="fu">names</span>(vulnerability_data), <span class="sc">~</span>  <span class="fu">replace</span>(.x, .x<span class="sc">==</span><span class="dv">1</span>, .y) <span class="sc">%&gt;%</span> </span>
<span id="cb295-23"><a href="outputs.html#cb295-23" tabindex="-1"></a>    <span class="fu">replace</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb295-24"><a href="outputs.html#cb295-24" tabindex="-1"></a>    <span class="fu">unite</span>(combined, disability, <span class="st">`</span><span class="at">60+</span><span class="st">`</span>, displaced, low_income, unemployed, <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&#39;&amp;&#39;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb295-25"><a href="outputs.html#cb295-25" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>combined <span class="sc">==</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb295-26"><a href="outputs.html#cb295-26" tabindex="-1"></a></span>
<span id="cb295-27"><a href="outputs.html#cb295-27" tabindex="-1"></a><span class="co">#calculate weighted summary statistics for each combination</span></span>
<span id="cb295-28"><a href="outputs.html#cb295-28" tabindex="-1"></a>vulnerability_summary <span class="ot">&lt;-</span> vulnerability_data <span class="sc">%&gt;%</span></span>
<span id="cb295-29"><a href="outputs.html#cb295-29" tabindex="-1"></a>  <span class="fu">select</span>(strata, weight, combined)<span class="sc">%&gt;%</span> </span>
<span id="cb295-30"><a href="outputs.html#cb295-30" tabindex="-1"></a>  <span class="fu">group_by</span>(combined) <span class="sc">%&gt;%</span> </span>
<span id="cb295-31"><a href="outputs.html#cb295-31" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight_sum =</span> <span class="fu">sum</span>(<span class="fu">as.numeric</span>(weight)))<span class="sc">%&gt;%</span></span>
<span id="cb295-32"><a href="outputs.html#cb295-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">per =</span> weight_sum <span class="sc">/</span> <span class="fu">sum</span>(weight_sum) <span class="sc">*</span> <span class="dv">100</span>)<span class="sc">%&gt;%</span></span>
<span id="cb295-33"><a href="outputs.html#cb295-33" tabindex="-1"></a>  <span class="fu">filter</span>(per <span class="sc">&gt;</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb295-34"><a href="outputs.html#cb295-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>weight_sum)</span>
<span id="cb295-35"><a href="outputs.html#cb295-35" tabindex="-1"></a></span>
<span id="cb295-36"><a href="outputs.html#cb295-36" tabindex="-1"></a><span class="co">#convert data frame into named numeric vector that is used by plot function</span></span>
<span id="cb295-37"><a href="outputs.html#cb295-37" tabindex="-1"></a>vulnerability_input <span class="ot">&lt;-</span>  vulnerability_summary <span class="sc">%&gt;%</span></span>
<span id="cb295-38"><a href="outputs.html#cb295-38" tabindex="-1"></a>                        <span class="fu">deframe</span>()</span></code></pre></div>
<p>In this block we will build euler diagram using REACH color palette and some basic styling.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="outputs.html#cb296-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">euler</span>(vulnerability_input),</span>
<span id="cb296-2"><a href="outputs.html#cb296-2" tabindex="-1"></a>     <span class="at">edges =</span> <span class="cn">FALSE</span>,</span>
<span id="cb296-3"><a href="outputs.html#cb296-3" tabindex="-1"></a>     <span class="at">quantities =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">&quot;percent&quot;</span>, <span class="at">fontsize =</span> <span class="dv">8</span>),</span>
<span id="cb296-4"><a href="outputs.html#cb296-4" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;60+&quot;</span>, <span class="st">&quot;Displaced&quot;</span>, <span class="st">&quot;Low income&quot;</span>, <span class="st">&quot;Disability&quot;</span>, <span class="st">&quot;Unemployed&quot;</span>),</span>
<span id="cb296-5"><a href="outputs.html#cb296-5" tabindex="-1"></a>     <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;60+&quot;</span>, <span class="st">&quot;Displaced&quot;</span>, <span class="st">&quot;Low income&quot;</span>, <span class="st">&quot;Disability&quot;</span>, <span class="st">&quot;Unemployed&quot;</span>)),</span>
<span id="cb296-6"><a href="outputs.html#cb296-6" tabindex="-1"></a>     <span class="at">fills =</span> <span class="fu">c</span>(<span class="st">&quot;#7CB6C4&quot;</span>,<span class="st">&quot;#B6C8B1&quot;</span>,<span class="st">&quot;#F6E3E3&quot;</span>,<span class="st">&quot;#D1CAB8&quot;</span>,<span class="st">&quot;#D1D3D4&quot;</span>)</span>
<span id="cb296-7"><a href="outputs.html#cb296-7" tabindex="-1"></a>     )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<p>As an alternative, we also can build a Venn diagram that shows each relation (even not possible in reality). As you can see Venn diagram in this case is less readable and usable.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="outputs.html#cb297-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">venn</span>(vulnerability_input),</span>
<span id="cb297-2"><a href="outputs.html#cb297-2" tabindex="-1"></a>     <span class="at">edges =</span> <span class="cn">FALSE</span>,</span>
<span id="cb297-3"><a href="outputs.html#cb297-3" tabindex="-1"></a>     <span class="at">quantities =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">&quot;percent&quot;</span>, <span class="at">fontsize =</span> <span class="dv">8</span>), </span>
<span id="cb297-4"><a href="outputs.html#cb297-4" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;60+&quot;</span>, <span class="st">&quot;Displaced&quot;</span>, <span class="st">&quot;Low income&quot;</span>, <span class="st">&quot;Disability&quot;</span>, <span class="st">&quot;Unemployed&quot;</span>),</span>
<span id="cb297-5"><a href="outputs.html#cb297-5" tabindex="-1"></a>     <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;60+&quot;</span>, <span class="st">&quot;Displaced&quot;</span>, <span class="st">&quot;Low income&quot;</span>, <span class="st">&quot;Disability&quot;</span>, <span class="st">&quot;Unemployed&quot;</span>)),</span>
<span id="cb297-6"><a href="outputs.html#cb297-6" tabindex="-1"></a>     <span class="at">fills =</span> <span class="fu">c</span>(<span class="st">&quot;#7CB6C4&quot;</span>,<span class="st">&quot;#B6C8B1&quot;</span>,<span class="st">&quot;#F6E3E3&quot;</span>,<span class="st">&quot;#D1CAB8&quot;</span>,<span class="st">&quot;#D1D3D4&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-159-1.png" width="672" />
Another popular type of diagram that shows relation is <a href="https://github.com/hms-dbmi/UpSetR">UpSetR diagram</a>. Even with default styling, it’s quite good in the visualization of intersections between different HH characteristics.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="outputs.html#cb298-1" tabindex="-1"></a><span class="fu">upset</span>(<span class="fu">fromExpression</span>(vulnerability_input), <span class="at">order.by =</span> <span class="st">&quot;freq&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
</div>
<div id="venn-diagram" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Venn diagram<a href="outputs.html#venn-diagram" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="upset-plots" class="section level3 hasAnchor" number="8.3.6">
<h3><span class="header-section-number">8.3.6</span> UpSet plots<a href="outputs.html#upset-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="boxplots" class="section level3 hasAnchor" number="8.3.7">
<h3><span class="header-section-number">8.3.7</span> boxplots<a href="outputs.html#boxplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="circular-barplots" class="section level3 hasAnchor" number="8.3.8">
<h3><span class="header-section-number">8.3.8</span> Circular barplots<a href="outputs.html#circular-barplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For creating circular barplots, frequency table with selected indicators should be prepared first.</p>
<p>For the current example, let’s create the table on everyday consumption of different kinds of food in a HH depending on the area of living urban/rural</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="outputs.html#cb299-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb299-2"><a href="outputs.html#cb299-2" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb299-3"><a href="outputs.html#cb299-3" tabindex="-1"></a></span>
<span id="cb299-4"><a href="outputs.html#cb299-4" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">separate</span>(main_dataset, strata, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;zone&quot;</span>, <span class="st">&quot;type&quot;</span>), <span class="st">&quot;_&quot;</span>)</span>
<span id="cb299-5"><a href="outputs.html#cb299-5" tabindex="-1"></a></span>
<span id="cb299-6"><a href="outputs.html#cb299-6" tabindex="-1"></a>dnames <span class="ot">&lt;-</span> <span class="fu">names</span>(main_dataset)</span>
<span id="cb299-7"><a href="outputs.html#cb299-7" tabindex="-1"></a></span>
<span id="cb299-8"><a href="outputs.html#cb299-8" tabindex="-1"></a>cons_names <span class="ot">&lt;-</span> dnames[<span class="fu">grepl</span>(<span class="st">&quot;consumption&quot;</span>, dnames)]</span>
<span id="cb299-9"><a href="outputs.html#cb299-9" tabindex="-1"></a></span>
<span id="cb299-10"><a href="outputs.html#cb299-10" tabindex="-1"></a>tidy_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cereals&quot;</span>, <span class="st">&quot;Roots&quot;</span>, <span class="st">&quot;Vegetables&quot;</span>, <span class="st">&quot;Fruits&quot;</span>, <span class="st">&quot;Meat&quot;</span>, <span class="st">&quot;Eggs&quot;</span>, <span class="st">&quot;Pulses&quot;</span>, <span class="st">&quot;Dairy&quot;</span>, <span class="st">&quot;Oil&quot;</span>, <span class="st">&quot;Sugar&quot;</span>, <span class="st">&quot;Condiments&quot;</span>)</span>
<span id="cb299-11"><a href="outputs.html#cb299-11" tabindex="-1"></a></span>
<span id="cb299-12"><a href="outputs.html#cb299-12" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="dv">5</span>))</span>
<span id="cb299-13"><a href="outputs.html#cb299-13" tabindex="-1"></a></span>
<span id="cb299-14"><a href="outputs.html#cb299-14" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb299-15"><a href="outputs.html#cb299-15" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cons_names)) {</span>
<span id="cb299-16"><a href="outputs.html#cb299-16" tabindex="-1"></a>ni <span class="ot">&lt;-</span> cons_names[i]</span>
<span id="cb299-17"><a href="outputs.html#cb299-17" tabindex="-1"></a></span>
<span id="cb299-18"><a href="outputs.html#cb299-18" tabindex="-1"></a>rur <span class="ot">&lt;-</span> main_dataset <span class="sc">|&gt;</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;rural&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ni)) <span class="sc">|&gt;</span> <span class="fu">count</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">base =</span> <span class="fu">sum</span>(n), <span class="at">prop =</span> <span class="fu">round</span>((n<span class="sc">/</span>base)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="at">group =</span> tidy_names[i], <span class="at">individual =</span> <span class="st">&quot;Rural&quot;</span>)</span>
<span id="cb299-19"><a href="outputs.html#cb299-19" tabindex="-1"></a></span>
<span id="cb299-20"><a href="outputs.html#cb299-20" tabindex="-1"></a>urb <span class="ot">&lt;-</span> main_dataset <span class="sc">|&gt;</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;urban&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ni)) <span class="sc">|&gt;</span> <span class="fu">count</span>(<span class="sc">!!</span><span class="fu">sym</span>(ni)) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">base =</span> <span class="fu">sum</span>(n), <span class="at">prop =</span> <span class="fu">round</span>((n<span class="sc">/</span>base)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="at">group =</span> tidy_names[i], <span class="at">individual =</span> <span class="st">&quot;Urban&quot;</span>)</span>
<span id="cb299-21"><a href="outputs.html#cb299-21" tabindex="-1"></a></span>
<span id="cb299-22"><a href="outputs.html#cb299-22" tabindex="-1"></a><span class="fu">names</span>(rur) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;fre_cons&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;base&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;group&quot;</span>, <span class="st">&quot;individual&quot;</span>)</span>
<span id="cb299-23"><a href="outputs.html#cb299-23" tabindex="-1"></a><span class="fu">names</span>(urb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;fre_cons&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="st">&quot;base&quot;</span>, <span class="st">&quot;prop&quot;</span>, <span class="st">&quot;group&quot;</span>, <span class="st">&quot;individual&quot;</span>)</span>
<span id="cb299-24"><a href="outputs.html#cb299-24" tabindex="-1"></a></span>
<span id="cb299-25"><a href="outputs.html#cb299-25" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_food, rur, urb)</span>
<span id="cb299-26"><a href="outputs.html#cb299-26" tabindex="-1"></a>}</span>
<span id="cb299-27"><a href="outputs.html#cb299-27" tabindex="-1"></a></span>
<span id="cb299-28"><a href="outputs.html#cb299-28" tabindex="-1"></a>table_food<span class="sc">$</span>value <span class="ot">&lt;-</span> table_food<span class="sc">$</span>prop</span></code></pre></div>
<p>For the current chart, the everyday consumption of certain products will be selected, so frequency of consumption should be filtered so it is == 7</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="outputs.html#cb300-1" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> table_food <span class="sc">|&gt;</span> <span class="fu">filter</span>(fre_cons <span class="sc">==</span> <span class="dv">7</span>)</span></code></pre></div>
<p>Adding “filler” field to make the bottom layer (unfilled space) with light grey. Filler should be equal to the “end of the scale”, e.g 100%</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="outputs.html#cb301-1" tabindex="-1"></a>table_food<span class="sc">$</span>filler <span class="ot">&lt;-</span> <span class="dv">100</span></span></code></pre></div>
<p>Preparing grid data for the chart</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="outputs.html#cb302-1" tabindex="-1"></a>table_food<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(table_food<span class="sc">$</span>group)</span>
<span id="cb302-2"><a href="outputs.html#cb302-2" tabindex="-1"></a><span class="co"># Set a number of &#39;empty bar&#39; to add at the end of each group</span></span>
<span id="cb302-3"><a href="outputs.html#cb302-3" tabindex="-1"></a>empty_bar <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb302-4"><a href="outputs.html#cb302-4" tabindex="-1"></a>to_add <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">matrix</span>(<span class="cn">NA</span>, empty_bar<span class="sc">*</span><span class="fu">nlevels</span>(table_food<span class="sc">$</span>group), <span class="fu">ncol</span>(table_food)))</span>
<span id="cb302-5"><a href="outputs.html#cb302-5" tabindex="-1"></a><span class="fu">colnames</span>(to_add) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(table_food)</span>
<span id="cb302-6"><a href="outputs.html#cb302-6" tabindex="-1"></a>to_add<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">levels</span>(table_food<span class="sc">$</span>group), <span class="at">each=</span>empty_bar)</span>
<span id="cb302-7"><a href="outputs.html#cb302-7" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_food, to_add)</span>
<span id="cb302-8"><a href="outputs.html#cb302-8" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> table_food <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(group)</span>
<span id="cb302-9"><a href="outputs.html#cb302-9" tabindex="-1"></a>table_food<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(table_food))</span>
<span id="cb302-10"><a href="outputs.html#cb302-10" tabindex="-1"></a></span>
<span id="cb302-11"><a href="outputs.html#cb302-11" tabindex="-1"></a><span class="co">#one more empty bar</span></span>
<span id="cb302-12"><a href="outputs.html#cb302-12" tabindex="-1"></a>to_add <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">matrix</span>(<span class="cn">NA</span>, empty_bar<span class="sc">*</span><span class="fu">nlevels</span>(table_food<span class="sc">$</span>group), <span class="fu">ncol</span>(table_food)))</span>
<span id="cb302-13"><a href="outputs.html#cb302-13" tabindex="-1"></a><span class="fu">colnames</span>(to_add) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(table_food)</span>
<span id="cb302-14"><a href="outputs.html#cb302-14" tabindex="-1"></a>to_add<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">levels</span>(table_food<span class="sc">$</span>group), <span class="at">each=</span>empty_bar)</span>
<span id="cb302-15"><a href="outputs.html#cb302-15" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> <span class="fu">rbind</span>(table_food, to_add)</span>
<span id="cb302-16"><a href="outputs.html#cb302-16" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> table_food <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(group)</span>
<span id="cb302-17"><a href="outputs.html#cb302-17" tabindex="-1"></a>table_food<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(table_food))</span>
<span id="cb302-18"><a href="outputs.html#cb302-18" tabindex="-1"></a> </span>
<span id="cb302-19"><a href="outputs.html#cb302-19" tabindex="-1"></a><span class="co"># Get the name and the y position of each label</span></span>
<span id="cb302-20"><a href="outputs.html#cb302-20" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> table_food</span>
<span id="cb302-21"><a href="outputs.html#cb302-21" tabindex="-1"></a>number_of_bar <span class="ot">&lt;-</span> <span class="fu">nrow</span>(label_data)</span>
<span id="cb302-22"><a href="outputs.html#cb302-22" tabindex="-1"></a></span>
<span id="cb302-23"><a href="outputs.html#cb302-23" tabindex="-1"></a><span class="co"># Subtract 0.5 because the letter must have the angle of the center of the bars. Not extreme right(1) or extreme left (0)</span></span>
<span id="cb302-24"><a href="outputs.html#cb302-24" tabindex="-1"></a>angle <span class="ot">&lt;-</span> <span class="dv">90</span> <span class="sc">-</span> <span class="dv">360</span> <span class="sc">*</span> (label_data<span class="sc">$</span>id<span class="fl">-0.5</span>) <span class="sc">/</span> number_of_bar </span>
<span id="cb302-25"><a href="outputs.html#cb302-25" tabindex="-1"></a>label_data<span class="sc">$</span>hjust <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(angle <span class="ot">&lt;-</span> <span class="dv">85</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb302-26"><a href="outputs.html#cb302-26" tabindex="-1"></a>label_data<span class="sc">$</span>angle <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(angle <span class="ot">&lt;-</span> <span class="dv">85</span>, angle <span class="sc">+</span> <span class="dv">180</span>, angle)</span>
<span id="cb302-27"><a href="outputs.html#cb302-27" tabindex="-1"></a></span>
<span id="cb302-28"><a href="outputs.html#cb302-28" tabindex="-1"></a><span class="co"># prepare a data frame for base lines</span></span>
<span id="cb302-29"><a href="outputs.html#cb302-29" tabindex="-1"></a>base_data <span class="ot">&lt;-</span> table_food <span class="sc">%&gt;%</span> </span>
<span id="cb302-30"><a href="outputs.html#cb302-30" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb302-31"><a href="outputs.html#cb302-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">start=</span><span class="fu">min</span>(id), <span class="at">end=</span><span class="fu">max</span>(id) <span class="sc">-</span> empty_bar) <span class="sc">%&gt;%</span> </span>
<span id="cb302-32"><a href="outputs.html#cb302-32" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb302-33"><a href="outputs.html#cb302-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">title=</span><span class="fu">mean</span>(<span class="fu">c</span>(start, end)))</span>
<span id="cb302-34"><a href="outputs.html#cb302-34" tabindex="-1"></a> </span>
<span id="cb302-35"><a href="outputs.html#cb302-35" tabindex="-1"></a><span class="co"># prepare a data frame for grid (scales)</span></span>
<span id="cb302-36"><a href="outputs.html#cb302-36" tabindex="-1"></a>grid_data <span class="ot">&lt;-</span> base_data</span>
<span id="cb302-37"><a href="outputs.html#cb302-37" tabindex="-1"></a>grid_data<span class="sc">$</span>end <span class="ot">&lt;-</span> grid_data<span class="sc">$</span>end[ <span class="fu">c</span>( <span class="fu">nrow</span>(grid_data), <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(grid_data)<span class="sc">-</span><span class="dv">1</span>)] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb302-38"><a href="outputs.html#cb302-38" tabindex="-1"></a>grid_data<span class="sc">$</span>start <span class="ot">&lt;-</span> grid_data<span class="sc">$</span>start <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb302-39"><a href="outputs.html#cb302-39" tabindex="-1"></a>grid_data <span class="ot">&lt;-</span> grid_data[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb302-40"><a href="outputs.html#cb302-40" tabindex="-1"></a> </span>
<span id="cb302-41"><a href="outputs.html#cb302-41" tabindex="-1"></a><span class="co"># fixing grid data</span></span>
<span id="cb302-42"><a href="outputs.html#cb302-42" tabindex="-1"></a>grid_data<span class="sc">$</span>start <span class="ot">=</span> grid_data<span class="sc">$</span>start <span class="sc">-</span> <span class="fl">0.2</span></span>
<span id="cb302-43"><a href="outputs.html#cb302-43" tabindex="-1"></a>grid_data<span class="sc">$</span>end <span class="ot">=</span> grid_data<span class="sc">$</span>end <span class="sc">+</span> <span class="fl">0.2</span></span>
<span id="cb302-44"><a href="outputs.html#cb302-44" tabindex="-1"></a></span>
<span id="cb302-45"><a href="outputs.html#cb302-45" tabindex="-1"></a><span class="co">#label color - to put text within bars and placement of the label</span></span>
<span id="cb302-46"><a href="outputs.html#cb302-46" tabindex="-1"></a></span>
<span id="cb302-47"><a href="outputs.html#cb302-47" tabindex="-1"></a>label_data<span class="sc">$</span>lab_color <span class="ot">=</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb302-48"><a href="outputs.html#cb302-48" tabindex="-1"></a>label_data<span class="sc">$</span>lab_placement<span class="ot">=</span> table_food<span class="sc">$</span>value<span class="sc">-</span>(table_food<span class="sc">$</span>value<span class="dv">-1</span>)</span></code></pre></div>
<p>Picking the threshold for highlighting a bar in different color. Let’s put &lt;= 10% in red, 11% - 50% in grey an 51% - 100% in green</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="outputs.html#cb303-1" tabindex="-1"></a>table_food <span class="ot">&lt;-</span> table_food <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">highlight =</span> <span class="fu">case_when</span>(table_food<span class="sc">$</span>value <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">&quot;bad&quot;</span>,</span>
<span id="cb303-2"><a href="outputs.html#cb303-2" tabindex="-1"></a>                                                         table_food<span class="sc">$</span>value <span class="sc">&gt;=</span> <span class="dv">11</span> <span class="sc">&amp;</span> table_food<span class="sc">$</span>value <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">&quot;moderate&quot;</span>,</span>
<span id="cb303-3"><a href="outputs.html#cb303-3" tabindex="-1"></a>                                                         table_food<span class="sc">$</span>value <span class="sc">&gt;=</span> <span class="dv">51</span> <span class="sc">~</span> <span class="st">&quot;good&quot;</span>))</span>
<span id="cb303-4"><a href="outputs.html#cb303-4" tabindex="-1"></a>table_food<span class="sc">$</span>highlight <span class="ot">=</span> <span class="fu">as.factor</span>(table_food<span class="sc">$</span>highlight)</span></code></pre></div>
<div id="adding-thermometer-visual-elemant-if-needed" class="section level4 hasAnchor" number="8.3.8.1">
<h4><span class="header-section-number">8.3.8.1</span> Adding thermometer visual elemant (if needed)<a href="outputs.html#adding-thermometer-visual-elemant-if-needed" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="outputs.html#cb304-1" tabindex="-1"></a>cat_low <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">&quot;bad&quot;</span>, <span class="dv">10</span>)</span>
<span id="cb304-2"><a href="outputs.html#cb304-2" tabindex="-1"></a>cat_med <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">&quot;moderate&quot;</span>, <span class="dv">41</span>)</span>
<span id="cb304-3"><a href="outputs.html#cb304-3" tabindex="-1"></a>cat_high <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">&quot;good&quot;</span>, <span class="dv">49</span>)</span>
<span id="cb304-4"><a href="outputs.html#cb304-4" tabindex="-1"></a>thermometer <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">cat  =</span> <span class="fu">c</span>(cat_low, cat_med, cat_high),</span>
<span id="cb304-5"><a href="outputs.html#cb304-5" tabindex="-1"></a>                        <span class="at">number =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">100</span>)),</span>
<span id="cb304-6"><a href="outputs.html#cb304-6" tabindex="-1"></a>                        <span class="at">pos  =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">100</span>)))</span>
<span id="cb304-7"><a href="outputs.html#cb304-7" tabindex="-1"></a></span>
<span id="cb304-8"><a href="outputs.html#cb304-8" tabindex="-1"></a>thermometer<span class="sc">$</span>cat <span class="ot">=</span> <span class="fu">ordered</span>(thermometer<span class="sc">$</span>cat, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&quot;bad&quot;</span>, <span class="st">&quot;moderate&quot;</span>, <span class="st">&quot;good&quot;</span>))</span>
<span id="cb304-9"><a href="outputs.html#cb304-9" tabindex="-1"></a>ball <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">v =</span> <span class="dv">0</span>,</span>
<span id="cb304-10"><a href="outputs.html#cb304-10" tabindex="-1"></a>                  <span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb304-11"><a href="outputs.html#cb304-11" tabindex="-1"></a>                        </span>
<span id="cb304-12"><a href="outputs.html#cb304-12" tabindex="-1"></a><span class="fu">ggplot</span>(thermometer)<span class="sc">+</span></span>
<span id="cb304-13"><a href="outputs.html#cb304-13" tabindex="-1"></a><span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> pos, <span class="at">y =</span> number, <span class="at">fill =</span> cat), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">reverse =</span> T), <span class="at">width =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb304-14"><a href="outputs.html#cb304-14" tabindex="-1"></a><span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb304-15"><a href="outputs.html#cb304-15" tabindex="-1"></a><span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">105</span>)<span class="sc">+</span></span>
<span id="cb304-16"><a href="outputs.html#cb304-16" tabindex="-1"></a><span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&#39;bad&#39;</span>, <span class="st">&quot;moderate&quot;</span>, <span class="st">&quot;good&quot;</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;moderate&quot;</span> <span class="ot">=</span> <span class="st">&quot;dimgray&quot;</span>, <span class="st">&quot;good&quot;</span> <span class="ot">=</span> <span class="st">&quot;seagreen&quot;</span>, <span class="st">&quot;bad&quot;</span> <span class="ot">=</span> <span class="st">&quot;firebrick&quot;</span>))<span class="sc">+</span></span>
<span id="cb304-17"><a href="outputs.html#cb304-17" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> ball, <span class="fu">aes</span>(<span class="at">x =</span> h, <span class="at">y =</span> v<span class="dv">-5</span>), <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">size =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
</div>
<div id="creating-the-plot-itself" class="section level4 hasAnchor" number="8.3.8.2">
<h4><span class="header-section-number">8.3.8.2</span> Creating the plot itself<a href="outputs.html#creating-the-plot-itself" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="outputs.html#cb305-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(table_food, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(id), <span class="at">y=</span>value), <span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span>       </span>
<span id="cb305-2"><a href="outputs.html#cb305-2" tabindex="-1"></a>  <span class="co"># Note that id is a factor. If x is numeric, there is some space between the first bar</span></span>
<span id="cb305-3"><a href="outputs.html#cb305-3" tabindex="-1"></a>  <span class="co"># Placing base layer of bars</span></span>
<span id="cb305-4"><a href="outputs.html#cb305-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(id), <span class="at">y=</span>filler), <span class="at">fill=</span><span class="st">&quot;#E0E2E2&quot;</span>, <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">alpha=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb305-5"><a href="outputs.html#cb305-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(id), <span class="at">y=</span>value, <span class="at">fill=</span>highlight), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">alpha=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb305-6"><a href="outputs.html#cb305-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;moderate&quot;</span>, <span class="st">&#39;good&#39;</span>, <span class="st">&quot;bad&quot;</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;moderate&quot;</span> <span class="ot">=</span> <span class="st">&quot;#93A0A9&quot;</span>, <span class="st">&quot;good&quot;</span> <span class="ot">=</span> <span class="st">&quot;#A5C9A1&quot;</span>, <span class="st">&quot;bad&quot;</span> <span class="ot">=</span> <span class="st">&quot;#EE5859&quot;</span>)) <span class="sc">+</span></span>
<span id="cb305-7"><a href="outputs.html#cb305-7" tabindex="-1"></a>  <span class="co"># Add a val=100/75/50/25 lines. Do it at the beginning to make sure barplots are OVER it.</span></span>
<span id="cb305-8"><a href="outputs.html#cb305-8" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>grid_data, <span class="fu">aes</span>(<span class="at">x =</span> end, <span class="at">y =</span> <span class="dv">75</span>, <span class="at">xend =</span> start, <span class="at">yend =</span> <span class="dv">75</span>), <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">size=</span><span class="fl">0.3</span> , <span class="at">inherit.aes =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb305-9"><a href="outputs.html#cb305-9" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>grid_data, <span class="fu">aes</span>(<span class="at">x =</span> end, <span class="at">y =</span> <span class="dv">50</span>, <span class="at">xend =</span> start, <span class="at">yend =</span> <span class="dv">50</span>), <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">size=</span><span class="fl">0.3</span> , <span class="at">inherit.aes =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb305-10"><a href="outputs.html#cb305-10" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>grid_data, <span class="fu">aes</span>(<span class="at">x =</span> end, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">xend =</span> start, <span class="at">yend =</span> <span class="dv">25</span>), <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">size=</span><span class="fl">0.3</span> , <span class="at">inherit.aes =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb305-11"><a href="outputs.html#cb305-11" tabindex="-1"></a>  </span>
<span id="cb305-12"><a href="outputs.html#cb305-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">&quot;Arial&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-13"><a href="outputs.html#cb305-13" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb305-14"><a href="outputs.html#cb305-14" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb305-15"><a href="outputs.html#cb305-15" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb305-16"><a href="outputs.html#cb305-16" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb305-17"><a href="outputs.html#cb305-17" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb305-18"><a href="outputs.html#cb305-18" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb305-19"><a href="outputs.html#cb305-19" tabindex="-1"></a>  <span class="fu">coord_polar</span>() <span class="sc">+</span> </span>
<span id="cb305-20"><a href="outputs.html#cb305-20" tabindex="-1"></a>  </span>
<span id="cb305-21"><a href="outputs.html#cb305-21" tabindex="-1"></a>  <span class="co"># Add text showing the value of each 100/75/50/25 lines</span></span>
<span id="cb305-22"><a href="outputs.html#cb305-22" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">max</span>(table_food<span class="sc">$</span>id),<span class="dv">3</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>), <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;25%&quot;</span>, <span class="st">&quot;50%&quot;</span>, <span class="st">&quot;75%&quot;</span>) , <span class="at">color=</span><span class="st">&quot;grey&quot;</span>, <span class="at">size=</span><span class="dv">3</span> , <span class="at">angle=</span><span class="dv">0</span>, <span class="at">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="at">hjust=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb305-23"><a href="outputs.html#cb305-23" tabindex="-1"></a>  <span class="co"># Labels inside bars</span></span>
<span id="cb305-24"><a href="outputs.html#cb305-24" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>label_data, <span class="fu">aes</span>(<span class="at">x=</span>id, <span class="at">y=</span>lab_placement<span class="sc">+</span><span class="dv">50</span>, <span class="at">label=</span>individual, <span class="at">hjust=</span>hjust, ), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fontface=</span><span class="st">&quot;bold&quot;</span>,<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size=</span><span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">family =</span> <span class="st">&quot;Arial Narrow&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-25"><a href="outputs.html#cb305-25" tabindex="-1"></a>  <span class="co"># Value numbers at the beginning of each bar</span></span>
<span id="cb305-26"><a href="outputs.html#cb305-26" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>label_data, <span class="fu">aes</span>(<span class="at">x=</span>id, <span class="at">y=</span>lab_placement<span class="sc">+</span><span class="dv">75</span>, <span class="at">label=</span>value, <span class="at">hjust=</span>hjust, ), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fontface=</span><span class="st">&quot;bold&quot;</span>,<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size=</span><span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">family =</span> <span class="st">&quot;Arial Narrow&quot;</span>)<span class="sc">+</span></span>
<span id="cb305-27"><a href="outputs.html#cb305-27" tabindex="-1"></a>  <span class="co"># labels of groups</span></span>
<span id="cb305-28"><a href="outputs.html#cb305-28" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>base_data, <span class="fu">aes</span>(<span class="at">x =</span> title, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label=</span>group), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2
## 3.4.0.
## ℹ Please use `linewidth` instead.</code></pre>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="outputs.html#cb307-1" tabindex="-1"></a>p</span></code></pre></div>
<pre><code>## Warning: Removed 22 rows containing missing values
## (`position_stack()`).</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values
## (`position_stack()`).</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values (`geom_text()`).
## Removed 22 rows containing missing values (`geom_text()`).</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
</div>
<div id="adding-a-text-in-the-center-of-the-plot" class="section level4 hasAnchor" number="8.3.8.3">
<h4><span class="header-section-number">8.3.8.3</span> Adding a text in the center of the plot<a href="outputs.html#adding-a-text-in-the-center-of-the-plot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="outputs.html#cb312-1" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="fu">aes</span>(<span class="at">y =</span> <span class="sc">-</span><span class="dv">65</span>, <span class="at">label =</span> <span class="st">&quot;7 days / week&quot;</span>), <span class="at">size =</span> <span class="fl">4.5</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Arial Narrow&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray28&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 22 rows containing missing values
## (`position_stack()`).
## Removed 22 rows containing missing values
## (`position_stack()`).</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values (`geom_text()`).
## Removed 22 rows containing missing values (`geom_text()`).</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-168-1.png" width="672" /></p>
</div>
<div id="adding-a-thermometer-object-to-the-plot" class="section level4 hasAnchor" number="8.3.8.4">
<h4><span class="header-section-number">8.3.8.4</span> Adding a thermometer object to the plot<a href="outputs.html#adding-a-thermometer-object-to-the-plot" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="outputs.html#cb316-1" tabindex="-1"></a>p <span class="sc">+</span>  <span class="fu">geom_col</span>(<span class="at">data =</span> thermometer, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">43.5</span>, <span class="at">y =</span> number, <span class="at">fill =</span> cat), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">reverse =</span> T), <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">angle =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb316-2"><a href="outputs.html#cb316-2" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> ball, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">43.5</span>, <span class="at">y =</span> v<span class="dv">-2</span>), <span class="at">color =</span> <span class="st">&quot;#EE5859&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb316-3"><a href="outputs.html#cb316-3" tabindex="-1"></a><span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">42.8</span>, <span class="at">y =</span> <span class="dv">5</span>, <span class="at">label =</span> <span class="st">&quot;Freq. of consumption&quot;</span>), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fontface=</span><span class="st">&quot;bold&quot;</span>,<span class="at">alpha=</span><span class="fl">0.6</span>, <span class="at">size=</span><span class="fl">2.3</span>, <span class="at">angle=</span> <span class="dv">100</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Arial Narrow&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in geom_col(data = thermometer, aes(x = 43.5, y = number, fill = cat), :
## Ignoring unknown parameters: `angle`</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values
## (`position_stack()`).
## Removed 22 rows containing missing values
## (`position_stack()`).</code></pre>
<pre><code>## Warning: Removed 22 rows containing missing values (`geom_text()`).
## Removed 22 rows containing missing values (`geom_text()`).</code></pre>
<pre><code>## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database

## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
## font family not found in Windows font database</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-169-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="labels" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Labels<a href="outputs.html#labels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="xml-to-label" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Xml to Label<a href="outputs.html#xml-to-label" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following code transform column headers, select_one and select_multiple values from XML to Label.</p>
<p>Loading Libraries</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="outputs.html#cb321-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Dataset column headers function</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="outputs.html#cb322-1" tabindex="-1"></a>xml2label_question <span class="ot">&lt;-</span> <span class="cf">function</span>(tool_survey, tool_choices, col){</span>
<span id="cb322-2"><a href="outputs.html#cb322-2" tabindex="-1"></a>  <span class="co"># for each column check if it is a select multiple</span></span>
<span id="cb322-3"><a href="outputs.html#cb322-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(col, <span class="st">&quot;/&quot;</span>)) {</span>
<span id="cb322-4"><a href="outputs.html#cb322-4" tabindex="-1"></a>    q.name <span class="ot">&lt;-</span> <span class="fu">str_split</span>(col, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb322-5"><a href="outputs.html#cb322-5" tabindex="-1"></a>    c.name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tail</span>(<span class="fu">str_split</span>(col, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]], <span class="sc">-</span><span class="dv">1</span>), <span class="at">collapse=</span><span class="st">&quot;/&quot;</span>)</span>
<span id="cb322-6"><a href="outputs.html#cb322-6" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb322-7"><a href="outputs.html#cb322-7" tabindex="-1"></a>    q.name <span class="ot">&lt;-</span> col</span>
<span id="cb322-8"><a href="outputs.html#cb322-8" tabindex="-1"></a>    c.name <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb322-9"><a href="outputs.html#cb322-9" tabindex="-1"></a>  }</span>
<span id="cb322-10"><a href="outputs.html#cb322-10" tabindex="-1"></a>  </span>
<span id="cb322-11"><a href="outputs.html#cb322-11" tabindex="-1"></a>  <span class="co"># returning the label and make sure to include the label of multiple choices after /</span></span>
<span id="cb322-12"><a href="outputs.html#cb322-12" tabindex="-1"></a>  <span class="cf">if</span> (q.name <span class="sc">%in%</span> tool_survey<span class="sc">$</span>name){</span>
<span id="cb322-13"><a href="outputs.html#cb322-13" tabindex="-1"></a>    q <span class="ot">&lt;-</span> tool_survey[tool_survey<span class="sc">$</span>name<span class="sc">==</span>q.name,]</span>
<span id="cb322-14"><a href="outputs.html#cb322-14" tabindex="-1"></a>    q.label <span class="ot">&lt;-</span> q<span class="sc">$</span><span class="st">`</span><span class="at">label::english</span><span class="st">`</span></span>
<span id="cb322-15"><a href="outputs.html#cb322-15" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(q.label) <span class="sc">|</span> q<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;note&quot;</span>)) q.label <span class="ot">&lt;-</span> q.name</span>
<span id="cb322-16"><a href="outputs.html#cb322-16" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(c.name)){</span>
<span id="cb322-17"><a href="outputs.html#cb322-17" tabindex="-1"></a>      q.list_name<span class="ot">=</span><span class="fu">ifelse</span>(q<span class="sc">$</span>list_name<span class="sc">==</span><span class="st">&quot;NA&quot;</span>, <span class="cn">NA</span>, q<span class="sc">$</span>list_name)</span>
<span id="cb322-18"><a href="outputs.html#cb322-18" tabindex="-1"></a>      c.label <span class="ot">&lt;-</span> tool_choices[tool_choices<span class="sc">$</span>list_name<span class="sc">==</span>q.list_name <span class="sc">&amp;</span> tool_choices<span class="sc">$</span>name<span class="sc">==</span>c.name, <span class="st">&quot;label::english&quot;</span>]</span>
<span id="cb322-19"><a href="outputs.html#cb322-19" tabindex="-1"></a>    } <span class="cf">else</span> c.label <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb322-20"><a href="outputs.html#cb322-20" tabindex="-1"></a>    label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(c.label), q.label, <span class="fu">paste0</span>(q.label, <span class="st">&quot;/&quot;</span>, c.label))</span>
<span id="cb322-21"><a href="outputs.html#cb322-21" tabindex="-1"></a>  } <span class="cf">else</span> label <span class="ot">&lt;-</span> q.name</span>
<span id="cb322-22"><a href="outputs.html#cb322-22" tabindex="-1"></a>  <span class="fu">return</span>(label)</span>
<span id="cb322-23"><a href="outputs.html#cb322-23" tabindex="-1"></a>}</span></code></pre></div>
<p>Select_one values function</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="outputs.html#cb323-1" tabindex="-1"></a>xml2label_choices_one <span class="ot">&lt;-</span> <span class="cf">function</span>(tool_survey, tool_choices, data, col) {</span>
<span id="cb323-2"><a href="outputs.html#cb323-2" tabindex="-1"></a>  <span class="co"># select the type column from each select_one question</span></span>
<span id="cb323-3"><a href="outputs.html#cb323-3" tabindex="-1"></a>  q.type <span class="ot">&lt;-</span> tool_survey<span class="sc">$</span>type[tool_survey<span class="sc">$</span>name<span class="sc">==</span>col]</span>
<span id="cb323-4"><a href="outputs.html#cb323-4" tabindex="-1"></a>  </span>
<span id="cb323-5"><a href="outputs.html#cb323-5" tabindex="-1"></a>  <span class="co"># take the id of the choices to get the list name</span></span>
<span id="cb323-6"><a href="outputs.html#cb323-6" tabindex="-1"></a>  q.list_name <span class="ot">&lt;-</span> <span class="fu">str_split</span>(q.type, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb323-7"><a href="outputs.html#cb323-7" tabindex="-1"></a>  </span>
<span id="cb323-8"><a href="outputs.html#cb323-8" tabindex="-1"></a>  <span class="co"># export the choices relevant to each select_one question</span></span>
<span id="cb323-9"><a href="outputs.html#cb323-9" tabindex="-1"></a>  choices <span class="ot">&lt;-</span> tool_choices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(list_name <span class="sc">==</span> q.list_name) <span class="sc">%&gt;%</span> </span>
<span id="cb323-10"><a href="outputs.html#cb323-10" tabindex="-1"></a>      <span class="fu">select</span>(name, <span class="st">`</span><span class="at">label::english</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label=</span><span class="st">`</span><span class="at">label::english</span><span class="st">`</span>)</span>
<span id="cb323-11"><a href="outputs.html#cb323-11" tabindex="-1"></a>  </span>
<span id="cb323-12"><a href="outputs.html#cb323-12" tabindex="-1"></a>  <span class="co"># replace the xml with label using left_join</span></span>
<span id="cb323-13"><a href="outputs.html#cb323-13" tabindex="-1"></a>  d.join <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">col=</span><span class="fu">as.character</span>(data[[col]])) <span class="sc">%&gt;%</span> </span>
<span id="cb323-14"><a href="outputs.html#cb323-14" tabindex="-1"></a>    <span class="fu">left_join</span>(choices, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;col&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(label)</span>
<span id="cb323-15"><a href="outputs.html#cb323-15" tabindex="-1"></a>  </span>
<span id="cb323-16"><a href="outputs.html#cb323-16" tabindex="-1"></a>  <span class="co"># return only the new label column and replace it in the for loop using vectors </span></span>
<span id="cb323-17"><a href="outputs.html#cb323-17" tabindex="-1"></a>  <span class="fu">return</span>(d.join<span class="sc">$</span>label)</span>
<span id="cb323-18"><a href="outputs.html#cb323-18" tabindex="-1"></a>}</span></code></pre></div>
<p>Select_multiple values function</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="outputs.html#cb324-1" tabindex="-1"></a>xml2label_choices_multiple <span class="ot">&lt;-</span> <span class="cf">function</span>(tool_survey, tool_choices, data, col) {</span>
<span id="cb324-2"><a href="outputs.html#cb324-2" tabindex="-1"></a>  <span class="co"># select all the columns with all the options for each select_multiple</span></span>
<span id="cb324-3"><a href="outputs.html#cb324-3" tabindex="-1"></a>  d.join <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb324-4"><a href="outputs.html#cb324-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">contains</span>(<span class="fu">paste0</span>(col,<span class="st">&quot;/&quot;</span>)))</span>
<span id="cb324-5"><a href="outputs.html#cb324-5" tabindex="-1"></a>  col_internal <span class="ot">&lt;-</span> <span class="fu">colnames</span>(d.join)</span>
<span id="cb324-6"><a href="outputs.html#cb324-6" tabindex="-1"></a>  </span>
<span id="cb324-7"><a href="outputs.html#cb324-7" tabindex="-1"></a>  <span class="co"># for each column with options</span></span>
<span id="cb324-8"><a href="outputs.html#cb324-8" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_internal)){</span>
<span id="cb324-9"><a href="outputs.html#cb324-9" tabindex="-1"></a>    <span class="co"># change all 1&#39;s to the xml answer</span></span>
<span id="cb324-10"><a href="outputs.html#cb324-10" tabindex="-1"></a>    xml_answer <span class="ot">&lt;-</span> <span class="fu">str_split</span>(col_internal[j], <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb324-11"><a href="outputs.html#cb324-11" tabindex="-1"></a>    d.join <span class="ot">&lt;-</span> d.join <span class="sc">%&gt;%</span> </span>
<span id="cb324-12"><a href="outputs.html#cb324-12" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(col_internal[j]) <span class="sc">:=</span> <span class="fu">ifelse</span>(<span class="sc">!!</span><span class="fu">sym</span>(col_internal[j]) <span class="sc">==</span> <span class="st">&quot;1&quot;</span>, xml_answer, <span class="cn">NA</span>))</span>
<span id="cb324-13"><a href="outputs.html#cb324-13" tabindex="-1"></a>    </span>
<span id="cb324-14"><a href="outputs.html#cb324-14" tabindex="-1"></a>    <span class="co"># get the list of the xml and label options for each select multiple questions</span></span>
<span id="cb324-15"><a href="outputs.html#cb324-15" tabindex="-1"></a>    choice_id <span class="ot">&lt;-</span> <span class="fu">filter</span>(tool_survey, <span class="fu">str_starts</span>(name, <span class="fu">str_split</span>(col_internal[j],<span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb324-16"><a href="outputs.html#cb324-16" tabindex="-1"></a>      <span class="fu">select</span>(list_name)</span>
<span id="cb324-17"><a href="outputs.html#cb324-17" tabindex="-1"></a>    choice_id <span class="ot">&lt;-</span> choice_id<span class="sc">$</span>list_name</span>
<span id="cb324-18"><a href="outputs.html#cb324-18" tabindex="-1"></a>    t.choices <span class="ot">&lt;-</span> tool_choices <span class="sc">%&gt;%</span> </span>
<span id="cb324-19"><a href="outputs.html#cb324-19" tabindex="-1"></a>      <span class="fu">filter</span>(list_name <span class="sc">==</span> choice_id) <span class="sc">%&gt;%</span> </span>
<span id="cb324-20"><a href="outputs.html#cb324-20" tabindex="-1"></a>      <span class="fu">select</span>(name, <span class="st">`</span><span class="at">label::english</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label =</span> <span class="st">`</span><span class="at">label::english</span><span class="st">`</span>)</span>
<span id="cb324-21"><a href="outputs.html#cb324-21" tabindex="-1"></a>    </span>
<span id="cb324-22"><a href="outputs.html#cb324-22" tabindex="-1"></a>    <span class="co"># replace the xml with label using left_join</span></span>
<span id="cb324-23"><a href="outputs.html#cb324-23" tabindex="-1"></a>    d.new.join <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">col=</span><span class="fu">as.character</span>(d.join[[col_internal[j]]])) <span class="sc">%&gt;%</span></span>
<span id="cb324-24"><a href="outputs.html#cb324-24" tabindex="-1"></a>      <span class="fu">left_join</span>(t.choices, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;col&quot;</span><span class="ot">=</span><span class="st">&quot;name&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(label)</span>
<span id="cb324-25"><a href="outputs.html#cb324-25" tabindex="-1"></a>    d.join[col_internal[j]] <span class="ot">&lt;-</span> d.new.join<span class="sc">$</span>label</span>
<span id="cb324-26"><a href="outputs.html#cb324-26" tabindex="-1"></a>  }</span>
<span id="cb324-27"><a href="outputs.html#cb324-27" tabindex="-1"></a>  </span>
<span id="cb324-28"><a href="outputs.html#cb324-28" tabindex="-1"></a>  <span class="co"># concatenate all the answers, removing NAs in one cell and separated by a &#39;;&#39; </span></span>
<span id="cb324-29"><a href="outputs.html#cb324-29" tabindex="-1"></a>  d.join <span class="ot">&lt;-</span> d.join <span class="sc">%&gt;%</span> </span>
<span id="cb324-30"><a href="outputs.html#cb324-30" tabindex="-1"></a>    <span class="fu">unite</span>(<span class="st">&quot;Merged&quot;</span>, <span class="fu">everything</span>(), <span class="at">sep=</span> <span class="st">&quot;;&quot;</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb324-31"><a href="outputs.html#cb324-31" tabindex="-1"></a>  </span>
<span id="cb324-32"><a href="outputs.html#cb324-32" tabindex="-1"></a>  <span class="co"># return only the new label column and replace it in the for loop using vectors</span></span>
<span id="cb324-33"><a href="outputs.html#cb324-33" tabindex="-1"></a>  <span class="fu">return</span>(d.join<span class="sc">$</span>Merged)</span>
<span id="cb324-34"><a href="outputs.html#cb324-34" tabindex="-1"></a>}</span></code></pre></div>
<p>Example</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="outputs.html#cb325-1" tabindex="-1"></a>filename_tool <span class="ot">&lt;-</span> <span class="st">&quot;enter your tool link here&quot;</span></span>
<span id="cb325-2"><a href="outputs.html#cb325-2" tabindex="-1"></a>filename_cleaned_data <span class="ot">&lt;-</span> <span class="st">&quot;enter your data hear&quot;</span></span>
<span id="cb325-3"><a href="outputs.html#cb325-3" tabindex="-1"></a></span>
<span id="cb325-4"><a href="outputs.html#cb325-4" tabindex="-1"></a><span class="co"># loading tool</span></span>
<span id="cb325-5"><a href="outputs.html#cb325-5" tabindex="-1"></a>tool_survey <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename_tool, <span class="at">sheet =</span> <span class="st">&quot;survey&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-6"><a href="outputs.html#cb325-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-7"><a href="outputs.html#cb325-7" tabindex="-1"></a>  <span class="co"># adding two columns showing the question type and the id of the list_name choices separately</span></span>
<span id="cb325-8"><a href="outputs.html#cb325-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q.type =</span> <span class="fu">as.character</span>(<span class="fu">lapply</span>(type, <span class="cf">function</span>(x) <span class="fu">str_split</span>(x, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])),</span>
<span id="cb325-9"><a href="outputs.html#cb325-9" tabindex="-1"></a>         <span class="at">list_name =</span> <span class="fu">as.character</span>(<span class="fu">lapply</span>(type, <span class="cf">function</span>(x) <span class="fu">str_split</span>(x, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])))</span>
<span id="cb325-10"><a href="outputs.html#cb325-10" tabindex="-1"></a></span>
<span id="cb325-11"><a href="outputs.html#cb325-11" tabindex="-1"></a>tool_choices <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename_tool, <span class="at">sheet =</span> <span class="st">&quot;choices&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-12"><a href="outputs.html#cb325-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(list_name))</span>
<span id="cb325-13"><a href="outputs.html#cb325-13" tabindex="-1"></a></span>
<span id="cb325-14"><a href="outputs.html#cb325-14" tabindex="-1"></a></span>
<span id="cb325-15"><a href="outputs.html#cb325-15" tabindex="-1"></a><span class="co"># loading the data</span></span>
<span id="cb325-16"><a href="outputs.html#cb325-16" tabindex="-1"></a>main_dataset <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename_cleaned_data, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="cb325-17"><a href="outputs.html#cb325-17" tabindex="-1"></a></span>
<span id="cb325-18"><a href="outputs.html#cb325-18" tabindex="-1"></a><span class="co"># creating another data frame with changes</span></span>
<span id="cb325-19"><a href="outputs.html#cb325-19" tabindex="-1"></a></span>
<span id="cb325-20"><a href="outputs.html#cb325-20" tabindex="-1"></a>data_labeled <span class="ot">&lt;-</span> main_dataset</span>
<span id="cb325-21"><a href="outputs.html#cb325-21" tabindex="-1"></a></span>
<span id="cb325-22"><a href="outputs.html#cb325-22" tabindex="-1"></a><span class="co"># select_one values - XML to Label</span></span>
<span id="cb325-23"><a href="outputs.html#cb325-23" tabindex="-1"></a></span>
<span id="cb325-24"><a href="outputs.html#cb325-24" tabindex="-1"></a>tool_select_one <span class="ot">&lt;-</span> tool_survey <span class="sc">%&gt;%</span> </span>
<span id="cb325-25"><a href="outputs.html#cb325-25" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(type, <span class="st">&quot;select_one &quot;</span>))</span>
<span id="cb325-26"><a href="outputs.html#cb325-26" tabindex="-1"></a></span>
<span id="cb325-27"><a href="outputs.html#cb325-27" tabindex="-1"></a>col_select_one <span class="ot">&lt;-</span> tool_select_one<span class="sc">$</span>name</span>
<span id="cb325-28"><a href="outputs.html#cb325-28" tabindex="-1"></a></span>
<span id="cb325-29"><a href="outputs.html#cb325-29" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_select_one)){</span>
<span id="cb325-30"><a href="outputs.html#cb325-30" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(data_labeled[[col_select_one[i]]])){</span>
<span id="cb325-31"><a href="outputs.html#cb325-31" tabindex="-1"></a>    data_labeled[[col_select_one[i]]] <span class="ot">&lt;-</span> <span class="fu">xml2label_choices_one</span>(tool_survey,tool_choices,main_dataset,col_select_one[i])</span>
<span id="cb325-32"><a href="outputs.html#cb325-32" tabindex="-1"></a>  }</span>
<span id="cb325-33"><a href="outputs.html#cb325-33" tabindex="-1"></a>}</span>
<span id="cb325-34"><a href="outputs.html#cb325-34" tabindex="-1"></a></span>
<span id="cb325-35"><a href="outputs.html#cb325-35" tabindex="-1"></a><span class="co"># select_multiple values - XML to Label</span></span>
<span id="cb325-36"><a href="outputs.html#cb325-36" tabindex="-1"></a></span>
<span id="cb325-37"><a href="outputs.html#cb325-37" tabindex="-1"></a>tool_select_multi <span class="ot">&lt;-</span> tool_survey <span class="sc">%&gt;%</span> </span>
<span id="cb325-38"><a href="outputs.html#cb325-38" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(type, <span class="st">&quot;select_multiple &quot;</span>))</span>
<span id="cb325-39"><a href="outputs.html#cb325-39" tabindex="-1"></a>col_select_multi <span class="ot">&lt;-</span> tool_select_multi<span class="sc">$</span>name</span>
<span id="cb325-40"><a href="outputs.html#cb325-40" tabindex="-1"></a></span>
<span id="cb325-41"><a href="outputs.html#cb325-41" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_select_multi)){</span>
<span id="cb325-42"><a href="outputs.html#cb325-42" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(data_labeled[[col_select_multi[i]]])){</span>
<span id="cb325-43"><a href="outputs.html#cb325-43" tabindex="-1"></a>    data_labeled[[col_select_multi[i]]] <span class="ot">&lt;-</span> <span class="fu">xml2label_choices_multiple</span>(tool_survey,tool_choices,main_dataset,col_select_multi[i])</span>
<span id="cb325-44"><a href="outputs.html#cb325-44" tabindex="-1"></a>  }</span>
<span id="cb325-45"><a href="outputs.html#cb325-45" tabindex="-1"></a>}</span>
<span id="cb325-46"><a href="outputs.html#cb325-46" tabindex="-1"></a></span>
<span id="cb325-47"><a href="outputs.html#cb325-47" tabindex="-1"></a><span class="co"># Column headers - XML to Label</span></span>
<span id="cb325-48"><a href="outputs.html#cb325-48" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(main_dataset)</span>
<span id="cb325-49"><a href="outputs.html#cb325-49" tabindex="-1"></a></span>
<span id="cb325-50"><a href="outputs.html#cb325-50" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_names)) {</span>
<span id="cb325-51"><a href="outputs.html#cb325-51" tabindex="-1"></a>  <span class="fu">colnames</span>(data_labeled)[i] <span class="ot">&lt;-</span> <span class="fu">xml2label_question</span>(tool_survey, tool_choices, col_names[i])</span>
<span id="cb325-52"><a href="outputs.html#cb325-52" tabindex="-1"></a>  </span>
<span id="cb325-53"><a href="outputs.html#cb325-53" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="change-from-label-to-xml" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> change from label to xml<a href="outputs.html#change-from-label-to-xml" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following code transform column headers, select_one and select_multiple values from Label to XML.</p>
<p>Conditions required for the code to function correctly:
1- The “label::English” column in KOBO Tool must contain unique values.
2- The labeled data should be saved in the Excel file format.
3- When selecting options for select_multiple questions, ensure to determine if the options are separated by a forward slash (“/”) or (“.”).</p>
<p>Loading Libraries</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="outputs.html#cb326-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb326-2"><a href="outputs.html#cb326-2" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code></pre></div>
<p>Dataset column headers function</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="outputs.html#cb327-1" tabindex="-1"></a>label2xml_question <span class="ot">&lt;-</span> <span class="cf">function</span>(tool_survey, tool_choices, <span class="at">label_colname =</span> <span class="st">&quot;label::English&quot;</span>, col, <span class="at">sm_separator =</span> <span class="st">&quot;/&quot;</span>){</span>
<span id="cb327-2"><a href="outputs.html#cb327-2" tabindex="-1"></a>  </span>
<span id="cb327-3"><a href="outputs.html#cb327-3" tabindex="-1"></a>  <span class="co"># for each column check if it is a select multiple</span></span>
<span id="cb327-4"><a href="outputs.html#cb327-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(col, sm_separator)) {</span>
<span id="cb327-5"><a href="outputs.html#cb327-5" tabindex="-1"></a>    q.label <span class="ot">&lt;-</span> <span class="fu">str_split</span>(col, sm_separator)[[<span class="dv">1</span>]][<span class="dv">1</span>]</span>
<span id="cb327-6"><a href="outputs.html#cb327-6" tabindex="-1"></a>    c.label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tail</span>(<span class="fu">str_split</span>(col, sm_separator)[[<span class="dv">1</span>]], <span class="sc">-</span><span class="dv">1</span>), <span class="at">collapse=</span>sm_separator)</span>
<span id="cb327-7"><a href="outputs.html#cb327-7" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb327-8"><a href="outputs.html#cb327-8" tabindex="-1"></a>    q.label <span class="ot">&lt;-</span> col</span>
<span id="cb327-9"><a href="outputs.html#cb327-9" tabindex="-1"></a>    c.label <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb327-10"><a href="outputs.html#cb327-10" tabindex="-1"></a>  }</span>
<span id="cb327-11"><a href="outputs.html#cb327-11" tabindex="-1"></a>  </span>
<span id="cb327-12"><a href="outputs.html#cb327-12" tabindex="-1"></a>  <span class="co"># returning the xml and make sure to include the xml of multiple choices after sm_separator</span></span>
<span id="cb327-13"><a href="outputs.html#cb327-13" tabindex="-1"></a>  <span class="cf">if</span> (q.label <span class="sc">%in%</span> tool_survey[[label_colname]]){</span>
<span id="cb327-14"><a href="outputs.html#cb327-14" tabindex="-1"></a>    q <span class="ot">&lt;-</span> tool_survey[tool_survey[[label_colname]] <span class="sc">%in%</span> q.label, ]</span>
<span id="cb327-15"><a href="outputs.html#cb327-15" tabindex="-1"></a>    q.name <span class="ot">&lt;-</span> q<span class="sc">$</span>name</span>
<span id="cb327-16"><a href="outputs.html#cb327-16" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(q.name) <span class="sc">|</span> q<span class="sc">$</span>type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;note&quot;</span>)) q.name <span class="ot">&lt;-</span> q.label</span>
<span id="cb327-17"><a href="outputs.html#cb327-17" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(c.label)){</span>
<span id="cb327-18"><a href="outputs.html#cb327-18" tabindex="-1"></a>      q.list_name <span class="ot">=</span> <span class="fu">ifelse</span>(q<span class="sc">$</span>list_name <span class="sc">==</span> <span class="st">&quot;NA&quot;</span>, <span class="cn">NA</span>, q<span class="sc">$</span>list_name)</span>
<span id="cb327-19"><a href="outputs.html#cb327-19" tabindex="-1"></a>      c.name <span class="ot">&lt;-</span> tool_choices[tool_choices<span class="sc">$</span>list_name <span class="sc">%in%</span> q.list_name <span class="sc">&amp;</span> tool_choices[[label_colname]]<span class="sc">%in%</span> c.label, <span class="st">&quot;name&quot;</span>]</span>
<span id="cb327-20"><a href="outputs.html#cb327-20" tabindex="-1"></a>    } <span class="cf">else</span> c.name <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb327-21"><a href="outputs.html#cb327-21" tabindex="-1"></a>    name <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(c.name), q.name, <span class="fu">paste0</span>(q.name, sm_separator, c.name))</span>
<span id="cb327-22"><a href="outputs.html#cb327-22" tabindex="-1"></a>  } <span class="cf">else</span> name <span class="ot">&lt;-</span> q.label</span>
<span id="cb327-23"><a href="outputs.html#cb327-23" tabindex="-1"></a>  <span class="fu">return</span>(name)</span>
<span id="cb327-24"><a href="outputs.html#cb327-24" tabindex="-1"></a>}</span></code></pre></div>
<p>Select_one values function</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="outputs.html#cb328-1" tabindex="-1"></a>label2xml_choices_one <span class="ot">&lt;-</span> <span class="cf">function</span>(tool_survey, tool_choices, <span class="at">label_colname =</span> <span class="st">&quot;label::English&quot;</span>, data, col) {</span>
<span id="cb328-2"><a href="outputs.html#cb328-2" tabindex="-1"></a>  </span>
<span id="cb328-3"><a href="outputs.html#cb328-3" tabindex="-1"></a>  <span class="co"># select the type column from each select_one question</span></span>
<span id="cb328-4"><a href="outputs.html#cb328-4" tabindex="-1"></a>  q.type <span class="ot">&lt;-</span> tool_survey<span class="sc">$</span>type[tool_survey[[label_colname]] <span class="sc">%in%</span> col]</span>
<span id="cb328-5"><a href="outputs.html#cb328-5" tabindex="-1"></a>  </span>
<span id="cb328-6"><a href="outputs.html#cb328-6" tabindex="-1"></a>  <span class="co"># take the id of the choices to get the list name</span></span>
<span id="cb328-7"><a href="outputs.html#cb328-7" tabindex="-1"></a>  q.list_name <span class="ot">&lt;-</span> <span class="fu">str_split</span>(q.type, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb328-8"><a href="outputs.html#cb328-8" tabindex="-1"></a>  </span>
<span id="cb328-9"><a href="outputs.html#cb328-9" tabindex="-1"></a>  <span class="co"># export the choices relevant to each select_one question</span></span>
<span id="cb328-10"><a href="outputs.html#cb328-10" tabindex="-1"></a>  choices <span class="ot">&lt;-</span> tool_choices <span class="sc">%&gt;%</span> <span class="fu">filter</span>(list_name <span class="sc">==</span> q.list_name) <span class="sc">%&gt;%</span> </span>
<span id="cb328-11"><a href="outputs.html#cb328-11" tabindex="-1"></a>    <span class="fu">select</span>(name, <span class="sc">!!</span><span class="fu">sym</span>(label_colname)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label=</span>label_colname)</span>
<span id="cb328-12"><a href="outputs.html#cb328-12" tabindex="-1"></a>  </span>
<span id="cb328-13"><a href="outputs.html#cb328-13" tabindex="-1"></a>  <span class="co"># replace the label with xml using left_join</span></span>
<span id="cb328-14"><a href="outputs.html#cb328-14" tabindex="-1"></a>  d.join <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">col =</span> <span class="fu">as.character</span>(data[[col]])) <span class="sc">%&gt;%</span> </span>
<span id="cb328-15"><a href="outputs.html#cb328-15" tabindex="-1"></a>    <span class="fu">left_join</span>(choices, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;col&quot;</span><span class="ot">=</span><span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(name)</span>
<span id="cb328-16"><a href="outputs.html#cb328-16" tabindex="-1"></a>  </span>
<span id="cb328-17"><a href="outputs.html#cb328-17" tabindex="-1"></a>  <span class="co"># return only the new name column and replace it in the for loop using vectors </span></span>
<span id="cb328-18"><a href="outputs.html#cb328-18" tabindex="-1"></a>  <span class="fu">return</span>(d.join<span class="sc">$</span>name)</span>
<span id="cb328-19"><a href="outputs.html#cb328-19" tabindex="-1"></a>}</span></code></pre></div>
<p>Select_multiple values function</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="outputs.html#cb329-1" tabindex="-1"></a>label2xml_choices_multiple <span class="ot">&lt;-</span> <span class="cf">function</span>(tool_survey, tool_choices, data, <span class="at">label_colname =</span> <span class="st">&quot;label::English&quot;</span>, col, <span class="at">sm_separator =</span> <span class="st">&quot;/&quot;</span>) {</span>
<span id="cb329-2"><a href="outputs.html#cb329-2" tabindex="-1"></a>  </span>
<span id="cb329-3"><a href="outputs.html#cb329-3" tabindex="-1"></a>  <span class="co"># select all the columns with all the options for each select_multiple</span></span>
<span id="cb329-4"><a href="outputs.html#cb329-4" tabindex="-1"></a>  d.join <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb329-5"><a href="outputs.html#cb329-5" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">contains</span>(<span class="fu">paste0</span>(col, sm_separator)))</span>
<span id="cb329-6"><a href="outputs.html#cb329-6" tabindex="-1"></a>  col_internal <span class="ot">&lt;-</span> <span class="fu">colnames</span>(d.join)</span>
<span id="cb329-7"><a href="outputs.html#cb329-7" tabindex="-1"></a>  </span>
<span id="cb329-8"><a href="outputs.html#cb329-8" tabindex="-1"></a>  <span class="co"># for each column with options</span></span>
<span id="cb329-9"><a href="outputs.html#cb329-9" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_internal)){</span>
<span id="cb329-10"><a href="outputs.html#cb329-10" tabindex="-1"></a>    </span>
<span id="cb329-11"><a href="outputs.html#cb329-11" tabindex="-1"></a>    <span class="co"># change all 1&#39;s to the label answer</span></span>
<span id="cb329-12"><a href="outputs.html#cb329-12" tabindex="-1"></a>    label_answer <span class="ot">&lt;-</span> <span class="fu">str_split</span>(col_internal[j], sm_separator)[[<span class="dv">1</span>]][<span class="dv">2</span>]</span>
<span id="cb329-13"><a href="outputs.html#cb329-13" tabindex="-1"></a>    d.join <span class="ot">&lt;-</span> d.join <span class="sc">%&gt;%</span> </span>
<span id="cb329-14"><a href="outputs.html#cb329-14" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(col_internal[j]) <span class="sc">:=</span> <span class="fu">ifelse</span>(<span class="sc">!!</span><span class="fu">sym</span>(col_internal[j]) <span class="sc">==</span> <span class="st">&quot;1&quot;</span>, label_answer, <span class="cn">NA</span>))</span>
<span id="cb329-15"><a href="outputs.html#cb329-15" tabindex="-1"></a>    </span>
<span id="cb329-16"><a href="outputs.html#cb329-16" tabindex="-1"></a>    <span class="co"># get the list of the label and xml options for each select multiple questions</span></span>
<span id="cb329-17"><a href="outputs.html#cb329-17" tabindex="-1"></a>    choice_id <span class="ot">&lt;-</span> tool_survey <span class="sc">%&gt;%</span></span>
<span id="cb329-18"><a href="outputs.html#cb329-18" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(label_colname) <span class="sc">%in%</span> <span class="fu">str_split</span>(col_internal[j], sm_separator)[[<span class="dv">1</span>]][<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb329-19"><a href="outputs.html#cb329-19" tabindex="-1"></a>      <span class="fu">select</span>(list_name)</span>
<span id="cb329-20"><a href="outputs.html#cb329-20" tabindex="-1"></a>    choice_id <span class="ot">&lt;-</span> choice_id<span class="sc">$</span>list_name</span>
<span id="cb329-21"><a href="outputs.html#cb329-21" tabindex="-1"></a>    t.choices <span class="ot">&lt;-</span> tool_choices <span class="sc">%&gt;%</span> </span>
<span id="cb329-22"><a href="outputs.html#cb329-22" tabindex="-1"></a>      <span class="fu">filter</span>(list_name <span class="sc">==</span> choice_id) <span class="sc">%&gt;%</span> </span>
<span id="cb329-23"><a href="outputs.html#cb329-23" tabindex="-1"></a>      <span class="fu">select</span>(name, <span class="sc">!!</span><span class="fu">sym</span>(label_colname)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label =</span> label_colname)</span>
<span id="cb329-24"><a href="outputs.html#cb329-24" tabindex="-1"></a>    </span>
<span id="cb329-25"><a href="outputs.html#cb329-25" tabindex="-1"></a>    <span class="co"># replace the label with xml using left_join</span></span>
<span id="cb329-26"><a href="outputs.html#cb329-26" tabindex="-1"></a>    d.new.join <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">col =</span> <span class="fu">as.character</span>(d.join[[col_internal[j]]])) <span class="sc">%&gt;%</span></span>
<span id="cb329-27"><a href="outputs.html#cb329-27" tabindex="-1"></a>      <span class="fu">left_join</span>(t.choices, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;col&quot;</span><span class="ot">=</span><span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(name)</span>
<span id="cb329-28"><a href="outputs.html#cb329-28" tabindex="-1"></a>    d.join[col_internal[j]] <span class="ot">&lt;-</span> d.new.join<span class="sc">$</span>name</span>
<span id="cb329-29"><a href="outputs.html#cb329-29" tabindex="-1"></a>  }</span>
<span id="cb329-30"><a href="outputs.html#cb329-30" tabindex="-1"></a>  </span>
<span id="cb329-31"><a href="outputs.html#cb329-31" tabindex="-1"></a>  <span class="co"># concatenate all the answers, removing NAs in one cell and separated by a &#39;;&#39; </span></span>
<span id="cb329-32"><a href="outputs.html#cb329-32" tabindex="-1"></a>  d.join <span class="ot">&lt;-</span> d.join <span class="sc">%&gt;%</span> </span>
<span id="cb329-33"><a href="outputs.html#cb329-33" tabindex="-1"></a>    <span class="fu">unite</span>(<span class="st">&quot;Merged&quot;</span>, <span class="fu">everything</span>(), <span class="at">sep=</span> <span class="st">&quot;;&quot;</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb329-34"><a href="outputs.html#cb329-34" tabindex="-1"></a>  </span>
<span id="cb329-35"><a href="outputs.html#cb329-35" tabindex="-1"></a>  <span class="co"># return only the new xml column and replace it in the for loop using vectors</span></span>
<span id="cb329-36"><a href="outputs.html#cb329-36" tabindex="-1"></a>  <span class="fu">return</span>(d.join<span class="sc">$</span>Merged)</span>
<span id="cb329-37"><a href="outputs.html#cb329-37" tabindex="-1"></a>}</span></code></pre></div>
<p>Example</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="outputs.html#cb330-1" tabindex="-1"></a><span class="co"># input parameters</span></span>
<span id="cb330-2"><a href="outputs.html#cb330-2" tabindex="-1"></a>filename_tool <span class="ot">&lt;-</span> <span class="st">&quot;enter your tool here&quot;</span></span>
<span id="cb330-3"><a href="outputs.html#cb330-3" tabindex="-1"></a>filename_labeled_data <span class="ot">&lt;-</span> <span class="st">&quot;enter your data here&quot;</span></span>
<span id="cb330-4"><a href="outputs.html#cb330-4" tabindex="-1"></a>label_colname <span class="ot">&lt;-</span> <span class="st">&quot;label::English&quot;</span></span>
<span id="cb330-5"><a href="outputs.html#cb330-5" tabindex="-1"></a>sm_separator <span class="ot">&lt;-</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb330-6"><a href="outputs.html#cb330-6" tabindex="-1"></a></span>
<span id="cb330-7"><a href="outputs.html#cb330-7" tabindex="-1"></a><span class="co"># loading tool</span></span>
<span id="cb330-8"><a href="outputs.html#cb330-8" tabindex="-1"></a>tool_survey <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename_tool, <span class="at">sheet =</span> <span class="st">&quot;survey&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb330-9"><a href="outputs.html#cb330-9" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb330-10"><a href="outputs.html#cb330-10" tabindex="-1"></a>  <span class="co"># adding two columns showing the question type and the id of the list_name choices separately</span></span>
<span id="cb330-11"><a href="outputs.html#cb330-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q.type =</span> <span class="fu">as.character</span>(<span class="fu">lapply</span>(type, <span class="cf">function</span>(x) <span class="fu">str_split</span>(x, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])),</span>
<span id="cb330-12"><a href="outputs.html#cb330-12" tabindex="-1"></a>         <span class="at">list_name =</span> <span class="fu">as.character</span>(<span class="fu">lapply</span>(type, <span class="cf">function</span>(x) <span class="fu">str_split</span>(x, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])))</span>
<span id="cb330-13"><a href="outputs.html#cb330-13" tabindex="-1"></a></span>
<span id="cb330-14"><a href="outputs.html#cb330-14" tabindex="-1"></a>tool_choices <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename_tool, <span class="at">sheet =</span> <span class="st">&quot;choices&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb330-15"><a href="outputs.html#cb330-15" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(list_name))</span>
<span id="cb330-16"><a href="outputs.html#cb330-16" tabindex="-1"></a></span>
<span id="cb330-17"><a href="outputs.html#cb330-17" tabindex="-1"></a><span class="co"># loading your dataset with labels </span></span>
<span id="cb330-18"><a href="outputs.html#cb330-18" tabindex="-1"></a>data_labeled <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename_labeled_data, <span class="at">col_types =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="cb330-19"><a href="outputs.html#cb330-19" tabindex="-1"></a></span>
<span id="cb330-20"><a href="outputs.html#cb330-20" tabindex="-1"></a><span class="co"># creating another data frame with changes</span></span>
<span id="cb330-21"><a href="outputs.html#cb330-21" tabindex="-1"></a>data_xml <span class="ot">&lt;-</span> data_labeled</span>
<span id="cb330-22"><a href="outputs.html#cb330-22" tabindex="-1"></a></span>
<span id="cb330-23"><a href="outputs.html#cb330-23" tabindex="-1"></a><span class="co"># select_one values - Label to XML</span></span>
<span id="cb330-24"><a href="outputs.html#cb330-24" tabindex="-1"></a>tool_select_one <span class="ot">&lt;-</span> tool_survey <span class="sc">%&gt;%</span> </span>
<span id="cb330-25"><a href="outputs.html#cb330-25" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(type, <span class="st">&quot;select_one &quot;</span>))</span>
<span id="cb330-26"><a href="outputs.html#cb330-26" tabindex="-1"></a></span>
<span id="cb330-27"><a href="outputs.html#cb330-27" tabindex="-1"></a>col_select_one <span class="ot">&lt;-</span> tool_select_one[[label_colname]]</span>
<span id="cb330-28"><a href="outputs.html#cb330-28" tabindex="-1"></a></span>
<span id="cb330-29"><a href="outputs.html#cb330-29" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_select_one)){</span>
<span id="cb330-30"><a href="outputs.html#cb330-30" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(data_xml[[col_select_one[i]]])){</span>
<span id="cb330-31"><a href="outputs.html#cb330-31" tabindex="-1"></a>    data_xml[[col_select_one[i]]] <span class="ot">&lt;-</span> <span class="fu">label2xml_choices_one</span>(tool_survey, tool_choices, label_colname,  <span class="at">data =</span> data_labeled, <span class="at">col =</span> col_select_one[i])</span>
<span id="cb330-32"><a href="outputs.html#cb330-32" tabindex="-1"></a>  }</span>
<span id="cb330-33"><a href="outputs.html#cb330-33" tabindex="-1"></a>}</span>
<span id="cb330-34"><a href="outputs.html#cb330-34" tabindex="-1"></a></span>
<span id="cb330-35"><a href="outputs.html#cb330-35" tabindex="-1"></a><span class="co"># select_multiple values - Label to XML</span></span>
<span id="cb330-36"><a href="outputs.html#cb330-36" tabindex="-1"></a>tool_select_multiple <span class="ot">&lt;-</span> tool_survey <span class="sc">%&gt;%</span> </span>
<span id="cb330-37"><a href="outputs.html#cb330-37" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(type, <span class="st">&quot;select_multiple &quot;</span>))</span>
<span id="cb330-38"><a href="outputs.html#cb330-38" tabindex="-1"></a>col_select_multiple <span class="ot">&lt;-</span> tool_select_multiple[[label_colname]]</span>
<span id="cb330-39"><a href="outputs.html#cb330-39" tabindex="-1"></a></span>
<span id="cb330-40"><a href="outputs.html#cb330-40" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_select_multiple)){</span>
<span id="cb330-41"><a href="outputs.html#cb330-41" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(data_xml[[col_select_multiple[i]]])){</span>
<span id="cb330-42"><a href="outputs.html#cb330-42" tabindex="-1"></a>    data_xml[[col_select_multiple[i]]] <span class="ot">&lt;-</span> <span class="fu">label2xml_choices_multiple</span>(tool_survey, tool_choices, label_colname, </span>
<span id="cb330-43"><a href="outputs.html#cb330-43" tabindex="-1"></a>                                                                     <span class="at">data =</span> data_labeled, <span class="at">col =</span> col_select_multiple[i], sm_separator)</span>
<span id="cb330-44"><a href="outputs.html#cb330-44" tabindex="-1"></a>  }</span>
<span id="cb330-45"><a href="outputs.html#cb330-45" tabindex="-1"></a>}</span>
<span id="cb330-46"><a href="outputs.html#cb330-46" tabindex="-1"></a></span>
<span id="cb330-47"><a href="outputs.html#cb330-47" tabindex="-1"></a><span class="co"># Column headers - Label to XML</span></span>
<span id="cb330-48"><a href="outputs.html#cb330-48" tabindex="-1"></a>col_label <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_labeled)</span>
<span id="cb330-49"><a href="outputs.html#cb330-49" tabindex="-1"></a></span>
<span id="cb330-50"><a href="outputs.html#cb330-50" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(col_label)) {</span>
<span id="cb330-51"><a href="outputs.html#cb330-51" tabindex="-1"></a>  <span class="fu">colnames</span>(data_xml)[i] <span class="ot">&lt;-</span> <span class="fu">label2xml_question</span>(tool_survey, tool_choices, label_colname, <span class="at">col =</span> col_label[i], sm_separator)</span>
<span id="cb330-52"><a href="outputs.html#cb330-52" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="dashboarding---sharing-information" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Dashboarding - Sharing information<a href="outputs.html#dashboarding---sharing-information" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Html files
Tableau
Power BI
Shiny</p>
</div>
<div id="outputs-with-hypothesis-testing-results" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Outputs with hypothesis testing results<a href="outputs.html#outputs-with-hypothesis-testing-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="miscellaneous.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
